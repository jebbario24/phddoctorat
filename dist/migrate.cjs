"use strict";var Eh=Object.create;var Bi=Object.defineProperty;var Ph=Object.getOwnPropertyDescriptor;var qh=Object.getOwnPropertyNames;var kh=Object.getPrototypeOf,Ih=Object.prototype.hasOwnProperty;var R=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),Xa=(r,e)=>{for(var t in e)Bi(r,t,{get:e[t],enumerable:!0})},$h=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of qh(e))!Ih.call(r,i)&&i!==t&&Bi(r,i,{get:()=>e[i],enumerable:!(s=Ph(e,i))||s.enumerable});return r};var tr=(r,e,t)=>(t=r!=null?Eh(kh(r)):{},$h(e||!r||!r.__esModule?Bi(t,"default",{value:r,enumerable:!0}):t,r));var Fi=R(sc=>{"use strict";sc.parse=function(r,e){return new ji(r,e).parse()};var ji=class r{constructor(e,t){this.source=e,this.transform=t||Oh,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var e=this.source[this.position++];return e==="\\"?{value:this.source[this.position++],escaped:!0}:{value:e,escaped:!1}}record(e){this.recorded.push(e)}newEntry(e){var t;(this.recorded.length>0||e)&&(t=this.recorded.join(""),t==="NULL"&&!e&&(t=null),t!==null&&(t=this.transform(t)),this.entries.push(t),this.recorded=[])}consumeDimensions(){if(this.source[0]==="[")for(;!this.isEof();){var e=this.nextCharacter();if(e.value==="=")break}}parse(e){var t,s,i;for(this.consumeDimensions();!this.isEof();)if(t=this.nextCharacter(),t.value==="{"&&!i)this.dimension++,this.dimension>1&&(s=new r(this.source.substr(this.position-1),this.transform),this.entries.push(s.parse(!0)),this.position+=s.position-2);else if(t.value==="}"&&!i){if(this.dimension--,!this.dimension&&(this.newEntry(),e))return this.entries}else t.value==='"'&&!t.escaped?(i&&this.newEntry(!0),i=!i):t.value===","&&!i?this.newEntry():this.record(t.value);if(this.dimension!==0)throw new Error("array dimension not balanced");return this.entries}};function Oh(r){return r}});var zi=R((ny,ic)=>{var Mh=Fi();ic.exports={create:function(r,e){return{parse:function(){return Mh.parse(r,e)}}}}});var ac=R((oy,oc)=>{"use strict";var Lh=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,Qh=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,Rh=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,Dh=/^-?infinity$/;oc.exports=function(e){if(Dh.test(e))return Number(e.replace("i","I"));var t=Lh.exec(e);if(!t)return Bh(e)||null;var s=!!t[8],i=parseInt(t[1],10);s&&(i=nc(i));var n=parseInt(t[2],10)-1,o=t[3],a=parseInt(t[4],10),l=parseInt(t[5],10),u=parseInt(t[6],10),d=t[7];d=d?1e3*parseFloat(d):0;var m,p=jh(e);return p!=null?(m=new Date(Date.UTC(i,n,o,a,l,u,d)),Vi(i)&&m.setUTCFullYear(i),p!==0&&m.setTime(m.getTime()-p)):(m=new Date(i,n,o,a,l,u,d),Vi(i)&&m.setFullYear(i)),m};function Bh(r){var e=Qh.exec(r);if(e){var t=parseInt(e[1],10),s=!!e[4];s&&(t=nc(t));var i=parseInt(e[2],10)-1,n=e[3],o=new Date(t,i,n);return Vi(t)&&o.setFullYear(t),o}}function jh(r){if(r.endsWith("+00"))return 0;var e=Rh.exec(r.split(" ")[1]);if(e){var t=e[1];if(t==="Z")return 0;var s=t==="-"?-1:1,i=parseInt(e[2],10)*3600+parseInt(e[3]||0,10)*60+parseInt(e[4]||0,10);return i*s*1e3}}function nc(r){return-(r-1)}function Vi(r){return r>=0&&r<100}});var lc=R((ay,cc)=>{cc.exports=zh;var Fh=Object.prototype.hasOwnProperty;function zh(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Fh.call(t,s)&&(r[s]=t[s])}return r}});var dc=R((cy,hc)=>{"use strict";var Vh=lc();hc.exports=rr;function rr(r){if(!(this instanceof rr))return new rr(r);Vh(this,rd(r))}var Uh=["seconds","minutes","hours","days","months","years"];rr.prototype.toPostgres=function(){var r=Uh.filter(this.hasOwnProperty,this);return this.milliseconds&&r.indexOf("seconds")<0&&r.push("seconds"),r.length===0?"0":r.map(function(e){var t=this[e]||0;return e==="seconds"&&this.milliseconds&&(t=(t+this.milliseconds/1e3).toFixed(6).replace(/\.?0+$/,"")),t+" "+e},this).join(" ")};var Kh={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},Wh=["years","months","days"],Jh=["hours","minutes","seconds"];rr.prototype.toISOString=rr.prototype.toISO=function(){var r=Wh.map(t,this).join(""),e=Jh.map(t,this).join("");return"P"+r+"T"+e;function t(s){var i=this[s]||0;return s==="seconds"&&this.milliseconds&&(i=(i+this.milliseconds/1e3).toFixed(6).replace(/0+$/,"")),i+Kh[s]}};var Ui="([+-]?\\d+)",Hh=Ui+"\\s+years?",Zh=Ui+"\\s+mons?",Gh=Ui+"\\s+days?",Yh="([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?",Xh=new RegExp([Hh,Zh,Gh,Yh].map(function(r){return"("+r+")?"}).join("\\s*")),uc={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},ed=["hours","minutes","seconds","milliseconds"];function td(r){var e=r+"000000".slice(r.length);return parseInt(e,10)/1e3}function rd(r){if(!r)return{};var e=Xh.exec(r),t=e[8]==="-";return Object.keys(uc).reduce(function(s,i){var n=uc[i],o=e[n];return!o||(o=i==="milliseconds"?td(o):parseInt(o,10),!o)||(t&&~ed.indexOf(i)&&(o*=-1),s[i]=o),s},{})}});var mc=R((ly,fc)=>{"use strict";fc.exports=function(e){if(/^\\x/.test(e))return new Buffer(e.substr(2),"hex");for(var t="",s=0;s<e.length;)if(e[s]!=="\\")t+=e[s],++s;else if(/[0-7]{3}/.test(e.substr(s+1,3)))t+=String.fromCharCode(parseInt(e.substr(s+1,3),8)),s+=4;else{for(var i=1;s+i<e.length&&e[s+i]==="\\";)i++;for(var n=0;n<Math.floor(i/2);++n)t+="\\";s+=Math.floor(i/2)*2}return new Buffer(t,"binary")}});var _c=R((uy,Sc)=>{var Vr=Fi(),Ur=zi(),$s=ac(),gc=dc(),yc=mc();function Os(r){return function(t){return t===null?t:r(t)}}function bc(r){return r===null?r:r==="TRUE"||r==="t"||r==="true"||r==="y"||r==="yes"||r==="on"||r==="1"}function sd(r){return r?Vr.parse(r,bc):null}function id(r){return parseInt(r,10)}function Ki(r){return r?Vr.parse(r,Os(id)):null}function nd(r){return r?Vr.parse(r,Os(function(e){return wc(e).trim()})):null}var od=function(r){if(!r)return null;var e=Ur.create(r,function(t){return t!==null&&(t=Zi(t)),t});return e.parse()},Wi=function(r){if(!r)return null;var e=Ur.create(r,function(t){return t!==null&&(t=parseFloat(t)),t});return e.parse()},Me=function(r){if(!r)return null;var e=Ur.create(r);return e.parse()},Ji=function(r){if(!r)return null;var e=Ur.create(r,function(t){return t!==null&&(t=$s(t)),t});return e.parse()},ad=function(r){if(!r)return null;var e=Ur.create(r,function(t){return t!==null&&(t=gc(t)),t});return e.parse()},cd=function(r){return r?Vr.parse(r,Os(yc)):null},Hi=function(r){return parseInt(r,10)},wc=function(r){var e=String(r);return/^\d+$/.test(e)?e:r},pc=function(r){return r?Vr.parse(r,Os(JSON.parse)):null},Zi=function(r){return r[0]!=="("?null:(r=r.substring(1,r.length-1).split(","),{x:parseFloat(r[0]),y:parseFloat(r[1])})},ld=function(r){if(r[0]!=="<"&&r[1]!=="(")return null;for(var e="(",t="",s=!1,i=2;i<r.length-1;i++){if(s||(e+=r[i]),r[i]===")"){s=!0;continue}else if(!s)continue;r[i]!==","&&(t+=r[i])}var n=Zi(e);return n.radius=parseFloat(t),n},ud=function(r){r(20,wc),r(21,Hi),r(23,Hi),r(26,Hi),r(700,parseFloat),r(701,parseFloat),r(16,bc),r(1082,$s),r(1114,$s),r(1184,$s),r(600,Zi),r(651,Me),r(718,ld),r(1e3,sd),r(1001,cd),r(1005,Ki),r(1007,Ki),r(1028,Ki),r(1016,nd),r(1017,od),r(1021,Wi),r(1022,Wi),r(1231,Wi),r(1014,Me),r(1015,Me),r(1008,Me),r(1009,Me),r(1040,Me),r(1041,Me),r(1115,Ji),r(1182,Ji),r(1185,Ji),r(1186,gc),r(1187,ad),r(17,yc),r(114,JSON.parse.bind(JSON)),r(3802,JSON.parse.bind(JSON)),r(199,pc),r(3807,pc),r(3907,Me),r(2951,Me),r(791,Me),r(1183,Me),r(1270,Me)};Sc.exports={init:ud}});var xc=R((hy,vc)=>{"use strict";var Te=1e6;function hd(r){var e=r.readInt32BE(0),t=r.readUInt32BE(4),s="";e<0&&(e=~e+(t===0),t=~t+1>>>0,s="-");var i="",n,o,a,l,u,d;{if(n=e%Te,e=e/Te>>>0,o=4294967296*n+t,t=o/Te>>>0,a=""+(o-Te*t),t===0&&e===0)return s+a+i;for(l="",u=6-a.length,d=0;d<u;d++)l+="0";i=l+a+i}{if(n=e%Te,e=e/Te>>>0,o=4294967296*n+t,t=o/Te>>>0,a=""+(o-Te*t),t===0&&e===0)return s+a+i;for(l="",u=6-a.length,d=0;d<u;d++)l+="0";i=l+a+i}{if(n=e%Te,e=e/Te>>>0,o=4294967296*n+t,t=o/Te>>>0,a=""+(o-Te*t),t===0&&e===0)return s+a+i;for(l="",u=6-a.length,d=0;d<u;d++)l+="0";i=l+a+i}return n=e%Te,o=4294967296*n+t,a=""+o%Te,s+a+i}vc.exports=hd});var Ec=R((dy,Ac)=>{var dd=xc(),te=function(r,e,t,s,i){t=t||0,s=s||!1,i=i||function(C,S,P){return C*Math.pow(2,P)+S};var n=t>>3,o=function(C){return s?~C&255:C},a=255,l=8-t%8;e<l&&(a=255<<8-e&255,l=e),t&&(a=a>>t%8);var u=0;t%8+e>=8&&(u=i(0,o(r[n])&a,l));for(var d=e+t>>3,m=n+1;m<d;m++)u=i(u,o(r[m]),8);var p=(e+t)%8;return p>0&&(u=i(u,o(r[d])>>8-p,p)),u},Nc=function(r,e,t){var s=Math.pow(2,t-1)-1,i=te(r,1),n=te(r,t,1);if(n===0)return 0;var o=1,a=function(u,d,m){u===0&&(u=1);for(var p=1;p<=m;p++)o/=2,(d&1<<m-p)>0&&(u+=o);return u},l=te(r,e,t+1,!1,a);return n==Math.pow(2,t+1)-1?l===0?i===0?1/0:-1/0:NaN:(i===0?1:-1)*Math.pow(2,n-s)*l},fd=function(r){return te(r,1)==1?-1*(te(r,15,1,!0)+1):te(r,15,1)},Cc=function(r){return te(r,1)==1?-1*(te(r,31,1,!0)+1):te(r,31,1)},md=function(r){return Nc(r,23,8)},pd=function(r){return Nc(r,52,11)},gd=function(r){var e=te(r,16,32);if(e==49152)return NaN;for(var t=Math.pow(1e4,te(r,16,16)),s=0,i=[],n=te(r,16),o=0;o<n;o++)s+=te(r,16,64+16*o)*t,t/=1e4;var a=Math.pow(10,te(r,16,48));return(e===0?1:-1)*Math.round(s*a)/a},Tc=function(r,e){var t=te(e,1),s=te(e,63,1),i=new Date((t===0?1:-1)*s/1e3+9466848e5);return r||i.setTime(i.getTime()+i.getTimezoneOffset()*6e4),i.usec=s%1e3,i.getMicroSeconds=function(){return this.usec},i.setMicroSeconds=function(n){this.usec=n},i.getUTCMicroSeconds=function(){return this.usec},i},Kr=function(r){for(var e=te(r,32),t=te(r,32,32),s=te(r,32,64),i=96,n=[],o=0;o<e;o++)n[o]=te(r,32,i),i+=32,i+=32;var a=function(u){var d=te(r,32,i);if(i+=32,d==4294967295)return null;var m;if(u==23||u==20)return m=te(r,d*8,i),i+=d*8,m;if(u==25)return m=r.toString(this.encoding,i>>3,(i+=d<<3)>>3),m;console.log("ERROR: ElementType not implemented: "+u)},l=function(u,d){var m=[],p;if(u.length>1){var C=u.shift();for(p=0;p<C;p++)m[p]=l(u,d);u.unshift(C)}else for(p=0;p<u[0];p++)m[p]=a(d);return m};return l(n,s)},yd=function(r){return r.toString("utf8")},bd=function(r){return r===null?null:te(r,8)>0},wd=function(r){r(20,dd),r(21,fd),r(23,Cc),r(26,Cc),r(1700,gd),r(700,md),r(701,pd),r(16,bd),r(1114,Tc.bind(null,!1)),r(1184,Tc.bind(null,!0)),r(1e3,Kr),r(1007,Kr),r(1016,Kr),r(1008,Kr),r(1009,Kr),r(25,yd)};Ac.exports={init:wd}});var qc=R((fy,Pc)=>{Pc.exports={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}});var Hr=R(Jr=>{var Sd=_c(),_d=Ec(),vd=zi(),xd=qc();Jr.getTypeParser=Cd;Jr.setTypeParser=Td;Jr.arrayParser=vd;Jr.builtins=xd;var Wr={text:{},binary:{}};function kc(r){return String(r)}function Cd(r,e){return e=e||"text",Wr[e]&&Wr[e][r]||kc}function Td(r,e,t){typeof e=="function"&&(t=e,e="text"),Wr[e][r]=t}Sd.init(function(r,e){Wr.text[r]=e});_d.init(function(r,e){Wr.binary[r]=e})});var Zr=R((py,Gi)=>{"use strict";Gi.exports={host:"localhost",user:process.platform==="win32"?process.env.USERNAME:process.env.USER,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:3e4,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};var sr=Hr(),Nd=sr.getTypeParser(20,"text"),Ad=sr.getTypeParser(1016,"text");Gi.exports.__defineSetter__("parseInt8",function(r){sr.setTypeParser(20,"text",r?sr.getTypeParser(23,"text"):Nd),sr.setTypeParser(1016,"text",r?sr.getTypeParser(1007,"text"):Ad)})});var ir=R((gy,Oc)=>{"use strict";var Ed=Zr(),Ic=require("util"),{isDate:Pd}=Ic.types||Ic;function qd(r){return'"'+r.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}function $c(r){let e="{";for(let t=0;t<r.length;t++)if(t>0&&(e=e+","),r[t]===null||typeof r[t]>"u")e=e+"NULL";else if(Array.isArray(r[t]))e=e+$c(r[t]);else if(ArrayBuffer.isView(r[t])){let s=r[t];if(!(s instanceof Buffer)){let i=Buffer.from(s.buffer,s.byteOffset,s.byteLength);i.length===s.byteLength?s=i:s=i.slice(s.byteOffset,s.byteOffset+s.byteLength)}e+="\\\\x"+s.toString("hex")}else e+=qd(Ms(r[t]));return e=e+"}",e}var Ms=function(r,e){if(r==null)return null;if(typeof r=="object"){if(r instanceof Buffer)return r;if(ArrayBuffer.isView(r)){let t=Buffer.from(r.buffer,r.byteOffset,r.byteLength);return t.length===r.byteLength?t:t.slice(r.byteOffset,r.byteOffset+r.byteLength)}return Pd(r)?Ed.parseInputDatesAsUTC?$d(r):Id(r):Array.isArray(r)?$c(r):kd(r,e)}return r.toString()};function kd(r,e){if(r&&typeof r.toPostgres=="function"){if(e=e||[],e.indexOf(r)!==-1)throw new Error('circular reference detected while preparing "'+r+'" for query');return e.push(r),Ms(r.toPostgres(Ms),e)}return JSON.stringify(r)}function Id(r){let e=-r.getTimezoneOffset(),t=r.getFullYear(),s=t<1;s&&(t=Math.abs(t)+1);let i=String(t).padStart(4,"0")+"-"+String(r.getMonth()+1).padStart(2,"0")+"-"+String(r.getDate()).padStart(2,"0")+"T"+String(r.getHours()).padStart(2,"0")+":"+String(r.getMinutes()).padStart(2,"0")+":"+String(r.getSeconds()).padStart(2,"0")+"."+String(r.getMilliseconds()).padStart(3,"0");return e<0?(i+="-",e*=-1):i+="+",i+=String(Math.floor(e/60)).padStart(2,"0")+":"+String(e%60).padStart(2,"0"),s&&(i+=" BC"),i}function $d(r){let e=r.getUTCFullYear(),t=e<1;t&&(e=Math.abs(e)+1);let s=String(e).padStart(4,"0")+"-"+String(r.getUTCMonth()+1).padStart(2,"0")+"-"+String(r.getUTCDate()).padStart(2,"0")+"T"+String(r.getUTCHours()).padStart(2,"0")+":"+String(r.getUTCMinutes()).padStart(2,"0")+":"+String(r.getUTCSeconds()).padStart(2,"0")+"."+String(r.getUTCMilliseconds()).padStart(3,"0");return s+="+00:00",t&&(s+=" BC"),s}function Od(r,e,t){return r=typeof r=="string"?{text:r}:r,e&&(typeof e=="function"?r.callback=e:r.values=e),t&&(r.callback=t),r}var Md=function(r){return'"'+r.replace(/"/g,'""')+'"'},Ld=function(r){let e=!1,t="'";if(r==null||typeof r!="string")return"''";for(let s=0;s<r.length;s++){let i=r[s];i==="'"?t+=i+i:i==="\\"?(t+=i+i,e=!0):t+=i}return t+="'",e===!0&&(t=" E"+t),t};Oc.exports={prepareValue:function(e){return Ms(e)},normalizeQueryConfig:Od,escapeIdentifier:Md,escapeLiteral:Ld}});var Lc=R((yy,Mc)=>{"use strict";var nr=require("crypto");function Yi(r){return nr.createHash("md5").update(r,"utf-8").digest("hex")}function Qd(r,e,t){let s=Yi(e+r);return"md5"+Yi(Buffer.concat([Buffer.from(s),t]))}function Rd(r){return nr.createHash("sha256").update(r).digest()}function Dd(r,e){return r=r.replace(/(\D)-/,"$1"),nr.createHash(r).update(e).digest()}function Bd(r,e){return nr.createHmac("sha256",r).update(e).digest()}async function jd(r,e,t){return nr.pbkdf2Sync(r,e,t,32,"sha256")}Mc.exports={postgresMd5PasswordHash:Qd,randomBytes:nr.randomBytes,deriveKey:jd,sha256:Rd,hashByName:Dd,hmacSha256:Bd,md5:Yi}});var Bc=R((by,Dc)=>{var Qc=require("crypto");Dc.exports={postgresMd5PasswordHash:zd,randomBytes:Fd,deriveKey:Wd,sha256:Vd,hashByName:Ud,hmacSha256:Kd,md5:Xi};var Rc=Qc.webcrypto||globalThis.crypto,qt=Rc.subtle,en=new TextEncoder;function Fd(r){return Rc.getRandomValues(Buffer.alloc(r))}async function Xi(r){try{return Qc.createHash("md5").update(r,"utf-8").digest("hex")}catch{let t=typeof r=="string"?en.encode(r):r,s=await qt.digest("MD5",t);return Array.from(new Uint8Array(s)).map(i=>i.toString(16).padStart(2,"0")).join("")}}async function zd(r,e,t){let s=await Xi(e+r);return"md5"+await Xi(Buffer.concat([Buffer.from(s),t]))}async function Vd(r){return await qt.digest("SHA-256",r)}async function Ud(r,e){return await qt.digest(r,e)}async function Kd(r,e){let t=await qt.importKey("raw",r,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return await qt.sign("HMAC",t,en.encode(e))}async function Wd(r,e,t){let s=await qt.importKey("raw",en.encode(r),"PBKDF2",!1,["deriveBits"]),i={name:"PBKDF2",hash:"SHA-256",salt:e,iterations:t};return await qt.deriveBits(i,s,256,["deriveBits"])}});var rn=R((wy,tn)=>{"use strict";var Jd=parseInt(process.versions&&process.versions.node&&process.versions.node.split(".")[0])<15;Jd?tn.exports=Lc():tn.exports=Bc()});var zc=R((Sy,Fc)=>{function kt(r,e){return new Error("SASL channel binding: "+r+" when parsing public certificate "+e.toString("base64"))}function sn(r,e){let t=r[e++];if(t<128)return{length:t,index:e};let s=t&127;if(s>4)throw kt("bad length",r);t=0;for(let i=0;i<s;i++)t=t<<8|r[e++];return{length:t,index:e}}function jc(r,e){if(r[e++]!==6)throw kt("non-OID data",r);let{length:t,index:s}=sn(r,e);e=s;let i=e+t,n=r[e++],o=(n/40>>0)+"."+n%40;for(;e<i;){let a=0;for(;e<i;){let l=r[e++];if(a=a<<7|l&127,l<128)break}o+="."+a}return{oid:o,index:e}}function Gr(r,e){if(r[e++]!==48)throw kt("non-sequence data",r);return sn(r,e)}function Hd(r,e){e===void 0&&(e=0),e=Gr(r,e).index;let{length:t,index:s}=Gr(r,e);e=s+t,e=Gr(r,e).index;let{oid:i,index:n}=jc(r,e);switch(i){case"1.2.840.113549.1.1.4":return"MD5";case"1.2.840.113549.1.1.5":return"SHA-1";case"1.2.840.113549.1.1.11":return"SHA-256";case"1.2.840.113549.1.1.12":return"SHA-384";case"1.2.840.113549.1.1.13":return"SHA-512";case"1.2.840.113549.1.1.14":return"SHA-224";case"1.2.840.113549.1.1.15":return"SHA512-224";case"1.2.840.113549.1.1.16":return"SHA512-256";case"1.2.840.10045.4.1":return"SHA-1";case"1.2.840.10045.4.3.1":return"SHA-224";case"1.2.840.10045.4.3.2":return"SHA-256";case"1.2.840.10045.4.3.3":return"SHA-384";case"1.2.840.10045.4.3.4":return"SHA-512";case"1.2.840.113549.1.1.10":{if(e=n,e=Gr(r,e).index,r[e++]!==160)throw kt("non-tag data",r);e=sn(r,e).index,e=Gr(r,e).index;let{oid:o}=jc(r,e);switch(o){case"1.2.840.113549.2.5":return"MD5";case"1.3.14.3.2.26":return"SHA-1";case"2.16.840.1.101.3.4.2.1":return"SHA-256";case"2.16.840.1.101.3.4.2.2":return"SHA-384";case"2.16.840.1.101.3.4.2.3":return"SHA-512"}throw kt("unknown hash OID "+o,r)}case"1.3.101.110":case"1.3.101.112":return"SHA-512";case"1.3.101.111":case"1.3.101.113":throw kt("Ed448 certificate channel binding is not currently supported by Postgres")}throw kt("unknown OID "+i,r)}Fc.exports={signatureAlgorithmHashFromCertificate:Hd}});var Wc=R((_y,Kc)=>{"use strict";var mt=rn(),{signatureAlgorithmHashFromCertificate:Zd}=zc();function Gd(r,e){let t=["SCRAM-SHA-256"];e&&t.unshift("SCRAM-SHA-256-PLUS");let s=t.find(o=>r.includes(o));if(!s)throw new Error("SASL: Only mechanism(s) "+t.join(" and ")+" are supported");if(s==="SCRAM-SHA-256-PLUS"&&typeof e.getPeerCertificate!="function")throw new Error("SASL: Mechanism SCRAM-SHA-256-PLUS requires a certificate");let i=mt.randomBytes(18).toString("base64");return{mechanism:s,clientNonce:i,response:(s==="SCRAM-SHA-256-PLUS"?"p=tls-server-end-point":e?"y":"n")+",,n=*,r="+i,message:"SASLInitialResponse"}}async function Yd(r,e,t,s){if(r.message!=="SASLInitialResponse")throw new Error("SASL: Last message was not SASLInitialResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if(e==="")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a non-empty string");if(typeof t!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");let i=tf(t);if(i.nonce.startsWith(r.clientNonce)){if(i.nonce.length===r.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");let n="n=*,r="+r.clientNonce,o="r="+i.nonce+",s="+i.salt+",i="+i.iteration,a=s?"eSws":"biws";if(r.mechanism==="SCRAM-SHA-256-PLUS"){let K=s.getPeerCertificate().raw,z=Zd(K);(z==="MD5"||z==="SHA-1")&&(z="SHA-256");let I=await mt.hashByName(z,K);a=Buffer.concat([Buffer.from("p=tls-server-end-point,,"),Buffer.from(I)]).toString("base64")}let l="c="+a+",r="+i.nonce,u=n+","+o+","+l,d=Buffer.from(i.salt,"base64"),m=await mt.deriveKey(e,d,i.iteration),p=await mt.hmacSha256(m,"Client Key"),C=await mt.sha256(p),S=await mt.hmacSha256(C,u),P=sf(Buffer.from(p),Buffer.from(S)).toString("base64"),M=await mt.hmacSha256(m,"Server Key"),q=await mt.hmacSha256(M,u);r.message="SASLResponse",r.serverSignature=Buffer.from(q).toString("base64"),r.response=l+",p="+P}function Xd(r,e){if(r.message!=="SASLResponse")throw new Error("SASL: Last message was not SASLResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");let{serverSignature:t}=rf(e);if(t!==r.serverSignature)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}function ef(r){if(typeof r!="string")throw new TypeError("SASL: text must be a string");return r.split("").map((e,t)=>r.charCodeAt(t)).every(e=>e>=33&&e<=43||e>=45&&e<=126)}function Vc(r){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(r)}function Uc(r){if(typeof r!="string")throw new TypeError("SASL: attribute pairs text must be a string");return new Map(r.split(",").map(e=>{if(!/^.=/.test(e))throw new Error("SASL: Invalid attribute pair entry");let t=e[0],s=e.substring(2);return[t,s]}))}function tf(r){let e=Uc(r),t=e.get("r");if(t){if(!ef(t))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");let s=e.get("s");if(s){if(!Vc(s))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");let i=e.get("i");if(i){if(!/^[1-9][0-9]*$/.test(i))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");let n=parseInt(i,10);return{nonce:t,salt:s,iteration:n}}function rf(r){let t=Uc(r).get("v");if(t){if(!Vc(t))throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64")}else throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");return{serverSignature:t}}function sf(r,e){if(!Buffer.isBuffer(r))throw new TypeError("first argument must be a Buffer");if(!Buffer.isBuffer(e))throw new TypeError("second argument must be a Buffer");if(r.length!==e.length)throw new Error("Buffer lengths must match");if(r.length===0)throw new Error("Buffers cannot be empty");return Buffer.from(r.map((t,s)=>r[s]^e[s]))}Kc.exports={startSession:Gd,continueSession:Yd,finalizeSession:Xd}});var Qs=R((vy,Jc)=>{"use strict";var nf=Hr();function Ls(r){this._types=r||nf,this.text={},this.binary={}}Ls.prototype.getOverrides=function(r){switch(r){case"text":return this.text;case"binary":return this.binary;default:return{}}};Ls.prototype.setTypeParser=function(r,e,t){typeof e=="function"&&(t=e,e="text"),this.getOverrides(e)[r]=t};Ls.prototype.getTypeParser=function(r,e){return e=e||"text",this.getOverrides(e)[r]||this._types.getTypeParser(r,e)};Jc.exports=Ls});var Gc=R((xy,Zc)=>{"use strict";function or(r,e={}){if(r.charAt(0)==="/"){let l=r.split(" ");return{host:l[0],database:l[1]}}let t={},s,i=!1;/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(r)&&(r=encodeURI(r).replace(/%25(\d\d)/g,"%$1"));try{try{s=new URL(r,"postgres://base")}catch{s=new URL(r.replace("@/","@___DUMMY___/"),"postgres://base"),i=!0}}catch(l){l.input&&(l.input="*****REDACTED*****")}for(let l of s.searchParams.entries())t[l[0]]=l[1];if(t.user=t.user||decodeURIComponent(s.username),t.password=t.password||decodeURIComponent(s.password),s.protocol=="socket:")return t.host=decodeURI(s.pathname),t.database=s.searchParams.get("db"),t.client_encoding=s.searchParams.get("encoding"),t;let n=i?"":s.hostname;t.host?n&&/^%2f/i.test(n)&&(s.pathname=n+s.pathname):t.host=decodeURIComponent(n),t.port||(t.port=s.port);let o=s.pathname.slice(1)||null;t.database=o?decodeURI(o):null,(t.ssl==="true"||t.ssl==="1")&&(t.ssl=!0),t.ssl==="0"&&(t.ssl=!1),(t.sslcert||t.sslkey||t.sslrootcert||t.sslmode)&&(t.ssl={});let a=t.sslcert||t.sslkey||t.sslrootcert?require("fs"):null;if(t.sslcert&&(t.ssl.cert=a.readFileSync(t.sslcert).toString()),t.sslkey&&(t.ssl.key=a.readFileSync(t.sslkey).toString()),t.sslrootcert&&(t.ssl.ca=a.readFileSync(t.sslrootcert).toString()),e.useLibpqCompat&&t.uselibpqcompat)throw new Error("Both useLibpqCompat and uselibpqcompat are set. Please use only one of them.");if(t.uselibpqcompat==="true"||e.useLibpqCompat)switch(t.sslmode){case"disable":{t.ssl=!1;break}case"prefer":{t.ssl.rejectUnauthorized=!1;break}case"require":{t.sslrootcert?t.ssl.checkServerIdentity=function(){}:t.ssl.rejectUnauthorized=!1;break}case"verify-ca":{if(!t.ssl.ca)throw new Error("SECURITY WARNING: Using sslmode=verify-ca requires specifying a CA with sslrootcert. If a public CA is used, verify-ca allows connections to a server that somebody else may have registered with the CA, making you vulnerable to Man-in-the-Middle attacks. Either specify a custom CA certificate with sslrootcert parameter or use sslmode=verify-full for proper security.");t.ssl.checkServerIdentity=function(){};break}case"verify-full":break}else switch(t.sslmode){case"disable":{t.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{t.ssl.rejectUnauthorized=!1;break}}return t}function of(r){return Object.entries(r).reduce((t,[s,i])=>(i!=null&&(t[s]=i),t),{})}function Hc(r){return Object.entries(r).reduce((t,[s,i])=>{if(s==="ssl"){let n=i;typeof n=="boolean"&&(t[s]=n),typeof n=="object"&&(t[s]=of(n))}else if(i!=null)if(s==="port"){if(i!==""){let n=parseInt(i,10);if(isNaN(n))throw new Error(`Invalid ${s}: ${i}`);t[s]=n}}else t[s]=i;return t},{})}function af(r){return Hc(or(r))}Zc.exports=or;or.parse=or;or.toClientConfig=Hc;or.parseIntoClientConfig=af});var on=R((Cy,el)=>{"use strict";var cf=require("dns"),Xc=Zr(),Yc=Gc().parse,xe=function(r,e,t){return t===void 0?t=process.env["PG"+r.toUpperCase()]:t===!1||(t=process.env[t]),e[r]||t||Xc[r]},lf=function(){switch(process.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return Xc.ssl},ar=function(r){return"'"+(""+r).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},Le=function(r,e,t){let s=e[t];s!=null&&r.push(t+"="+ar(s))},nn=class{constructor(e){e=typeof e=="string"?Yc(e):e||{},e.connectionString&&(e=Object.assign({},e,Yc(e.connectionString))),this.user=xe("user",e),this.database=xe("database",e),this.database===void 0&&(this.database=this.user),this.port=parseInt(xe("port",e),10),this.host=xe("host",e),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:xe("password",e)}),this.binary=xe("binary",e),this.options=xe("options",e),this.ssl=typeof e.ssl>"u"?lf():e.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=xe("client_encoding",e),this.replication=xe("replication",e),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=xe("application_name",e,"PGAPPNAME"),this.fallback_application_name=xe("fallback_application_name",e,!1),this.statement_timeout=xe("statement_timeout",e,!1),this.lock_timeout=xe("lock_timeout",e,!1),this.idle_in_transaction_session_timeout=xe("idle_in_transaction_session_timeout",e,!1),this.query_timeout=xe("query_timeout",e,!1),e.connectionTimeoutMillis===void 0?this.connect_timeout=process.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(e.connectionTimeoutMillis/1e3),e.keepAlive===!1?this.keepalives=0:e.keepAlive===!0&&(this.keepalives=1),typeof e.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(e.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(e){let t=[];Le(t,this,"user"),Le(t,this,"password"),Le(t,this,"port"),Le(t,this,"application_name"),Le(t,this,"fallback_application_name"),Le(t,this,"connect_timeout"),Le(t,this,"options");let s=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(Le(t,s,"sslmode"),Le(t,s,"sslca"),Le(t,s,"sslkey"),Le(t,s,"sslcert"),Le(t,s,"sslrootcert"),this.database&&t.push("dbname="+ar(this.database)),this.replication&&t.push("replication="+ar(this.replication)),this.host&&t.push("host="+ar(this.host)),this.isDomainSocket)return e(null,t.join(" "));this.client_encoding&&t.push("client_encoding="+ar(this.client_encoding)),cf.lookup(this.host,function(i,n){return i?e(i,null):(t.push("hostaddr="+ar(n)),e(null,t.join(" ")))})}};el.exports=nn});var cn=R((Ty,rl)=>{"use strict";var uf=Hr(),tl=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,an=class{constructor(e,t){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=t,this.RowCtor=null,this.rowAsArray=e==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray),this._prebuiltEmptyResultObject=null}addCommandComplete(e){let t;e.text?t=tl.exec(e.text):t=tl.exec(e.command),t&&(this.command=t[1],t[3]?(this.oid=parseInt(t[2],10),this.rowCount=parseInt(t[3],10)):t[2]&&(this.rowCount=parseInt(t[2],10)))}_parseRowAsArray(e){let t=new Array(e.length);for(let s=0,i=e.length;s<i;s++){let n=e[s];n!==null?t[s]=this._parsers[s](n):t[s]=null}return t}parseRow(e){let t={...this._prebuiltEmptyResultObject};for(let s=0,i=e.length;s<i;s++){let n=e[s],o=this.fields[s].name;if(n!==null){let a=this.fields[s].format==="binary"?Buffer.from(n):n;t[o]=this._parsers[s](a)}else t[o]=null}return t}addRow(e){this.rows.push(e)}addFields(e){this.fields=e,this.fields.length&&(this._parsers=new Array(e.length));let t={};for(let s=0;s<e.length;s++){let i=e[s];t[i.name]=null,this._types?this._parsers[s]=this._types.getTypeParser(i.dataTypeID,i.format||"text"):this._parsers[s]=uf.getTypeParser(i.dataTypeID,i.format||"text")}this._prebuiltEmptyResultObject={...t}}};rl.exports=an});var ol=R((Ny,nl)=>{"use strict";var{EventEmitter:hf}=require("events"),sl=cn(),il=ir(),ln=class extends hf{constructor(e,t,s){super(),e=il.normalizeQueryConfig(e,t,s),this.text=e.text,this.values=e.values,this.rows=e.rows,this.types=e.types,this.name=e.name,this.queryMode=e.queryMode,this.binary=e.binary,this.portal=e.portal||"",this.callback=e.callback,this._rowMode=e.rowMode,process.domain&&e.callback&&(this.callback=process.domain.bind(e.callback)),this._result=new sl(this._rowMode,this.types),this._results=this._result,this._canceledDueToError=!1}requiresPreparation(){return this.queryMode==="extended"||this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new sl(this._rowMode,this._result._types),this._results.push(this._result))}handleRowDescription(e){this._checkForMultirow(),this._result.addFields(e.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(e){let t;if(!this._canceledDueToError){try{t=this._result.parseRow(e.fields)}catch(s){this._canceledDueToError=s;return}this.emit("row",t,this._result),this._accumulateRows&&this._result.addRow(t)}}handleCommandComplete(e,t){this._checkForMultirow(),this._result.addCommandComplete(e),this.rows&&t.sync()}handleEmptyQuery(e){this.rows&&e.sync()}handleError(e,t){if(this._canceledDueToError&&(e=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(e);this.emit("error",e)}handleReadyForQuery(e){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,e);if(this.callback)try{this.callback(null,this._results)}catch(t){process.nextTick(()=>{throw t})}this.emit("end",this._results)}submit(e){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let t=e.parsedStatements[this.name];if(this.text&&t&&this.text!==t)return new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);if(this.values&&!Array.isArray(this.values))return new Error("Query values must be an array");if(this.requiresPreparation()){e.stream.cork&&e.stream.cork();try{this.prepare(e)}finally{e.stream.uncork&&e.stream.uncork()}}else e.query(this.text);return null}hasBeenParsed(e){return this.name&&e.parsedStatements[this.name]}handlePortalSuspended(e){this._getRows(e,this.rows)}_getRows(e,t){e.execute({portal:this.portal,rows:t}),t?e.flush():e.sync()}prepare(e){this.hasBeenParsed(e)||e.parse({text:this.text,name:this.name,types:this.types});try{e.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:il.prepareValue})}catch(t){this.handleError(t,e);return}e.describe({type:"P",name:this.portal||""}),this._getRows(e,this.rows)}handleCopyInResponse(e){e.sendCopyFail("No source stream defined")}handleCopyData(e,t){}};nl.exports=ln});var Cn=R(O=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0});O.NoticeMessage=O.DataRowMessage=O.CommandCompleteMessage=O.ReadyForQueryMessage=O.NotificationResponseMessage=O.BackendKeyDataMessage=O.AuthenticationMD5Password=O.ParameterStatusMessage=O.ParameterDescriptionMessage=O.RowDescriptionMessage=O.Field=O.CopyResponse=O.CopyDataMessage=O.DatabaseError=O.copyDone=O.emptyQuery=O.replicationStart=O.portalSuspended=O.noData=O.closeComplete=O.bindComplete=O.parseComplete=void 0;O.parseComplete={name:"parseComplete",length:5};O.bindComplete={name:"bindComplete",length:5};O.closeComplete={name:"closeComplete",length:5};O.noData={name:"noData",length:5};O.portalSuspended={name:"portalSuspended",length:5};O.replicationStart={name:"replicationStart",length:4};O.emptyQuery={name:"emptyQuery",length:4};O.copyDone={name:"copyDone",length:4};var un=class extends Error{constructor(e,t,s){super(e),this.length=t,this.name=s}};O.DatabaseError=un;var hn=class{constructor(e,t){this.length=e,this.chunk=t,this.name="copyData"}};O.CopyDataMessage=hn;var dn=class{constructor(e,t,s,i){this.length=e,this.name=t,this.binary=s,this.columnTypes=new Array(i)}};O.CopyResponse=dn;var fn=class{constructor(e,t,s,i,n,o,a){this.name=e,this.tableID=t,this.columnID=s,this.dataTypeID=i,this.dataTypeSize=n,this.dataTypeModifier=o,this.format=a}};O.Field=fn;var mn=class{constructor(e,t){this.length=e,this.fieldCount=t,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};O.RowDescriptionMessage=mn;var pn=class{constructor(e,t){this.length=e,this.parameterCount=t,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};O.ParameterDescriptionMessage=pn;var gn=class{constructor(e,t,s){this.length=e,this.parameterName=t,this.parameterValue=s,this.name="parameterStatus"}};O.ParameterStatusMessage=gn;var yn=class{constructor(e,t){this.length=e,this.salt=t,this.name="authenticationMD5Password"}};O.AuthenticationMD5Password=yn;var bn=class{constructor(e,t,s){this.length=e,this.processID=t,this.secretKey=s,this.name="backendKeyData"}};O.BackendKeyDataMessage=bn;var wn=class{constructor(e,t,s,i){this.length=e,this.processId=t,this.channel=s,this.payload=i,this.name="notification"}};O.NotificationResponseMessage=wn;var Sn=class{constructor(e,t){this.length=e,this.status=t,this.name="readyForQuery"}};O.ReadyForQueryMessage=Sn;var _n=class{constructor(e,t){this.length=e,this.text=t,this.name="commandComplete"}};O.CommandCompleteMessage=_n;var vn=class{constructor(e,t){this.length=e,this.fields=t,this.name="dataRow",this.fieldCount=t.length}};O.DataRowMessage=vn;var xn=class{constructor(e,t){this.length=e,this.message=t,this.name="notice"}};O.NoticeMessage=xn});var al=R(Rs=>{"use strict";Object.defineProperty(Rs,"__esModule",{value:!0});Rs.Writer=void 0;var Tn=class{constructor(e=256){this.size=e,this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(e)}ensure(e){if(this.buffer.length-this.offset<e){let s=this.buffer,i=s.length+(s.length>>1)+e;this.buffer=Buffer.allocUnsafe(i),s.copy(this.buffer)}}addInt32(e){return this.ensure(4),this.buffer[this.offset++]=e>>>24&255,this.buffer[this.offset++]=e>>>16&255,this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addInt16(e){return this.ensure(2),this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addCString(e){if(!e)this.ensure(1);else{let t=Buffer.byteLength(e);this.ensure(t+1),this.buffer.write(e,this.offset,"utf-8"),this.offset+=t}return this.buffer[this.offset++]=0,this}addString(e=""){let t=Buffer.byteLength(e);return this.ensure(t),this.buffer.write(e,this.offset),this.offset+=t,this}add(e){return this.ensure(e.length),e.copy(this.buffer,this.offset),this.offset+=e.length,this}join(e){if(e){this.buffer[this.headerPosition]=e;let t=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(t,this.headerPosition+1)}return this.buffer.slice(e?0:5,this.offset)}flush(e){let t=this.join(e);return this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(this.size),t}};Rs.Writer=Tn});var ll=R(Bs=>{"use strict";Object.defineProperty(Bs,"__esModule",{value:!0});Bs.serialize=void 0;var Nn=al(),ee=new Nn.Writer,df=r=>{ee.addInt16(3).addInt16(0);for(let s of Object.keys(r))ee.addCString(s).addCString(r[s]);ee.addCString("client_encoding").addCString("UTF8");let e=ee.addCString("").flush(),t=e.length+4;return new Nn.Writer().addInt32(t).add(e).flush()},ff=()=>{let r=Buffer.allocUnsafe(8);return r.writeInt32BE(8,0),r.writeInt32BE(80877103,4),r},mf=r=>ee.addCString(r).flush(112),pf=function(r,e){return ee.addCString(r).addInt32(Buffer.byteLength(e)).addString(e),ee.flush(112)},gf=function(r){return ee.addString(r).flush(112)},yf=r=>ee.addCString(r).flush(81),cl=[],bf=r=>{let e=r.name||"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let t=r.types||cl,s=t.length,i=ee.addCString(e).addCString(r.text).addInt16(s);for(let n=0;n<s;n++)i.addInt32(t[n]);return ee.flush(80)},cr=new Nn.Writer,wf=function(r,e){for(let t=0;t<r.length;t++){let s=e?e(r[t],t):r[t];s==null?(ee.addInt16(0),cr.addInt32(-1)):s instanceof Buffer?(ee.addInt16(1),cr.addInt32(s.length),cr.add(s)):(ee.addInt16(0),cr.addInt32(Buffer.byteLength(s)),cr.addString(s))}},Sf=(r={})=>{let e=r.portal||"",t=r.statement||"",s=r.binary||!1,i=r.values||cl,n=i.length;return ee.addCString(e).addCString(t),ee.addInt16(n),wf(i,r.valueMapper),ee.addInt16(n),ee.add(cr.flush()),ee.addInt16(1),ee.addInt16(s?1:0),ee.flush(66)},_f=Buffer.from([69,0,0,0,9,0,0,0,0,0]),vf=r=>{if(!r||!r.portal&&!r.rows)return _f;let e=r.portal||"",t=r.rows||0,s=Buffer.byteLength(e),i=4+s+1+4,n=Buffer.allocUnsafe(1+i);return n[0]=69,n.writeInt32BE(i,1),n.write(e,5,"utf-8"),n[s+5]=0,n.writeUInt32BE(t,n.length-4),n},xf=(r,e)=>{let t=Buffer.allocUnsafe(16);return t.writeInt32BE(16,0),t.writeInt16BE(1234,4),t.writeInt16BE(5678,6),t.writeInt32BE(r,8),t.writeInt32BE(e,12),t},An=(r,e)=>{let s=4+Buffer.byteLength(e)+1,i=Buffer.allocUnsafe(1+s);return i[0]=r,i.writeInt32BE(s,1),i.write(e,5,"utf-8"),i[s]=0,i},Cf=ee.addCString("P").flush(68),Tf=ee.addCString("S").flush(68),Nf=r=>r.name?An(68,`${r.type}${r.name||""}`):r.type==="P"?Cf:Tf,Af=r=>{let e=`${r.type}${r.name||""}`;return An(67,e)},Ef=r=>ee.add(r).flush(100),Pf=r=>An(102,r),Ds=r=>Buffer.from([r,0,0,0,4]),qf=Ds(72),kf=Ds(83),If=Ds(88),$f=Ds(99),Of={startup:df,password:mf,requestSsl:ff,sendSASLInitialResponseMessage:pf,sendSCRAMClientFinalMessage:gf,query:yf,parse:bf,bind:Sf,execute:vf,describe:Nf,close:Af,flush:()=>qf,sync:()=>kf,end:()=>If,copyData:Ef,copyDone:()=>$f,copyFail:Pf,cancel:xf};Bs.serialize=Of});var ul=R(js=>{"use strict";Object.defineProperty(js,"__esModule",{value:!0});js.BufferReader=void 0;var Mf=Buffer.allocUnsafe(0),En=class{constructor(e=0){this.offset=e,this.buffer=Mf,this.encoding="utf-8"}setBuffer(e,t){this.offset=e,this.buffer=t}int16(){let e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e}byte(){let e=this.buffer[this.offset];return this.offset++,e}int32(){let e=this.buffer.readInt32BE(this.offset);return this.offset+=4,e}uint32(){let e=this.buffer.readUInt32BE(this.offset);return this.offset+=4,e}string(e){let t=this.buffer.toString(this.encoding,this.offset,this.offset+e);return this.offset+=e,t}cstring(){let e=this.offset,t=e;for(;this.buffer[t++]!==0;);return this.offset=t,this.buffer.toString(this.encoding,e,t-1)}bytes(e){let t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}};js.BufferReader=En});var fl=R(Fs=>{"use strict";Object.defineProperty(Fs,"__esModule",{value:!0});Fs.Parser=void 0;var re=Cn(),Lf=ul(),Pn=1,Qf=4,hl=Pn+Qf,dl=Buffer.allocUnsafe(0),qn=class{constructor(e){if(this.buffer=dl,this.bufferLength=0,this.bufferOffset=0,this.reader=new Lf.BufferReader,e?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=e?.mode||"text"}parse(e,t){this.mergeBuffer(e);let s=this.bufferOffset+this.bufferLength,i=this.bufferOffset;for(;i+hl<=s;){let n=this.buffer[i],o=this.buffer.readUInt32BE(i+Pn),a=Pn+o;if(a+i<=s){let l=this.handlePacket(i+hl,n,o,this.buffer);t(l),i+=a}else break}i===s?(this.buffer=dl,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=s-i,this.bufferOffset=i)}mergeBuffer(e){if(this.bufferLength>0){let t=this.bufferLength+e.byteLength;if(t+this.bufferOffset>this.buffer.byteLength){let i;if(t<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)i=this.buffer;else{let n=this.buffer.byteLength*2;for(;t>=n;)n*=2;i=Buffer.allocUnsafe(n)}this.buffer.copy(i,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=i,this.bufferOffset=0}e.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=t}else this.buffer=e,this.bufferOffset=0,this.bufferLength=e.byteLength}handlePacket(e,t,s,i){switch(t){case 50:return re.bindComplete;case 49:return re.parseComplete;case 51:return re.closeComplete;case 110:return re.noData;case 115:return re.portalSuspended;case 99:return re.copyDone;case 87:return re.replicationStart;case 73:return re.emptyQuery;case 68:return this.parseDataRowMessage(e,s,i);case 67:return this.parseCommandCompleteMessage(e,s,i);case 90:return this.parseReadyForQueryMessage(e,s,i);case 65:return this.parseNotificationMessage(e,s,i);case 82:return this.parseAuthenticationResponse(e,s,i);case 83:return this.parseParameterStatusMessage(e,s,i);case 75:return this.parseBackendKeyData(e,s,i);case 69:return this.parseErrorMessage(e,s,i,"error");case 78:return this.parseErrorMessage(e,s,i,"notice");case 84:return this.parseRowDescriptionMessage(e,s,i);case 116:return this.parseParameterDescriptionMessage(e,s,i);case 71:return this.parseCopyInMessage(e,s,i);case 72:return this.parseCopyOutMessage(e,s,i);case 100:return this.parseCopyData(e,s,i);default:return new re.DatabaseError("received invalid response: "+t.toString(16),s,"error")}}parseReadyForQueryMessage(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.string(1);return new re.ReadyForQueryMessage(t,i)}parseCommandCompleteMessage(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.cstring();return new re.CommandCompleteMessage(t,i)}parseCopyData(e,t,s){let i=s.slice(e,e+(t-4));return new re.CopyDataMessage(t,i)}parseCopyInMessage(e,t,s){return this.parseCopyMessage(e,t,s,"copyInResponse")}parseCopyOutMessage(e,t,s){return this.parseCopyMessage(e,t,s,"copyOutResponse")}parseCopyMessage(e,t,s,i){this.reader.setBuffer(e,s);let n=this.reader.byte()!==0,o=this.reader.int16(),a=new re.CopyResponse(t,i,n,o);for(let l=0;l<o;l++)a.columnTypes[l]=this.reader.int16();return a}parseNotificationMessage(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.int32(),n=this.reader.cstring(),o=this.reader.cstring();return new re.NotificationResponseMessage(t,i,n,o)}parseRowDescriptionMessage(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.int16(),n=new re.RowDescriptionMessage(t,i);for(let o=0;o<i;o++)n.fields[o]=this.parseField();return n}parseField(){let e=this.reader.cstring(),t=this.reader.uint32(),s=this.reader.int16(),i=this.reader.uint32(),n=this.reader.int16(),o=this.reader.int32(),a=this.reader.int16()===0?"text":"binary";return new re.Field(e,t,s,i,n,o,a)}parseParameterDescriptionMessage(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.int16(),n=new re.ParameterDescriptionMessage(t,i);for(let o=0;o<i;o++)n.dataTypeIDs[o]=this.reader.int32();return n}parseDataRowMessage(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.int16(),n=new Array(i);for(let o=0;o<i;o++){let a=this.reader.int32();n[o]=a===-1?null:this.reader.string(a)}return new re.DataRowMessage(t,n)}parseParameterStatusMessage(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.cstring(),n=this.reader.cstring();return new re.ParameterStatusMessage(t,i,n)}parseBackendKeyData(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.int32(),n=this.reader.int32();return new re.BackendKeyDataMessage(t,i,n)}parseAuthenticationResponse(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.int32(),n={name:"authenticationOk",length:t};switch(i){case 0:break;case 3:n.length===8&&(n.name="authenticationCleartextPassword");break;case 5:if(n.length===12){n.name="authenticationMD5Password";let o=this.reader.bytes(4);return new re.AuthenticationMD5Password(t,o)}break;case 10:{n.name="authenticationSASL",n.mechanisms=[];let o;do o=this.reader.cstring(),o&&n.mechanisms.push(o);while(o)}break;case 11:n.name="authenticationSASLContinue",n.data=this.reader.string(t-8);break;case 12:n.name="authenticationSASLFinal",n.data=this.reader.string(t-8);break;default:throw new Error("Unknown authenticationOk message type "+i)}return n}parseErrorMessage(e,t,s,i){this.reader.setBuffer(e,s);let n={},o=this.reader.string(1);for(;o!=="\0";)n[o]=this.reader.cstring(),o=this.reader.string(1);let a=n.M,l=i==="notice"?new re.NoticeMessage(t,a):new re.DatabaseError(a,t,i);return l.severity=n.S,l.code=n.C,l.detail=n.D,l.hint=n.H,l.position=n.P,l.internalPosition=n.p,l.internalQuery=n.q,l.where=n.W,l.schema=n.s,l.table=n.t,l.column=n.c,l.dataType=n.d,l.constraint=n.n,l.file=n.F,l.line=n.L,l.routine=n.R,l}};Fs.Parser=qn});var kn=R(pt=>{"use strict";Object.defineProperty(pt,"__esModule",{value:!0});pt.DatabaseError=pt.serialize=pt.parse=void 0;var Rf=Cn();Object.defineProperty(pt,"DatabaseError",{enumerable:!0,get:function(){return Rf.DatabaseError}});var Df=ll();Object.defineProperty(pt,"serialize",{enumerable:!0,get:function(){return Df.serialize}});var Bf=fl();function jf(r,e){let t=new Bf.Parser;return r.on("data",s=>t.parse(s,e)),new Promise(s=>r.on("end",()=>s()))}pt.parse=jf});var ml=R(In=>{"use strict";Object.defineProperty(In,"__esModule",{value:!0});In.default={}});var gl=R((Oy,pl)=>{var{getStream:Ff,getSecureStream:zf}=Wf();pl.exports={getStream:Ff,getSecureStream:zf};function Vf(){function r(t){let s=require("net");return new s.Socket}function e(t){return require("tls").connect(t)}return{getStream:r,getSecureStream:e}}function Uf(){function r(t){let{CloudflareSocket:s}=ml();return new s(t)}function e(t){return t.socket.startTls(t),t.socket}return{getStream:r,getSecureStream:e}}function Kf(){if(typeof navigator=="object"&&navigator!==null&&typeof navigator.userAgent=="string")return navigator.userAgent==="Cloudflare-Workers";if(typeof Response=="function"){let r=new Response(null,{cf:{thing:!0}});if(typeof r.cf=="object"&&r.cf!==null&&r.cf.thing)return!0}return!1}function Wf(){return Kf()?Uf():Vf()}});var On=R((My,yl)=>{"use strict";var Jf=require("events").EventEmitter,{parse:Hf,serialize:me}=kn(),{getStream:Zf,getSecureStream:Gf}=gl(),Yf=me.flush(),Xf=me.sync(),em=me.end(),$n=class extends Jf{constructor(e){super(),e=e||{},this.stream=e.stream||Zf(e.ssl),typeof this.stream=="function"&&(this.stream=this.stream(e)),this._keepAlive=e.keepAlive,this._keepAliveInitialDelayMillis=e.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=e.ssl||!1,this._ending=!1,this._emitMessage=!1;let t=this;this.on("newListener",function(s){s==="message"&&(t._emitMessage=!0)})}connect(e,t){let s=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(e,t),this.stream.once("connect",function(){s._keepAlive&&s.stream.setKeepAlive(!0,s._keepAliveInitialDelayMillis),s.emit("connect")});let i=function(n){s._ending&&(n.code==="ECONNRESET"||n.code==="EPIPE")||s.emit("error",n)};if(this.stream.on("error",i),this.stream.on("close",function(){s.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(n){switch(n.toString("utf8")){case"S":break;case"N":return s.stream.end(),s.emit("error",new Error("The server does not support SSL connections"));default:return s.stream.end(),s.emit("error",new Error("There was an error establishing an SSL connection"))}let a={socket:s.stream};s.ssl!==!0&&(Object.assign(a,s.ssl),"key"in s.ssl&&(a.key=s.ssl.key));let l=require("net");l.isIP&&l.isIP(t)===0&&(a.servername=t);try{s.stream=Gf(a)}catch(u){return s.emit("error",u)}s.attachListeners(s.stream),s.stream.on("error",i),s.emit("sslconnect")})}attachListeners(e){Hf(e,t=>{let s=t.name==="error"?"errorMessage":t.name;this._emitMessage&&this.emit("message",t),this.emit(s,t)})}requestSsl(){this.stream.write(me.requestSsl())}startup(e){this.stream.write(me.startup(e))}cancel(e,t){this._send(me.cancel(e,t))}password(e){this._send(me.password(e))}sendSASLInitialResponseMessage(e,t){this._send(me.sendSASLInitialResponseMessage(e,t))}sendSCRAMClientFinalMessage(e){this._send(me.sendSCRAMClientFinalMessage(e))}_send(e){return this.stream.writable?this.stream.write(e):!1}query(e){this._send(me.query(e))}parse(e){this._send(me.parse(e))}bind(e){this._send(me.bind(e))}execute(e){this._send(me.execute(e))}flush(){this.stream.writable&&this.stream.write(Yf)}sync(){this._ending=!0,this._send(Xf)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(em,()=>{this.stream.end()})}close(e){this._send(me.close(e))}describe(e){this._send(me.describe(e))}sendCopyFromChunk(e){this._send(me.copyData(e))}endCopyFrom(){this._send(me.copyDone())}sendCopyFail(e){this._send(me.copyFail(e))}};yl.exports=$n});var _l=R((Ly,Sl)=>{"use strict";var{Transform:tm}=require("stream"),{StringDecoder:rm}=require("string_decoder"),gt=Symbol("last"),zs=Symbol("decoder");function sm(r,e,t){let s;if(this.overflow){if(s=this[zs].write(r).split(this.matcher),s.length===1)return t();s.shift(),this.overflow=!1}else this[gt]+=this[zs].write(r),s=this[gt].split(this.matcher);this[gt]=s.pop();for(let i=0;i<s.length;i++)try{wl(this,this.mapper(s[i]))}catch(n){return t(n)}if(this.overflow=this[gt].length>this.maxLength,this.overflow&&!this.skipOverflow){t(new Error("maximum buffer reached"));return}t()}function im(r){if(this[gt]+=this[zs].end(),this[gt])try{wl(this,this.mapper(this[gt]))}catch(e){return r(e)}r()}function wl(r,e){e!==void 0&&r.push(e)}function bl(r){return r}function nm(r,e,t){switch(r=r||/\r?\n/,e=e||bl,t=t||{},arguments.length){case 1:typeof r=="function"?(e=r,r=/\r?\n/):typeof r=="object"&&!(r instanceof RegExp)&&!r[Symbol.split]&&(t=r,r=/\r?\n/);break;case 2:typeof r=="function"?(t=e,e=r,r=/\r?\n/):typeof e=="object"&&(t=e,e=bl)}t=Object.assign({},t),t.autoDestroy=!0,t.transform=sm,t.flush=im,t.readableObjectMode=!0;let s=new tm(t);return s[gt]="",s[zs]=new rm("utf8"),s.matcher=r,s.mapper=e,s.maxLength=t.maxLength,s.skipOverflow=t.skipOverflow||!1,s.overflow=!1,s._destroy=function(i,n){this._writableState.errorEmitted=!1,n(i)},s}Sl.exports=nm});var Cl=R((Qy,it)=>{"use strict";var vl=require("path"),om=require("stream").Stream,am=_l(),xl=require("util"),cm=5432,Vs=process.platform==="win32",Yr=process.stderr,lm=56,um=7,hm=61440,dm=32768;function fm(r){return(r&hm)==dm}var lr=["host","port","database","user","password"],Mn=lr.length,mm=lr[Mn-1];function Ln(){var r=Yr instanceof om&&Yr.writable===!0;if(r){var e=Array.prototype.slice.call(arguments).concat(`
`);Yr.write(xl.format.apply(xl,e))}}Object.defineProperty(it.exports,"isWin",{get:function(){return Vs},set:function(r){Vs=r}});it.exports.warnTo=function(r){var e=Yr;return Yr=r,e};it.exports.getFileName=function(r){var e=r||process.env,t=e.PGPASSFILE||(Vs?vl.join(e.APPDATA||"./","postgresql","pgpass.conf"):vl.join(e.HOME||"./",".pgpass"));return t};it.exports.usePgPass=function(r,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:Vs?!0:(e=e||"<unkn>",fm(r.mode)?r.mode&(lm|um)?(Ln('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Ln('WARNING: password file "%s" is not a plain file',e),!1))};var pm=it.exports.match=function(r,e){return lr.slice(0,-1).reduce(function(t,s,i){return i==1&&Number(r[s]||cm)===Number(e[s])?t&&!0:t&&(e[s]==="*"||e[s]===r[s])},!0)};it.exports.getPassword=function(r,e,t){var s,i=e.pipe(am());function n(l){var u=gm(l);u&&ym(u)&&pm(r,u)&&(s=u[mm],i.end())}var o=function(){e.destroy(),t(s)},a=function(l){e.destroy(),Ln("WARNING: error on reading file: %s",l),t(void 0)};e.on("error",a),i.on("data",n).on("end",o).on("error",a)};var gm=it.exports.parseLine=function(r){if(r.length<11||r.match(/^\s+#/))return null;for(var e="",t="",s=0,i=0,n=0,o={},a=!1,l=function(d,m,p){var C=r.substring(m,p);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(C=C.replace(/\\([:\\])/g,"$1")),o[lr[d]]=C},u=0;u<r.length-1;u+=1){if(e=r.charAt(u+1),t=r.charAt(u),a=s==Mn-1,a){l(s,i);break}u>=0&&e==":"&&t!=="\\"&&(l(s,i,u+1),i=u+2,s+=1)}return o=Object.keys(o).length===Mn?o:null,o},ym=it.exports.isValidEntry=function(r){for(var e={0:function(o){return o.length>0},1:function(o){return o==="*"?!0:(o=Number(o),isFinite(o)&&o>0&&o<9007199254740992&&Math.floor(o)===o)},2:function(o){return o.length>0},3:function(o){return o.length>0},4:function(o){return o.length>0}},t=0;t<lr.length;t+=1){var s=e[t],i=r[lr[t]]||"",n=s(i);if(!n)return!1}return!0}});var Nl=R((Dy,Qn)=>{"use strict";var Ry=require("path"),Tl=require("fs"),Us=Cl();Qn.exports=function(r,e){var t=Us.getFileName();Tl.stat(t,function(s,i){if(s||!Us.usePgPass(i,t))return e(void 0);var n=Tl.createReadStream(t);Us.getPassword(r,n,e)})};Qn.exports.warnTo=Us.warnTo});var ql=R((By,Pl)=>{"use strict";var bm=require("events").EventEmitter,Al=ir(),Rn=Wc(),wm=Qs(),Sm=on(),El=ol(),_m=Zr(),vm=On(),xm=rn(),Ks=class extends bm{constructor(e){super(),this.connectionParameters=new Sm(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let t=e||{};this._Promise=t.Promise||global.Promise,this._types=new wm(t.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!t.enableChannelBinding,this.connection=t.connection||new vm({stream:t.stream,ssl:this.connectionParameters.ssl,keepAlive:t.keepAlive||!1,keepAliveInitialDelayMillis:t.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=t.binary||_m.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=t.connectionTimeoutMillis||0}_errorAllQueries(e){let t=s=>{process.nextTick(()=>{s.handleError(e,this.connection)})};this.activeQuery&&(t(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(t),this.queryQueue.length=0}_connect(e){let t=this,s=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let i=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(i)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{s._ending=!0,s.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?s.connect(this.host+"/.s.PGSQL."+this.port):s.connect(this.port,this.host),s.on("connect",function(){t.ssl?s.requestSsl():s.startup(t.getStartupConf())}),s.on("sslconnect",function(){s.startup(t.getStartupConf())}),this._attachListeners(s),s.once("end",()=>{let i=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(i),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(i):this._handleErrorEvent(i):this._connectionError||this._handleErrorEvent(i)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((t,s)=>{this._connect(i=>{i?s(i):t()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let t=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(s=>{if(s!==void 0){if(typeof s!="string"){t.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=s}else this.connectionParameters.password=this.password=null;e()}).catch(s=>{t.emit("error",s)});else if(this.password!==null)e();else try{Nl()(this.connectionParameters,i=>{i!==void 0&&(this.connectionParameters.password=this.password=i),e()})}catch(s){this.emit("error",s)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let t=await xm.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(t)}catch(t){this.emit("error",t)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Rn.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(t){this.connection.emit("error",t)}})}async _handleAuthSASLContinue(e){try{await Rn.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(t){this.connection.emit("error",t)}}_handleAuthSASLFinal(e){try{Rn.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(t){this.connection.emit("error",t)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:t}=this;this.activeQuery=null,this.readyForQuery=!0,t&&t.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let t=this.activeQuery;if(!t){this._handleErrorEvent(e);return}this.activeQuery=null,t.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let t=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(t);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,t={user:e.user,database:e.database},s=e.application_name||e.fallback_application_name;return s&&(t.application_name=s),e.replication&&(t.replication=""+e.replication),e.statement_timeout&&(t.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(t.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(t.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(t.options=e.options),t}cancel(e,t){if(e.activeQuery===t){let s=this.connection;this.host&&this.host.indexOf("/")===0?s.connect(this.host+"/.s.PGSQL."+this.port):s.connect(this.port,this.host),s.on("connect",function(){s.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(t)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(t),1)}setTypeParser(e,t,s){return this._types.setTypeParser(e,t,s)}getTypeParser(e,t){return this._types.getTypeParser(e,t)}escapeIdentifier(e){return Al.escapeIdentifier(e)}escapeLiteral(e){return Al.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,t,s){let i,n,o,a,l;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(o=e.query_timeout||this.connectionParameters.query_timeout,n=i=e,typeof t=="function"&&(i.callback=i.callback||t)):(o=e.query_timeout||this.connectionParameters.query_timeout,i=new El(e,t,s),i.callback||(n=new this._Promise((u,d)=>{i.callback=(m,p)=>m?d(m):u(p)}).catch(u=>{throw Error.captureStackTrace(u),u}))),o&&(l=i.callback,a=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{i.handleError(u,this.connection)}),l(u),i.callback=()=>{};let d=this.queryQueue.indexOf(i);d>-1&&this.queryQueue.splice(d,1),this._pulseQueryQueue()},o),i.callback=(u,d)=>{clearTimeout(a),l(u,d)}),this.binary&&!i.binary&&(i.binary=!0),i._result&&!i._result._types&&(i._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{i.handleError(new Error("Client was closed and is not queryable"),this.connection)}),n):(this.queryQueue.push(i),this._pulseQueryQueue(),n):(process.nextTick(()=>{i.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),n)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(t=>{this.connection.once("end",t)})}};Ks.Query=El;Pl.exports=Ks});var Ol=R((jy,$l)=>{"use strict";var Cm=require("events").EventEmitter,kl=function(){},Il=(r,e)=>{let t=r.findIndex(e);return t===-1?void 0:r.splice(t,1)[0]},Dn=class{constructor(e,t,s){this.client=e,this.idleListener=t,this.timeoutId=s}},ur=class{constructor(e){this.callback=e}};function Tm(){throw new Error("Release called on client which has already been released to the pool.")}function Ws(r,e){if(e)return{callback:e,result:void 0};let t,s,i=function(o,a){o?t(o):s(a)},n=new r(function(o,a){s=o,t=a}).catch(o=>{throw Error.captureStackTrace(o),o});return{callback:i,result:n}}function Nm(r,e){return function t(s){s.client=e,e.removeListener("error",t),e.on("error",()=>{r.log("additional client error after disconnection due to error",s)}),r._remove(e),r.emit("error",s,e)}}var Bn=class extends Cm{constructor(e,t){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||t||jn().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(t=>{this._remove(t.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let t=this._idle.pop();clearTimeout(t.timeoutId);let s=t.client;s.ref&&s.ref();let i=t.idleListener;return this._acquireClient(s,e,i,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,t){let s=Il(this._idle,n=>n.client===e);s!==void 0&&clearTimeout(s.timeoutId),this._clients=this._clients.filter(n=>n!==e);let i=this;e.end(()=>{i.emit("remove",e),typeof t=="function"&&t()})}connect(e){if(this.ending){let i=new Error("Cannot use a pool after calling end on the pool");return e?e(i):this.Promise.reject(i)}let t=Ws(this.Promise,e),s=t.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new ur(t.callback)),s;let i=(a,l,u)=>{clearTimeout(o),t.callback(a,l,u)},n=new ur(i),o=setTimeout(()=>{Il(this._pendingQueue,a=>a.callback===i),n.timedOut=!0,t.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return o.unref&&o.unref(),this._pendingQueue.push(n),s}return this.newClient(new ur(t.callback)),s}newClient(e){let t=new this.Client(this.options);this._clients.push(t);let s=Nm(this,t);this.log("checking client timeout");let i,n=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),n=!0,t.connection?t.connection.stream.destroy():t.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),t.connect(o=>{if(i&&clearTimeout(i),t.on("error",s),o)this.log("client failed to connect",o),this._clients=this._clients.filter(a=>a!==t),n&&(o=new Error("Connection terminated due to connection timeout",{cause:o})),this._pulseQueue(),e.timedOut||e.callback(o,void 0,kl);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let a=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(t),this._idle.findIndex(u=>u.client===t)!==-1&&this._acquireClient(t,new ur((u,d,m)=>m()),s,!1)},this.options.maxLifetimeSeconds*1e3);a.unref(),t.once("end",()=>clearTimeout(a))}return this._acquireClient(t,e,s,!0)}})}_acquireClient(e,t,s,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,s),e.removeListener("error",s),t.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,n=>{if(n)return e.release(n),t.callback(n,void 0,kl);t.callback(void 0,e,e.release)}):t.callback(void 0,e,e.release)}_releaseOnce(e,t){let s=!1;return i=>{s&&Tm(),s=!0,this._release(e,t,i)}}_release(e,t,s){if(e.on("error",t),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",s,e),s||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let n;this.options.idleTimeoutMillis&&this._isAboveMin()&&(n=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&n.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new Dn(e,t,n)),this._pulseQueue()}query(e,t,s){if(typeof e=="function"){let n=Ws(this.Promise,e);return setImmediate(function(){return n.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),n.result}typeof t=="function"&&(s=t,t=void 0);let i=Ws(this.Promise,s);return s=i.callback,this.connect((n,o)=>{if(n)return s(n);let a=!1,l=u=>{a||(a=!0,o.release(u),s(u))};o.once("error",l),this.log("dispatching query");try{o.query(e,t,(u,d)=>{if(this.log("query dispatched"),o.removeListener("error",l),!a)return a=!0,o.release(u),u?s(u):s(void 0,d)})}catch(u){return o.release(u),s(u)}}),i.result}end(e){if(this.log("ending"),this.ending){let s=new Error("Called end on pool more than once");return e?e(s):this.Promise.reject(s)}this.ending=!0;let t=Ws(this.Promise,e);return this._endCallback=t.callback,this._pulseQueue(),t.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,t)=>e+(this._expired.has(t)?1:0),0)}get totalCount(){return this._clients.length}};$l.exports=Bn});var Ql=R((Fy,Ll)=>{"use strict";var Ml=require("events").EventEmitter,Am=require("util"),Fn=ir(),hr=Ll.exports=function(r,e,t){Ml.call(this),r=Fn.normalizeQueryConfig(r,e,t),this.text=r.text,this.values=r.values,this.name=r.name,this.queryMode=r.queryMode,this.callback=r.callback,this.state="new",this._arrayMode=r.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(s){s==="row"&&(this._emitRowEvents=!0)}.bind(this))};Am.inherits(hr,Ml);var Em={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};hr.prototype.handleError=function(r){let e=this.native.pq.resultErrorFields();if(e)for(let t in e){let s=Em[t]||t;r[s]=e[t]}this.callback?this.callback(r):this.emit("error",r),this.state="error"};hr.prototype.then=function(r,e){return this._getPromise().then(r,e)};hr.prototype.catch=function(r){return this._getPromise().catch(r)};hr.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(r,e){this._once("end",r),this._once("error",e)}.bind(this)),this._promise)};hr.prototype.submit=function(r){this.state="running";let e=this;this.native=r.native,r.native.arrayMode=this._arrayMode;let t=function(s,i,n){if(r.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),s)return e.handleError(s);e._emitRowEvents&&(n.length>1?i.forEach((o,a)=>{o.forEach(l=>{e.emit("row",l,n[a])})}):i.forEach(function(o){e.emit("row",o,n)})),e.state="end",e.emit("end",n),e.callback&&e.callback(null,n)};if(process.domain&&(t=process.domain.bind(t)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let s=(this.values||[]).map(Fn.prepareValue);if(r.namedQueries[this.name]){if(this.text&&r.namedQueries[this.name]!==this.text){let i=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return t(i)}return r.native.execute(this.name,s,t)}return r.native.prepare(this.name,this.text,s.length,function(i){return i?t(i):(r.namedQueries[e.name]=e.text,e.native.execute(e.name,s,t))})}else if(this.values){if(!Array.isArray(this.values)){let i=new Error("Query values must be an array");return t(i)}let s=this.values.map(Fn.prepareValue);r.native.query(this.text,s,t)}else this.queryMode==="extended"?r.native.query(this.text,[],t):r.native.query(this.text,t)}});var Fl=R((zy,jl)=>{"use strict";var Rl;try{Rl=require("pg-native")}catch(r){throw r}var Pm=Qs(),Dl=require("events").EventEmitter,qm=require("util"),km=on(),Bl=Ql(),Ne=jl.exports=function(r){Dl.call(this),r=r||{},this._Promise=r.Promise||global.Promise,this._types=new Pm(r.types),this.native=new Rl({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new km(r);r.nativeConnectionString&&(e.nativeConnectionString=r.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};Ne.Query=Bl;qm.inherits(Ne,Dl);Ne.prototype._errorAllQueries=function(r){let e=t=>{process.nextTick(()=>{t.native=this.native,t.handleError(r)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};Ne.prototype._connect=function(r){let e=this;if(this._connecting){process.nextTick(()=>r(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(t,s){if(e.connectionParameters.nativeConnectionString&&(s=e.connectionParameters.nativeConnectionString),t)return r(t);e.native.connect(s,function(i){if(i)return e.native.end(),r(i);e._connected=!0,e.native.on("error",function(n){e._queryable=!1,e._errorAllQueries(n),e.emit("error",n)}),e.native.on("notification",function(n){e.emit("notification",{channel:n.relname,payload:n.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),r()})})};Ne.prototype.connect=function(r){if(r){this._connect(r);return}return new this._Promise((e,t)=>{this._connect(s=>{s?t(s):e()})})};Ne.prototype.query=function(r,e,t){let s,i,n,o,a;if(r==null)throw new TypeError("Client was passed a null or undefined query");if(typeof r.submit=="function")n=r.query_timeout||this.connectionParameters.query_timeout,i=s=r,typeof e=="function"&&(r.callback=e);else if(n=r.query_timeout||this.connectionParameters.query_timeout,s=new Bl(r,e,t),!s.callback){let l,u;i=new this._Promise((d,m)=>{l=d,u=m}).catch(d=>{throw Error.captureStackTrace(d),d}),s.callback=(d,m)=>d?u(d):l(m)}return n&&(a=s.callback,o=setTimeout(()=>{let l=new Error("Query read timeout");process.nextTick(()=>{s.handleError(l,this.connection)}),a(l),s.callback=()=>{};let u=this._queryQueue.indexOf(s);u>-1&&this._queryQueue.splice(u,1),this._pulseQueryQueue()},n),s.callback=(l,u)=>{clearTimeout(o),a(l,u)}),this._queryable?this._ending?(s.native=this.native,process.nextTick(()=>{s.handleError(new Error("Client was closed and is not queryable"))}),i):(this._queryQueue.push(s),this._pulseQueryQueue(),i):(s.native=this.native,process.nextTick(()=>{s.handleError(new Error("Client has encountered a connection error and is not queryable"))}),i)};Ne.prototype.end=function(r){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,r));let t;return r||(t=new this._Promise(function(s,i){r=n=>n?i(n):s()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),r&&r()})}),t};Ne.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};Ne.prototype._pulseQueryQueue=function(r){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){r||this.emit("drain");return}this._activeQuery=e,e.submit(this);let t=this;e.once("_done",function(){t._pulseQueryQueue()})};Ne.prototype.cancel=function(r){this._activeQuery===r?this.native.cancel(function(){}):this._queryQueue.indexOf(r)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(r),1)};Ne.prototype.ref=function(){};Ne.prototype.unref=function(){};Ne.prototype.setTypeParser=function(r,e,t){return this._types.setTypeParser(r,e,t)};Ne.prototype.getTypeParser=function(r,e){return this._types.getTypeParser(r,e)}});var zn=R((Vy,zl)=>{"use strict";zl.exports=Fl()});var jn=R((Ky,Xr)=>{"use strict";var Im=ql(),$m=Zr(),Om=On(),Mm=cn(),Lm=ir(),Qm=Ol(),Rm=Qs(),{DatabaseError:Dm}=kn(),{escapeIdentifier:Bm,escapeLiteral:jm}=ir(),Fm=r=>class extends Qm{constructor(t){super(t,r)}},Vn=function(r){this.defaults=$m,this.Client=r,this.Query=this.Client.Query,this.Pool=Fm(this.Client),this._pools=[],this.Connection=Om,this.types=Hr(),this.DatabaseError=Dm,this.TypeOverrides=Rm,this.escapeIdentifier=Bm,this.escapeLiteral=jm,this.Result=Mm,this.utils=Lm};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?Xr.exports=new Vn(zn()):(Xr.exports=new Vn(Im),Object.defineProperty(Xr.exports,"native",{configurable:!0,enumerable:!1,get(){let r=null;try{r=new Vn(zn())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(Xr.exports,"native",{value:r}),r}}))});var Ah=tr(require("dotenv"),1);var ec=tr(require("node:crypto"),1),Is=tr(require("node:fs"),1);function tc(r){let e=r.migrationsFolder,t=[],s=`${e}/meta/_journal.json`;if(!Is.default.existsSync(s))throw new Error("Can't find meta/_journal.json file");let i=Is.default.readFileSync(`${e}/meta/_journal.json`).toString(),n=JSON.parse(i);for(let o of n.entries){let a=`${e}/${o.tag}.sql`;try{let l=Is.default.readFileSync(`${e}/${o.tag}.sql`).toString(),u=l.split("--> statement-breakpoint").map(d=>d);t.push({sql:u,bps:o.breakpoints,folderMillis:o.when,hash:ec.default.createHash("sha256").update(l).digest("hex")})}catch{throw new Error(`No file ${a} found in ${e} folder`)}}return t}async function rc(r,e){let t=tc(e);await r.dialect.migrate(t,r.session,e)}var Ie=tr(jn(),1),Wy=Ie.default.Client,Jy=Ie.default.Pool,Hy=Ie.default.Connection,Zy=Ie.default.types,Gy=Ie.default.Query,Yy=Ie.default.DatabaseError,Xy=Ie.default.escapeIdentifier,eb=Ie.default.escapeLiteral,tb=Ie.default.Result,rb=Ie.default.TypeOverrides,sb=Ie.default.defaults,yt=Ie.default;var h=Symbol.for("drizzle:entityKind"),nb=Symbol.for("drizzle:hasOwnEntityKind");function f(r,e){if(!r||typeof r!="object")return!1;if(r instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,h))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let t=Object.getPrototypeOf(r).constructor;if(t)for(;t;){if(h in t&&t[h]===e[h])return!0;t=Object.getPrototypeOf(t)}return!1}var Un=class{static[h]="ConsoleLogWriter";write(e){console.log(e)}},dr=class{static[h]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new Un}logQuery(e,t){let s=t.map(n=>{try{return JSON.stringify(n)}catch{return String(n)}}),i=s.length?` -- params: [${s.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},fr=class{static[h]="NoopLogger";logQuery(){}};var W=class{static[h]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}then(e,t){return this.execute().then(e,t)}};var L=class{constructor(e,t){this.table=e,this.config=t,this.name=t.name,this.keyAsName=t.keyAsName,this.notNull=t.notNull,this.default=t.default,this.defaultFn=t.defaultFn,this.onUpdateFn=t.onUpdateFn,this.hasDefault=t.hasDefault,this.primary=t.primaryKey,this.isUnique=t.isUnique,this.uniqueName=t.uniqueName,this.uniqueType=t.uniqueType,this.dataType=t.dataType,this.columnType=t.columnType,this.generated=t.generated,this.generatedIdentity=t.generatedIdentity}static[h]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var mr=class{static[h]="ColumnBuilder";config;constructor(e,t,s){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:t,columnType:s,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var we=Symbol.for("drizzle:Name");var Js=class{static[h]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,t){this.reference=()=>{let{name:s,columns:i,foreignColumns:n}=e();return{name:s,columns:i,foreignTable:n[0].table,foreignColumns:n}},t&&(this._onUpdate=t.onUpdate,this._onDelete=t.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new Kn(e,this)}},Kn=class{constructor(e,t){this.table=e,this.reference=t.reference,this.onUpdate=t._onUpdate,this.onDelete=t._onDelete}static[h]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:t,foreignColumns:s}=this.reference(),i=t.map(a=>a.name),n=s.map(a=>a.name),o=[this.table[we],...i,s[0].table[we],...n];return e??`${o.join("_")}_fk`}};function Hs(r,...e){return r(...e)}function Hn(r,e){return`${r[we]}_${e.join("_")}_unique`}var Wn=class{constructor(e,t){this.name=t,this.columns=e}static[h]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Jn(e,this.columns,this.nullsNotDistinctConfig,this.name)}},Vl=class{static[h]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new Wn(e,this.name)}},Jn=class{constructor(e,t,s,i){this.table=e,this.columns=t,this.name=i??Hn(this.table,this.columns.map(n=>n.name)),this.nullsNotDistinct=s}static[h]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function Ul(r,e,t){for(let s=e;s<r.length;s++){let i=r[s];if(i==="\\"){s++;continue}if(i==='"')return[r.slice(e,s).replace(/\\/g,""),s+1];if(!t&&(i===","||i==="}"))return[r.slice(e,s).replace(/\\/g,""),s]}return[r.slice(e).replace(/\\/g,""),r.length]}function Kl(r,e=0){let t=[],s=e,i=!1;for(;s<r.length;){let n=r[s];if(n===","){(i||s===e)&&t.push(""),i=!0,s++;continue}if(i=!1,n==="\\"){s+=2;continue}if(n==='"'){let[l,u]=Ul(r,s+1,!0);t.push(l),s=u;continue}if(n==="}")return[t,s+1];if(n==="{"){let[l,u]=Kl(r,s+1);t.push(l),s=u;continue}let[o,a]=Ul(r,s,!1);t.push(o),s=a}return[t,s]}function Wl(r){let[e]=Kl(r,1);return e}function Zn(r){return`{${r.map(e=>Array.isArray(e)?Zn(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var T=class extends mr{foreignKeyConfigs=[];static[h]="PgColumnBuilder";array(e){return new Yn(this.config.name,this,e)}references(e,t={}){return this.foreignKeyConfigs.push({ref:e,actions:t}),this}unique(e,t){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=t?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,t){return this.foreignKeyConfigs.map(({ref:s,actions:i})=>Hs((n,o)=>{let a=new Js(()=>{let l=n();return{columns:[e],foreignColumns:[l]}});return o.onUpdate&&a.onUpdate(o.onUpdate),o.onDelete&&a.onDelete(o.onDelete),a.build(t)},s,i))}buildExtraConfigColumn(e){return new Gn(e,this.config)}},w=class extends L{constructor(e,t){t.uniqueName||(t.uniqueName=Hn(e,[t.name])),super(e,t),this.table=e}static[h]="PgColumn"},Gn=class extends w{static[h]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},pr=class{static[h]="IndexedColumn";constructor(e,t,s,i){this.name=e,this.keyAsName=t,this.type=s,this.indexConfig=i}name;keyAsName;type;indexConfig},Yn=class extends T{static[h]="PgArrayBuilder";constructor(e,t,s){super(e,"array","PgArray"),this.config.baseBuilder=t,this.config.size=s}build(e){let t=this.config.baseBuilder.build(e);return new Xn(e,this.config,t)}},Xn=class r extends w{constructor(e,t,s,i){super(e,t),this.baseColumn=s,this.range=i,this.size=t.size}size;static[h]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=Wl(e)),e.map(t=>this.baseColumn.mapFromDriverValue(t))}mapToDriverValue(e,t=!1){let s=e.map(i=>i===null?null:f(this.baseColumn,r)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return t?s:Zn(s)}};var Jl=class extends T{static[h]="PgEnumObjectColumnBuilder";constructor(e,t){super(e,"string","PgEnumObjectColumn"),this.config.enum=t}build(e){return new eo(e,this.config)}},eo=class extends w{static[h]="PgEnumObjectColumn";enum;enumValues=this.config.enum.enumValues;constructor(e,t){super(e,t),this.enum=t.enum}getSQLType(){return this.enum.enumName}},Hl=Symbol.for("drizzle:isPgEnum");function Gl(r){return!!r&&typeof r=="function"&&Hl in r&&r[Hl]===!0}var Zl=class extends T{static[h]="PgEnumColumnBuilder";constructor(e,t){super(e,"string","PgEnumColumn"),this.config.enum=t}build(e){return new to(e,this.config)}},to=class extends w{static[h]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,t){super(e,t),this.enum=t.enum}getSQLType(){return this.enum.enumName}};var j=class{static[h]="Subquery";constructor(e,t,s,i=!1,n=[]){this._={brand:"Subquery",sql:e,selectedFields:t,alias:s,isWith:i,usedTables:n}}},Je=class extends j{static[h]="WithSubquery"};var Yl="0.45.1";var ro,so,Z={startActiveSpan(r,e){return ro?(so||(so=ro.trace.getTracer("drizzle-orm",Yl)),Hs((t,s)=>s.startActiveSpan(r,i=>{try{return e(i)}catch(n){throw i.setStatus({code:t.SpanStatusCode.ERROR,message:n instanceof Error?n.message:"Unknown error"}),n}finally{i.end()}}),ro,so)):e()}};var U=Symbol.for("drizzle:ViewBaseConfig");var It=Symbol.for("drizzle:Schema"),gr=Symbol.for("drizzle:Columns"),Xl=Symbol.for("drizzle:ExtraConfigColumns"),io=Symbol.for("drizzle:OriginalName"),no=Symbol.for("drizzle:BaseName"),es=Symbol.for("drizzle:IsAlias"),eu=Symbol.for("drizzle:ExtraConfigBuilder"),tu=Symbol.for("drizzle:IsDrizzleTable"),g=class{static[h]="Table";static Symbol={Name:we,Schema:It,OriginalName:io,Columns:gr,ExtraConfigColumns:Xl,BaseName:no,IsAlias:es,ExtraConfigBuilder:eu};[we];[io];[It];[gr];[Xl];[no];[es]=!1;[tu]=!0;[eu]=void 0;constructor(e,t,s){this[we]=this[io]=e,this[It]=t,this[no]=s}};function oo(r){return typeof r=="object"&&r!==null&&tu in r}function he(r){return r[we]}function nt(r){return`${r[It]??"public"}.${r[we]}`}var ru=class{static[h]="FakePrimitiveParam"};function ao(r){return r!=null&&typeof r.getSQL=="function"}function zm(r){let e={sql:"",params:[]};for(let t of r)e.sql+=t.sql,e.params.push(...t.params),t.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...t.typings));return e}var ce=class{static[h]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new y([this])}},y=class r{constructor(e){this.queryChunks=e;for(let t of e)if(f(t,g)){let s=t[g.Symbol.Schema];this.usedTables.push(s===void 0?t[g.Symbol.Name]:s+"."+t[g.Symbol.Name])}}static[h]="SQL";decoder=iu;shouldInlineParams=!1;usedTables=[];append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return Z.startActiveSpan("drizzle.buildSQL",t=>{let s=this.buildQueryFromSourceParams(this.queryChunks,e);return t?.setAttributes({"drizzle.query.text":s.sql,"drizzle.query.params":JSON.stringify(s.params)}),s})}buildQueryFromSourceParams(e,t){let s=Object.assign({},t,{inlineParams:t.inlineParams||this.shouldInlineParams,paramStartIndex:t.paramStartIndex||{value:0}}),{casing:i,escapeName:n,escapeParam:o,prepareTyping:a,inlineParams:l,paramStartIndex:u}=s;return zm(e.map(d=>{if(f(d,ce))return{sql:d.value.join(""),params:[]};if(f(d,ts))return{sql:n(d.value),params:[]};if(d===void 0)return{sql:"",params:[]};if(Array.isArray(d)){let m=[new ce("(")];for(let[p,C]of d.entries())m.push(C),p<d.length-1&&m.push(new ce(", "));return m.push(new ce(")")),this.buildQueryFromSourceParams(m,s)}if(f(d,r))return this.buildQueryFromSourceParams(d.queryChunks,{...s,inlineParams:l||d.shouldInlineParams});if(f(d,g)){let m=d[g.Symbol.Schema],p=d[g.Symbol.Name];return{sql:m===void 0||d[es]?n(p):n(m)+"."+n(p),params:[]}}if(f(d,L)){let m=i.getColumnCasing(d);if(t.invokeSource==="indexes")return{sql:n(m),params:[]};let p=d.table[g.Symbol.Schema];return{sql:d.table[es]||p===void 0?n(d.table[g.Symbol.Name])+"."+n(m):n(p)+"."+n(d.table[g.Symbol.Name])+"."+n(m),params:[]}}if(f(d,de)){let m=d[U].schema,p=d[U].name;return{sql:m===void 0||d[U].isAlias?n(p):n(m)+"."+n(p),params:[]}}if(f(d,pe)){if(f(d.value,ot))return{sql:o(u.value++,d),params:[d],typings:["none"]};let m=d.value===null?null:d.encoder.mapToDriverValue(d.value);if(f(m,r))return this.buildQueryFromSourceParams([m],s);if(l)return{sql:this.mapInlineParam(m,s),params:[]};let p=["none"];return a&&(p=[a(d.encoder)]),{sql:o(u.value++,m),params:[m],typings:p}}return f(d,ot)?{sql:o(u.value++,d),params:[d],typings:["none"]}:f(d,r.Aliased)&&d.fieldAlias!==void 0?{sql:n(d.fieldAlias),params:[]}:f(d,j)?d._.isWith?{sql:n(d._.alias),params:[]}:this.buildQueryFromSourceParams([new ce("("),d._.sql,new ce(") "),new ts(d._.alias)],s):Gl(d)?d.schema?{sql:n(d.schema)+"."+n(d.enumName),params:[]}:{sql:n(d.enumName),params:[]}:ao(d)?d.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([d.getSQL()],s):this.buildQueryFromSourceParams([new ce("("),d.getSQL(),new ce(")")],s):l?{sql:this.mapInlineParam(d,s),params:[]}:{sql:o(u.value++,d),params:[d],typings:["none"]}}))}mapInlineParam(e,{escapeString:t}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return t(e);if(typeof e=="object"){let s=e.toString();return t(s==="[object Object]"?JSON.stringify(e):s)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new r.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},ts=class{constructor(e){this.value=e}static[h]="Name";brand;getSQL(){return new y([this])}};function su(r){return typeof r=="object"&&r!==null&&"mapToDriverValue"in r&&typeof r.mapToDriverValue=="function"}var iu={mapFromDriverValue:r=>r},nu={mapToDriverValue:r=>r},Yb={...iu,...nu},pe=class{constructor(e,t=nu){this.value=e,this.encoder=t}static[h]="Param";brand;getSQL(){return new y([this])}};function c(r,...e){let t=[];(e.length>0||r.length>0&&r[0]!=="")&&t.push(new ce(r[0]));for(let[s,i]of e.entries())t.push(i,new ce(r[s+1]));return new y(t)}(r=>{function e(){return new y([])}r.empty=e;function t(l){return new y(l)}r.fromList=t;function s(l){return new y([new ce(l)])}r.raw=s;function i(l,u){let d=[];for(let[m,p]of l.entries())m>0&&u!==void 0&&d.push(u),d.push(p);return new y(d)}r.join=i;function n(l){return new ts(l)}r.identifier=n;function o(l){return new ot(l)}r.placeholder=o;function a(l,u){return new pe(l,u)}r.param=a})(c||(c={}));(r=>{class e{constructor(s,i){this.sql=s,this.fieldAlias=i}static[h]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}r.Aliased=e})(y||(y={}));var ot=class{constructor(e){this.name=e}static[h]="Placeholder";getSQL(){return new y([this])}};function bt(r,e){return r.map(t=>{if(f(t,ot)){if(!(t.name in e))throw new Error(`No value for placeholder "${t.name}" was provided`);return e[t.name]}if(f(t,pe)&&f(t.value,ot)){if(!(t.value.name in e))throw new Error(`No value for placeholder "${t.value.name}" was provided`);return t.encoder.mapToDriverValue(e[t.value.name])}return t})}var ou=Symbol.for("drizzle:IsDrizzleView"),de=class{static[h]="View";[U];[ou]=!0;constructor({name:e,schema:t,selectedFields:s,query:i}){this[U]={name:e,originalName:e,schema:t,selectedFields:s,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new y([this])}};function au(r){return typeof r=="object"&&r!==null&&ou in r}L.prototype.getSQL=function(){return new y([this])};g.prototype.getSQL=function(){return new y([this])};j.prototype.getSQL=function(){return new y([this])};var $t=class{constructor(e){this.table=e}static[h]="ColumnAliasProxyHandler";get(e,t){return t==="table"?this.table:e[t]}},yr=class{constructor(e,t){this.alias=e,this.replaceOriginalName=t}static[h]="TableAliasProxyHandler";get(e,t){if(t===g.Symbol.IsAlias)return!0;if(t===g.Symbol.Name)return this.alias;if(this.replaceOriginalName&&t===g.Symbol.OriginalName)return this.alias;if(t===U)return{...e[U],name:this.alias,isAlias:!0};if(t===g.Symbol.Columns){let i=e[g.Symbol.Columns];if(!i)return i;let n={};return Object.keys(i).map(o=>{n[o]=new Proxy(i[o],new $t(new Proxy(e,this)))}),n}let s=e[t];return f(s,L)?new Proxy(s,new $t(new Proxy(e,this))):s}},cu=class{constructor(e){this.alias=e}static[h]="RelationTableAliasProxyHandler";get(e,t){return t==="sourceTable"?at(e.sourceTable,this.alias):e[t]}};function at(r,e){return new Proxy(r,new yr(e,!1))}function fe(r,e){return new Proxy(r,new $t(new Proxy(r.table,new yr(e,!1))))}function rs(r,e){return new y.Aliased(wt(r.sql,e),r.fieldAlias)}function wt(r,e){return c.join(r.queryChunks.map(t=>f(t,L)?fe(t,e):f(t,y)?wt(t,e):f(t,y.Aliased)?rs(t,e):t))}var D=class r{static[h]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,t){if(t==="_")return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(t===U)return{...e[U],selectedFields:new Proxy(e[U].selectedFields,this)};if(typeof t=="symbol")return e[t];let i=(f(e,j)?e._.selectedFields:f(e,de)?e[U].selectedFields:e)[t];if(f(i,y.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!i.isSelectionField)return i.sql;let n=i.clone();return n.isSelectionField=!0,n}if(f(i,y)){if(this.config.sqlBehavior==="sql")return i;throw new Error(`You tried to reference "${t}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return f(i,L)?this.config.alias?new Proxy(i,new $t(new Proxy(i.table,new yr(this.config.alias,this.config.replaceOriginalName??!1)))):i:typeof i!="object"||i===null?i:new Proxy(i,new r(this.config))}};function ss(r,e,t){let s={},i=r.reduce((n,{path:o,field:a},l)=>{let u;f(a,L)?u=a:f(a,y)?u=a.decoder:f(a,j)?u=a._.sql.decoder:u=a.sql.decoder;let d=n;for(let[m,p]of o.entries())if(m<o.length-1)p in d||(d[p]={}),d=d[p];else{let C=e[l],S=d[p]=C===null?null:u.mapFromDriverValue(C);if(t&&f(a,L)&&o.length===2){let P=o[0];P in s?typeof s[P]=="string"&&s[P]!==he(a.table)&&(s[P]=!1):s[P]=S===null?he(a.table):!1}}return n},{});if(t&&Object.keys(s).length>0)for(let[n,o]of Object.entries(s))typeof o=="string"&&!t[o]&&(i[n]=null);return i}function ie(r,e){return Object.entries(r).reduce((t,[s,i])=>{if(typeof s!="string")return t;let n=e?[...e,s]:[s];return f(i,L)||f(i,y)||f(i,y.Aliased)||f(i,j)?t.push({path:n,field:i}):f(i,g)?t.push(...ie(i[g.Symbol.Columns],n)):t.push(...ie(i,n)),t},[])}function He(r,e){let t=Object.keys(r),s=Object.keys(e);if(t.length!==s.length)return!1;for(let[i,n]of t.entries())if(n!==s[i])return!1;return!0}function St(r,e){let t=Object.entries(e).filter(([,s])=>s!==void 0).map(([s,i])=>f(i,y)||f(i,L)?[s,i]:[s,new pe(i,r[g.Symbol.Columns][s])]);if(t.length===0)throw new Error("No values to set");return Object.fromEntries(t)}function Zs(r,e){for(let t of e)for(let s of Object.getOwnPropertyNames(t.prototype))s!=="constructor"&&Object.defineProperty(r.prototype,s,Object.getOwnPropertyDescriptor(t.prototype,s)||Object.create(null))}function br(r){return r[g.Symbol.Columns]}function lu(r){return r[U].selectedFields}function Ae(r){return f(r,j)?r._.alias:f(r,de)?r[U].name:f(r,y)?void 0:r[g.Symbol.IsAlias]?r[g.Symbol.Name]:r[g.Symbol.BaseName]}function V(r,e){return{name:typeof r=="string"&&r.length>0?r:"",config:typeof r=="object"?r:e}}function Gs(r){if(typeof r!="object"||r===null||r.constructor.name!=="Object")return!1;if("logger"in r){let e=typeof r.logger;return!(e!=="boolean"&&(e!=="object"||typeof r.logger.logQuery!="function")&&e!=="undefined")}if("schema"in r){let e=typeof r.schema;return!(e!=="object"&&e!=="undefined")}if("casing"in r){let e=typeof r.casing;return!(e!=="string"&&e!=="undefined")}if("mode"in r)return!(r.mode!=="default"||r.mode!=="planetscale"||r.mode!==void 0);if("connection"in r){let e=typeof r.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in r){let e=typeof r.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(r).length===0}var ww=typeof TextDecoder>"u"?null:new TextDecoder;var ct=class extends T{static[h]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:t,...s}=e;this.config.generatedIdentity={type:"always",sequenceName:t,sequenceOptions:s}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:t,...s}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:t,sequenceOptions:s}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}};var co=class extends ct{static[h]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new lo(e,this.config)}},lo=class extends w{static[h]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},uo=class extends ct{static[h]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new ho(e,this.config)}},ho=class extends w{static[h]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}};function uu(r,e){let{name:t,config:s}=V(r,e);return s.mode==="number"?new co(t):new uo(t)}var fo=class extends T{static[h]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new mo(e,this.config)}},mo=class extends w{static[h]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}},po=class extends T{static[h]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new go(e,this.config)}},go=class extends w{static[h]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}};function hu(r,e){let{name:t,config:s}=V(r,e);return s.mode==="number"?new fo(t):new po(t)}var yo=class extends T{static[h]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new bo(e,this.config)}},bo=class extends w{static[h]="PgBoolean";getSQLType(){return"boolean"}};function _t(r){return new yo(r??"")}var wo=class extends T{static[h]="PgCharBuilder";constructor(e,t){super(e,"string","PgChar"),this.config.length=t.length,this.config.enumValues=t.enum}build(e){return new So(e,this.config)}},So=class extends w{static[h]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}};function du(r,e={}){let{name:t,config:s}=V(r,e);return new wo(t,s)}var _o=class extends T{static[h]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new vo(e,this.config)}},vo=class extends w{static[h]="PgCidr";getSQLType(){return"cidr"}};function fu(r){return new _o(r??"")}var xo=class extends T{static[h]="PgCustomColumnBuilder";constructor(e,t,s){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=t,this.config.customTypeParams=s}build(e){return new Co(e,this.config)}},Co=class extends w{static[h]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,t){super(e,t),this.sqlName=t.customTypeParams.dataType(t.fieldConfig),this.mapTo=t.customTypeParams.toDriver,this.mapFrom=t.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function mu(r){return(e,t)=>{let{name:s,config:i}=V(e,t);return new xo(s,i,r)}}var Ze=class extends T{static[h]="PgDateColumnBaseBuilder";defaultNow(){return this.default(c`now()`)}};var To=class extends Ze{static[h]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new is(e,this.config)}},is=class extends w{static[h]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return typeof e=="string"?new Date(e):e}mapToDriverValue(e){return e.toISOString()}},No=class extends Ze{static[h]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new ns(e,this.config)}},ns=class extends w{static[h]="PgDateString";getSQLType(){return"date"}mapFromDriverValue(e){return typeof e=="string"?e:e.toISOString().slice(0,-14)}};function pu(r,e){let{name:t,config:s}=V(r,e);return s?.mode==="date"?new To(t):new No(t)}var Ao=class extends T{static[h]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new Eo(e,this.config)}},Eo=class extends w{static[h]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return typeof e=="string"?Number.parseFloat(e):e}};function gu(r){return new Ao(r??"")}var Po=class extends T{static[h]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new qo(e,this.config)}},qo=class extends w{static[h]="PgInet";getSQLType(){return"inet"}};function yu(r){return new Po(r??"")}var ko=class extends ct{static[h]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new Io(e,this.config)}},Io=class extends w{static[h]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return typeof e=="string"?Number.parseInt(e):e}};function ze(r){return new ko(r??"")}var $o=class extends T{static[h]="PgIntervalBuilder";constructor(e,t){super(e,"string","PgInterval"),this.config.intervalConfig=t}build(e){return new Oo(e,this.config)}},Oo=class extends w{static[h]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",t=this.precision?`(${this.precision})`:"";return`interval${e}${t}`}};function bu(r,e={}){let{name:t,config:s}=V(r,e);return new $o(t,s)}var Mo=class extends T{static[h]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new os(e,this.config)}},os=class extends w{static[h]="PgJson";constructor(e,t){super(e,t)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function wu(r){return new Mo(r??"")}var Lo=class extends T{static[h]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new as(e,this.config)}},as=class extends w{static[h]="PgJsonb";constructor(e,t){super(e,t)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}};function cs(r){return new Lo(r??"")}var Qo=class extends T{static[h]="PgLineBuilder";constructor(e){super(e,"array","PgLine")}build(e){return new Ro(e,this.config)}},Ro=class extends w{static[h]="PgLine";getSQLType(){return"line"}mapFromDriverValue(e){let[t,s,i]=e.slice(1,-1).split(",");return[Number.parseFloat(t),Number.parseFloat(s),Number.parseFloat(i)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}},Do=class extends T{static[h]="PgLineABCBuilder";constructor(e){super(e,"json","PgLineABC")}build(e){return new Bo(e,this.config)}},Bo=class extends w{static[h]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(e){let[t,s,i]=e.slice(1,-1).split(",");return{a:Number.parseFloat(t),b:Number.parseFloat(s),c:Number.parseFloat(i)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}};function Su(r,e){let{name:t,config:s}=V(r,e);return!s?.mode||s.mode==="tuple"?new Qo(t):new Do(t)}var jo=class extends T{static[h]="PgMacaddrBuilder";constructor(e){super(e,"string","PgMacaddr")}build(e){return new Fo(e,this.config)}},Fo=class extends w{static[h]="PgMacaddr";getSQLType(){return"macaddr"}};function _u(r){return new jo(r??"")}var zo=class extends T{static[h]="PgMacaddr8Builder";constructor(e){super(e,"string","PgMacaddr8")}build(e){return new Vo(e,this.config)}},Vo=class extends w{static[h]="PgMacaddr8";getSQLType(){return"macaddr8"}};function vu(r){return new zo(r??"")}var Uo=class extends T{static[h]="PgNumericBuilder";constructor(e,t,s){super(e,"string","PgNumeric"),this.config.precision=t,this.config.scale=s}build(e){return new ls(e,this.config)}},ls=class extends w{static[h]="PgNumeric";precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}mapFromDriverValue(e){return typeof e=="string"?e:String(e)}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}},Ko=class extends T{static[h]="PgNumericNumberBuilder";constructor(e,t,s){super(e,"number","PgNumericNumber"),this.config.precision=t,this.config.scale=s}build(e){return new Wo(e,this.config)}},Wo=class extends w{static[h]="PgNumericNumber";precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}mapToDriverValue=String;getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}},Jo=class extends T{static[h]="PgNumericBigIntBuilder";constructor(e,t,s){super(e,"bigint","PgNumericBigInt"),this.config.precision=t,this.config.scale=s}build(e){return new Ho(e,this.config)}},Ho=class extends w{static[h]="PgNumericBigInt";precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}mapFromDriverValue=BigInt;mapToDriverValue=String;getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}};function xu(r,e){let{name:t,config:s}=V(r,e),i=s?.mode;return i==="number"?new Ko(t,s?.precision,s?.scale):i==="bigint"?new Jo(t,s?.precision,s?.scale):new Uo(t,s?.precision,s?.scale)}var Zo=class extends T{static[h]="PgPointTupleBuilder";constructor(e){super(e,"array","PgPointTuple")}build(e){return new Go(e,this.config)}},Go=class extends w{static[h]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[t,s]=e.slice(1,-1).split(",");return[Number.parseFloat(t),Number.parseFloat(s)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}},Yo=class extends T{static[h]="PgPointObjectBuilder";constructor(e){super(e,"json","PgPointObject")}build(e){return new Xo(e,this.config)}},Xo=class extends w{static[h]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(e){if(typeof e=="string"){let[t,s]=e.slice(1,-1).split(",");return{x:Number.parseFloat(t),y:Number.parseFloat(s)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}};function Cu(r,e){let{name:t,config:s}=V(r,e);return!s?.mode||s.mode==="tuple"?new Zo(t):new Yo(t)}function Vm(r){let e=[];for(let t=0;t<r.length;t+=2)e.push(Number.parseInt(r.slice(t,t+2),16));return new Uint8Array(e)}function Tu(r,e){let t=new ArrayBuffer(8),s=new DataView(t);for(let i=0;i<8;i++)s.setUint8(i,r[e+i]);return s.getFloat64(0,!0)}function ea(r){let e=Vm(r),t=0,s=e[t];t+=1;let i=new DataView(e.buffer),n=i.getUint32(t,s===1);t+=4;let o;if(n&536870912&&(o=i.getUint32(t,s===1),t+=4),(n&65535)===1){let a=Tu(e,t);t+=8;let l=Tu(e,t);return t+=8,[a,l]}throw new Error("Unsupported geometry type")}var ta=class extends T{static[h]="PgGeometryBuilder";constructor(e){super(e,"array","PgGeometry")}build(e){return new ra(e,this.config)}},ra=class extends w{static[h]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return ea(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}},sa=class extends T{static[h]="PgGeometryObjectBuilder";constructor(e){super(e,"json","PgGeometryObject")}build(e){return new ia(e,this.config)}},ia=class extends w{static[h]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){let t=ea(e);return{x:t[0],y:t[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}};function Nu(r,e){let{name:t,config:s}=V(r,e);return!s?.mode||s.mode==="tuple"?new ta(t):new sa(t)}var na=class extends T{static[h]="PgRealBuilder";constructor(e,t){super(e,"number","PgReal"),this.config.length=t}build(e){return new oa(e,this.config)}},oa=class extends w{static[h]="PgReal";constructor(e,t){super(e,t)}getSQLType(){return"real"}mapFromDriverValue=e=>typeof e=="string"?Number.parseFloat(e):e};function Au(r){return new na(r??"")}var aa=class extends T{static[h]="PgSerialBuilder";constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new ca(e,this.config)}},ca=class extends w{static[h]="PgSerial";getSQLType(){return"serial"}};function Eu(r){return new aa(r??"")}var la=class extends ct{static[h]="PgSmallIntBuilder";constructor(e){super(e,"number","PgSmallInt")}build(e){return new ua(e,this.config)}},ua=class extends w{static[h]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>typeof e=="string"?Number(e):e};function Pu(r){return new la(r??"")}var ha=class extends T{static[h]="PgSmallSerialBuilder";constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new da(e,this.config)}},da=class extends w{static[h]="PgSmallSerial";getSQLType(){return"smallserial"}};function qu(r){return new ha(r??"")}var fa=class extends T{static[h]="PgTextBuilder";constructor(e,t){super(e,"string","PgText"),this.config.enumValues=t.enum}build(e){return new ma(e,this.config)}},ma=class extends w{static[h]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}};function ne(r,e={}){let{name:t,config:s}=V(r,e);return new fa(t,s)}var pa=class extends Ze{constructor(e,t,s){super(e,"string","PgTime"),this.withTimezone=t,this.precision=s,this.config.withTimezone=t,this.config.precision=s}static[h]="PgTimeBuilder";build(e){return new us(e,this.config)}},us=class extends w{static[h]="PgTime";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}};function ku(r,e={}){let{name:t,config:s}=V(r,e);return new pa(t,s.withTimezone??!1,s.precision)}var ga=class extends Ze{static[h]="PgTimestampBuilder";constructor(e,t,s){super(e,"date","PgTimestamp"),this.config.withTimezone=t,this.config.precision=s}build(e){return new hs(e,this.config)}},hs=class extends w{static[h]="PgTimestamp";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}mapFromDriverValue(e){return typeof e=="string"?new Date(this.withTimezone?e:e+"+0000"):e}mapToDriverValue=e=>e.toISOString()},ya=class extends Ze{static[h]="PgTimestampStringBuilder";constructor(e,t,s){super(e,"string","PgTimestampString"),this.config.withTimezone=t,this.config.precision=s}build(e){return new ds(e,this.config)}},ds=class extends w{static[h]="PgTimestampString";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}mapFromDriverValue(e){if(typeof e=="string")return e;let t=e.toISOString().slice(0,-1).replace("T"," ");if(this.withTimezone){let s=e.getTimezoneOffset(),i=s<=0?"+":"-";return`${t}${i}${Math.floor(Math.abs(s)/60).toString().padStart(2,"0")}`}return t}};function J(r,e={}){let{name:t,config:s}=V(r,e);return s?.mode==="string"?new ya(t,s.withTimezone??!1,s.precision):new ga(t,s?.withTimezone??!1,s?.precision)}var ba=class extends T{static[h]="PgUUIDBuilder";constructor(e){super(e,"string","PgUUID")}defaultRandom(){return this.default(c`gen_random_uuid()`)}build(e){return new fs(e,this.config)}},fs=class extends w{static[h]="PgUUID";getSQLType(){return"uuid"}};function Iu(r){return new ba(r??"")}var wa=class extends T{static[h]="PgVarcharBuilder";constructor(e,t){super(e,"string","PgVarchar"),this.config.length=t.length,this.config.enumValues=t.enum}build(e){return new Sa(e,this.config)}},Sa=class extends w{static[h]="PgVarchar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"varchar":`varchar(${this.length})`}};function A(r,e={}){let{name:t,config:s}=V(r,e);return new wa(t,s)}var _a=class extends T{static[h]="PgBinaryVectorBuilder";constructor(e,t){super(e,"string","PgBinaryVector"),this.config.dimensions=t.dimensions}build(e){return new va(e,this.config)}},va=class extends w{static[h]="PgBinaryVector";dimensions=this.config.dimensions;getSQLType(){return`bit(${this.dimensions})`}};function $u(r,e){let{name:t,config:s}=V(r,e);return new _a(t,s)}var xa=class extends T{static[h]="PgHalfVectorBuilder";constructor(e,t){super(e,"array","PgHalfVector"),this.config.dimensions=t.dimensions}build(e){return new Ca(e,this.config)}},Ca=class extends w{static[h]="PgHalfVector";dimensions=this.config.dimensions;getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(t=>Number.parseFloat(t))}};function Ou(r,e){let{name:t,config:s}=V(r,e);return new xa(t,s)}var Ta=class extends T{static[h]="PgSparseVectorBuilder";constructor(e,t){super(e,"string","PgSparseVector"),this.config.dimensions=t.dimensions}build(e){return new Na(e,this.config)}},Na=class extends w{static[h]="PgSparseVector";dimensions=this.config.dimensions;getSQLType(){return`sparsevec(${this.dimensions})`}};function Mu(r,e){let{name:t,config:s}=V(r,e);return new Ta(t,s)}var Aa=class extends T{static[h]="PgVectorBuilder";constructor(e,t){super(e,"array","PgVector"),this.config.dimensions=t.dimensions}build(e){return new Ea(e,this.config)}},Ea=class extends w{static[h]="PgVector";dimensions=this.config.dimensions;getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(t=>Number.parseFloat(t))}};function Lu(r,e){let{name:t,config:s}=V(r,e);return new Aa(t,s)}function Qu(){return{bigint:uu,bigserial:hu,boolean:_t,char:du,cidr:fu,customType:mu,date:pu,doublePrecision:gu,inet:yu,integer:ze,interval:bu,json:wu,jsonb:cs,line:Su,macaddr:_u,macaddr8:vu,numeric:xu,point:Cu,geometry:Nu,real:Au,serial:Eu,smallint:Pu,smallserial:qu,text:ne,time:ku,timestamp:J,uuid:Iu,varchar:A,bit:$u,halfvec:Ou,sparsevec:Mu,vector:Lu}}var Pa=Symbol.for("drizzle:PgInlineForeignKeys"),Ru=Symbol.for("drizzle:EnableRLS"),le=class extends g{static[h]="PgTable";static Symbol=Object.assign({},g.Symbol,{InlineForeignKeys:Pa,EnableRLS:Ru});[Pa]=[];[Ru]=!1;[g.Symbol.ExtraConfigBuilder]=void 0;[g.Symbol.ExtraConfigColumns]={}};function Um(r,e,t,s,i=r){let n=new le(r,s,i),o=typeof e=="function"?e(Qu()):e,a=Object.fromEntries(Object.entries(o).map(([d,m])=>{let p=m;p.setName(d);let C=p.build(n);return n[Pa].push(...p.buildForeignKeys(C,n)),[d,C]})),l=Object.fromEntries(Object.entries(o).map(([d,m])=>{let p=m;p.setName(d);let C=p.buildExtraConfigColumn(n);return[d,C]})),u=Object.assign(n,a);return u[g.Symbol.Columns]=a,u[g.Symbol.ExtraConfigColumns]=l,t&&(u[le.Symbol.ExtraConfigBuilder]=t),Object.assign(u,{enableRLS:()=>(u[le.Symbol.EnableRLS]=!0,u)})}var $e=(r,e,t)=>Um(r,e,t,void 0);var qa=class{constructor(e,t){this.unique=e,this.name=t}static[h]="PgIndexBuilderOn";on(...e){return new ms(e.map(t=>{if(f(t,y))return t;t=t;let s=new pr(t.name,!!t.keyAsName,t.columnType,t.indexConfig);return t.indexConfig=JSON.parse(JSON.stringify(t.defaultConfig)),s}),this.unique,!1,this.name)}onOnly(...e){return new ms(e.map(t=>{if(f(t,y))return t;t=t;let s=new pr(t.name,!!t.keyAsName,t.columnType,t.indexConfig);return t.indexConfig=t.defaultConfig,s}),this.unique,!0,this.name)}using(e,...t){return new ms(t.map(s=>{if(f(s,y))return s;s=s;let i=new pr(s.name,!!s.keyAsName,s.columnType,s.indexConfig);return s.indexConfig=JSON.parse(JSON.stringify(s.defaultConfig)),i}),this.unique,!0,this.name,e)}},ms=class{static[h]="PgIndexBuilder";config;constructor(e,t,s,i,n="btree"){this.config={name:i,columns:e,unique:t,only:s,method:n}}concurrently(){return this.config.concurrently=!0,this}with(e){return this.config.with=e,this}where(e){return this.config.where=e,this}build(e){return new ka(this.config,e)}},ka=class{static[h]="PgIndex";config;constructor(e,t){this.config={...e,table:t}}};function Du(r){return new qa(!1,r)}var Ys=class{static[h]="PgPrimaryKeyBuilder";columns;name;constructor(e,t){this.columns=e,this.name=t}build(e){return new Ia(e,this.columns,this.name)}},Ia=class{constructor(e,t,s){this.table=e,this.columns=t,this.name=s}static[h]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[le.Symbol.Name]}_${this.columns.map(e=>e.name).join("_")}_pk`}};function Km(r){return(r.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(t=>t.toLowerCase()).join("_")}function Wm(r){return(r.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((t,s,i)=>{let n=i===0?s.toLowerCase():`${s[0].toUpperCase()}${s.slice(1)}`;return t+n},"")}function Jm(r){return r}var wr=class{static[h]="CasingCache";cache={};cachedTables={};convert;constructor(e){this.convert=e==="snake_case"?Km:e==="camelCase"?Wm:Jm}getColumnCasing(e){if(!e.keyAsName)return e.name;let t=e.table[g.Symbol.Schema]??"public",s=e.table[g.Symbol.OriginalName],i=`${t}.${s}.${e.name}`;return this.cache[i]||this.cacheTable(e.table),this.cache[i]}cacheTable(e){let t=e[g.Symbol.Schema]??"public",s=e[g.Symbol.OriginalName],i=`${t}.${s}`;if(!this.cachedTables[i]){for(let n of Object.values(e[g.Symbol.Columns])){let o=`${i}.${n.name}`;this.cache[o]=this.convert(n.name)}this.cachedTables[i]=!0}}clearCache(){this.cache={},this.cachedTables={}}};var lt=class extends Error{static[h]="DrizzleError";constructor({message:e,cause:t}){super(e),this.name="DrizzleError",this.cause=t}},Se=class r extends Error{constructor(e,t,s){super(`Failed query: ${e}
params: ${t}`),this.query=e,this.params=t,this.cause=s,Error.captureStackTrace(this,r),s&&(this.cause=s)}},Sr=class extends lt{static[h]="TransactionRollbackError";constructor(){super({message:"Rollback"})}};function Ee(r,e){return su(e)&&!ao(r)&&!f(r,pe)&&!f(r,ot)&&!f(r,L)&&!f(r,g)&&!f(r,de)?new pe(r,e):r}var _r=(r,e)=>c`${r} = ${Ee(e,r)}`,Bu=(r,e)=>c`${r} <> ${Ee(e,r)}`;function vt(...r){let e=r.filter(t=>t!==void 0);if(e.length!==0)return e.length===1?new y(e):new y([new ce("("),c.join(e,new ce(" and ")),new ce(")")])}function ju(...r){let e=r.filter(t=>t!==void 0);if(e.length!==0)return e.length===1?new y(e):new y([new ce("("),c.join(e,new ce(" or ")),new ce(")")])}function Fu(r){return c`not ${r}`}var zu=(r,e)=>c`${r} > ${Ee(e,r)}`,Vu=(r,e)=>c`${r} >= ${Ee(e,r)}`,Uu=(r,e)=>c`${r} < ${Ee(e,r)}`,Ku=(r,e)=>c`${r} <= ${Ee(e,r)}`;function Wu(r,e){return Array.isArray(e)?e.length===0?c`false`:c`${r} in ${e.map(t=>Ee(t,r))}`:c`${r} in ${Ee(e,r)}`}function Ju(r,e){return Array.isArray(e)?e.length===0?c`true`:c`${r} not in ${e.map(t=>Ee(t,r))}`:c`${r} not in ${Ee(e,r)}`}function Hu(r){return c`${r} is null`}function Zu(r){return c`${r} is not null`}function Gu(r){return c`exists ${r}`}function Yu(r){return c`not exists ${r}`}function Xu(r,e,t){return c`${r} between ${Ee(e,r)} and ${Ee(t,r)}`}function eh(r,e,t){return c`${r} not between ${Ee(e,r)} and ${Ee(t,r)}`}function th(r,e){return c`${r} like ${e}`}function rh(r,e){return c`${r} not like ${e}`}function sh(r,e){return c`${r} ilike ${e}`}function ih(r,e){return c`${r} not ilike ${e}`}function nh(r){return c`${r} asc`}function oh(r){return c`${r} desc`}var Xs=class{constructor(e,t,s){this.sourceTable=e,this.referencedTable=t,this.relationName=s,this.referencedTableName=t[g.Symbol.Name]}static[h]="Relation";referencedTableName;fieldName},ei=class{constructor(e,t){this.table=e,this.config=t}static[h]="Relations"},Ge=class r extends Xs{constructor(e,t,s,i){super(e,t,s?.relationName),this.config=s,this.isNullable=i}static[h]="One";withFieldName(e){let t=new r(this.sourceTable,this.referencedTable,this.config,this.isNullable);return t.fieldName=e,t}},Ot=class r extends Xs{constructor(e,t,s){super(e,t,s?.relationName),this.config=s}static[h]="Many";withFieldName(e){let t=new r(this.sourceTable,this.referencedTable,this.config);return t.fieldName=e,t}};function ti(){return{and:vt,between:Xu,eq:_r,exists:Gu,gt:zu,gte:Vu,ilike:sh,inArray:Wu,isNull:Hu,isNotNull:Zu,like:th,lt:Uu,lte:Ku,ne:Bu,not:Fu,notBetween:eh,notExists:Yu,notLike:rh,notIlike:ih,notInArray:Ju,or:ju,sql:c}}function ri(){return{sql:c,asc:nh,desc:oh}}function si(r,e){Object.keys(r).length===1&&"default"in r&&!f(r.default,g)&&(r=r.default);let t={},s={},i={};for(let[n,o]of Object.entries(r))if(f(o,g)){let a=nt(o),l=s[a];t[a]=n,i[n]={tsName:n,dbName:o[g.Symbol.Name],schema:o[g.Symbol.Schema],columns:o[g.Symbol.Columns],relations:l?.relations??{},primaryKey:l?.primaryKey??[]};for(let d of Object.values(o[g.Symbol.Columns]))d.primary&&i[n].primaryKey.push(d);let u=o[g.Symbol.ExtraConfigBuilder]?.(o[g.Symbol.ExtraConfigColumns]);if(u)for(let d of Object.values(u))f(d,Ys)&&i[n].primaryKey.push(...d.columns)}else if(f(o,ei)){let a=nt(o.table),l=t[a],u=o.config(e(o.table)),d;for(let[m,p]of Object.entries(u))if(l){let C=i[l];C.relations[m]=p,d&&C.primaryKey.push(...d)}else a in s||(s[a]={relations:{},primaryKey:d}),s[a].relations[m]=p}return{tables:i,tableNamesMap:t}}function Qe(r,e){return new ei(r,t=>Object.fromEntries(Object.entries(e(t)).map(([s,i])=>[s,i.withFieldName(s)])))}function Hm(r){return function(t,s){return new Ge(r,t,s,s?.fields.reduce((i,n)=>i&&n.notNull,!0)??!1)}}function Zm(r){return function(t,s){return new Ot(r,t,s)}}function ii(r,e,t){if(f(t,Ge)&&t.config)return{fields:t.config.fields,references:t.config.references};let s=e[nt(t.referencedTable)];if(!s)throw new Error(`Table "${t.referencedTable[g.Symbol.Name]}" not found in schema`);let i=r[s];if(!i)throw new Error(`Table "${s}" not found in schema`);let n=t.sourceTable,o=e[nt(n)];if(!o)throw new Error(`Table "${n[g.Symbol.Name]}" not found in schema`);let a=[];for(let l of Object.values(i.relations))(t.relationName&&t!==l&&l.relationName===t.relationName||!t.relationName&&l.referencedTable===t.sourceTable)&&a.push(l);if(a.length>1)throw t.relationName?new Error(`There are multiple relations with name "${t.relationName}" in table "${s}"`):new Error(`There are multiple relations between "${s}" and "${t.sourceTable[g.Symbol.Name]}". Please specify relation name`);if(a[0]&&f(a[0],Ge)&&a[0].config)return{fields:a[0].config.references,references:a[0].config.fields};throw new Error(`There is not enough information to infer relation "${o}.${t.fieldName}"`)}function ni(r){return{one:Hm(r),many:Zm(r)}}function vr(r,e,t,s,i=n=>n){let n={};for(let[o,a]of s.entries())if(a.isJson){let l=e.relations[a.tsKey],u=t[o],d=typeof u=="string"?JSON.parse(u):u;n[a.tsKey]=f(l,Ge)?d&&vr(r,r[a.relationTableTsKey],d,a.selection,i):d.map(m=>vr(r,r[a.relationTableTsKey],m,a.selection,i))}else{let l=i(t[o]),u=a.field,d;f(u,L)?d=u:f(u,y)?d=u.decoder:d=u.sql.decoder,n[a.tsKey]=l===null?null:d.mapFromDriverValue(l)}return n}var xr=class extends de{static[h]="PgViewBase"};var xt=class{static[h]="PgDialect";casing;constructor(e){this.casing=new wr(e?.casing)}async migrate(e,t,s){let i=typeof s=="string"?"__drizzle_migrations":s.migrationsTable??"__drizzle_migrations",n=typeof s=="string"?"drizzle":s.migrationsSchema??"drizzle",o=c`
			CREATE TABLE IF NOT EXISTS ${c.identifier(n)}.${c.identifier(i)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at bigint
			)
		`;await t.execute(c`CREATE SCHEMA IF NOT EXISTS ${c.identifier(n)}`),await t.execute(o);let l=(await t.all(c`select id, hash, created_at from ${c.identifier(n)}.${c.identifier(i)} order by created_at desc limit 1`))[0];await t.transaction(async u=>{for await(let d of e)if(!l||Number(l.created_at)<d.folderMillis){for(let m of d.sql)await u.execute(c.raw(m));await u.execute(c`insert into ${c.identifier(n)}.${c.identifier(i)} ("hash", "created_at") values(${d.hash}, ${d.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let t=[c`with `];for(let[s,i]of e.entries())t.push(c`${c.identifier(i._.alias)} as (${i._.sql})`),s<e.length-1&&t.push(c`, `);return t.push(c` `),c.join(t)}buildDeleteQuery({table:e,where:t,returning:s,withList:i}){let n=this.buildWithCTE(i),o=s?c` returning ${this.buildSelection(s,{isSingleTable:!0})}`:void 0,a=t?c` where ${t}`:void 0;return c`${n}delete from ${e}${a}${o}`}buildUpdateSet(e,t){let s=e[g.Symbol.Columns],i=Object.keys(s).filter(o=>t[o]!==void 0||s[o]?.onUpdateFn!==void 0),n=i.length;return c.join(i.flatMap((o,a)=>{let l=s[o],u=l.onUpdateFn?.(),d=t[o]??(f(u,y)?u:c.param(u,l)),m=c`${c.identifier(this.casing.getColumnCasing(l))} = ${d}`;return a<n-1?[m,c.raw(", ")]:[m]}))}buildUpdateQuery({table:e,set:t,where:s,returning:i,withList:n,from:o,joins:a}){let l=this.buildWithCTE(n),u=e[le.Symbol.Name],d=e[le.Symbol.Schema],m=e[le.Symbol.OriginalName],p=u===m?void 0:u,C=c`${d?c`${c.identifier(d)}.`:void 0}${c.identifier(m)}${p&&c` ${c.identifier(p)}`}`,S=this.buildUpdateSet(e,t),P=o&&c.join([c.raw(" from "),this.buildFromTable(o)]),M=this.buildJoins(a),q=i?c` returning ${this.buildSelection(i,{isSingleTable:!o})}`:void 0,K=s?c` where ${s}`:void 0;return c`${l}update ${C} set ${S}${P}${M}${K}${q}`}buildSelection(e,{isSingleTable:t=!1}={}){let s=e.length,i=e.flatMap(({field:n},o)=>{let a=[];if(f(n,y.Aliased)&&n.isSelectionField)a.push(c.identifier(n.fieldAlias));else if(f(n,y.Aliased)||f(n,y)){let l=f(n,y.Aliased)?n.sql:n;t?a.push(new y(l.queryChunks.map(u=>f(u,w)?c.identifier(this.casing.getColumnCasing(u)):u))):a.push(l),f(n,y.Aliased)&&a.push(c` as ${c.identifier(n.fieldAlias)}`)}else if(f(n,L))t?a.push(c.identifier(this.casing.getColumnCasing(n))):a.push(n);else if(f(n,j)){let l=Object.entries(n._.selectedFields);if(l.length===1){let u=l[0][1],d=f(u,y)?u.decoder:f(u,L)?{mapFromDriverValue:m=>u.mapFromDriverValue(m)}:u.sql.decoder;d&&(n._.sql.decoder=d)}a.push(n)}return o<s-1&&a.push(c`, `),a});return c.join(i)}buildJoins(e){if(!e||e.length===0)return;let t=[];for(let[s,i]of e.entries()){s===0&&t.push(c` `);let n=i.table,o=i.lateral?c` lateral`:void 0,a=i.on?c` on ${i.on}`:void 0;if(f(n,le)){let l=n[le.Symbol.Name],u=n[le.Symbol.Schema],d=n[le.Symbol.OriginalName],m=l===d?void 0:i.alias;t.push(c`${c.raw(i.joinType)} join${o} ${u?c`${c.identifier(u)}.`:void 0}${c.identifier(d)}${m&&c` ${c.identifier(m)}`}${a}`)}else if(f(n,de)){let l=n[U].name,u=n[U].schema,d=n[U].originalName,m=l===d?void 0:i.alias;t.push(c`${c.raw(i.joinType)} join${o} ${u?c`${c.identifier(u)}.`:void 0}${c.identifier(d)}${m&&c` ${c.identifier(m)}`}${a}`)}else t.push(c`${c.raw(i.joinType)} join${o} ${n}${a}`);s<e.length-1&&t.push(c` `)}return c.join(t)}buildFromTable(e){if(f(e,g)&&e[g.Symbol.IsAlias]){let t=c`${c.identifier(e[g.Symbol.OriginalName])}`;return e[g.Symbol.Schema]&&(t=c`${c.identifier(e[g.Symbol.Schema])}.${t}`),c`${t} ${c.identifier(e[g.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:t,fieldsFlat:s,where:i,having:n,table:o,joins:a,orderBy:l,groupBy:u,limit:d,offset:m,lockingClause:p,distinct:C,setOperators:S}){let P=s??ie(t);for(let X of P)if(f(X.field,L)&&he(X.field.table)!==(f(o,j)?o._.alias:f(o,xr)?o[U].name:f(o,y)?void 0:he(o))&&!(Ce=>a?.some(({alias:zr})=>zr===(Ce[g.Symbol.IsAlias]?he(Ce):Ce[g.Symbol.BaseName])))(X.field.table)){let Ce=he(X.field.table);throw new Error(`Your "${X.path.join("->")}" field references a column "${Ce}"."${X.field.name}", but the table "${Ce}" is not part of the query! Did you forget to join it?`)}let M=!a||a.length===0,q=this.buildWithCTE(e),K;C&&(K=C===!0?c` distinct`:c` distinct on (${c.join(C.on,c`, `)})`);let z=this.buildSelection(P,{isSingleTable:M}),I=this.buildFromTable(o),ue=this.buildJoins(a),H=i?c` where ${i}`:void 0,_=n?c` having ${n}`:void 0,N;l&&l.length>0&&(N=c` order by ${c.join(l,c`, `)}`);let Y;u&&u.length>0&&(Y=c` group by ${c.join(u,c`, `)}`);let st=typeof d=="object"||typeof d=="number"&&d>=0?c` limit ${d}`:void 0,Pt=m?c` offset ${m}`:void 0,ke=c.empty();if(p){let X=c` for ${c.raw(p.strength)}`;p.config.of&&X.append(c` of ${c.join(Array.isArray(p.config.of)?p.config.of:[p.config.of],c`, `)}`),p.config.noWait?X.append(c` nowait`):p.config.skipLocked&&X.append(c` skip locked`),ke.append(X)}let ae=c`${q}select${K} ${z} from ${I}${ue}${H}${Y}${_}${N}${st}${Pt}${ke}`;return S.length>0?this.buildSetOperations(ae,S):ae}buildSetOperations(e,t){let[s,...i]=t;if(!s)throw new Error("Cannot pass undefined values to any set operator");return i.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:s}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:s}),i)}buildSetOperationQuery({leftSelect:e,setOperator:{type:t,isAll:s,rightSelect:i,limit:n,orderBy:o,offset:a}}){let l=c`(${e.getSQL()}) `,u=c`(${i.getSQL()})`,d;if(o&&o.length>0){let S=[];for(let P of o)if(f(P,w))S.push(c.identifier(P.name));else if(f(P,y)){for(let M=0;M<P.queryChunks.length;M++){let q=P.queryChunks[M];f(q,w)&&(P.queryChunks[M]=c.identifier(q.name))}S.push(c`${P}`)}else S.push(c`${P}`);d=c` order by ${c.join(S,c`, `)} `}let m=typeof n=="object"||typeof n=="number"&&n>=0?c` limit ${n}`:void 0,p=c.raw(`${t} ${s?"all ":""}`),C=a?c` offset ${a}`:void 0;return c`${l}${p}${u}${d}${m}${C}`}buildInsertQuery({table:e,values:t,onConflict:s,returning:i,withList:n,select:o,overridingSystemValue_:a}){let l=[],u=e[g.Symbol.Columns],d=Object.entries(u).filter(([q,K])=>!K.shouldDisableInsert()),m=d.map(([,q])=>c.identifier(this.casing.getColumnCasing(q)));if(o){let q=t;f(q,y)?l.push(q):l.push(q.getSQL())}else{let q=t;l.push(c.raw("values "));for(let[K,z]of q.entries()){let I=[];for(let[ue,H]of d){let _=z[ue];if(_===void 0||f(_,pe)&&_.value===void 0)if(H.defaultFn!==void 0){let N=H.defaultFn(),Y=f(N,y)?N:c.param(N,H);I.push(Y)}else if(!H.default&&H.onUpdateFn!==void 0){let N=H.onUpdateFn(),Y=f(N,y)?N:c.param(N,H);I.push(Y)}else I.push(c`default`);else I.push(_)}l.push(I),K<q.length-1&&l.push(c`, `)}}let p=this.buildWithCTE(n),C=c.join(l),S=i?c` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,P=s?c` on conflict ${s}`:void 0,M=a===!0?c`overriding system value `:void 0;return c`${p}insert into ${e} ${m} ${M}${C}${P}${S}`}buildRefreshMaterializedViewQuery({view:e,concurrently:t,withNoData:s}){let i=t?c` concurrently`:void 0,n=s?c` with no data`:void 0;return c`refresh materialized view${i} ${e}${n}`}prepareTyping(e){return f(e,as)||f(e,os)?"json":f(e,ls)?"decimal":f(e,us)?"time":f(e,hs)||f(e,ds)?"timestamp":f(e,is)||f(e,ns)?"date":f(e,fs)?"uuid":"none"}sqlToQuery(e,t){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:t})}buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:s,table:i,tableConfig:n,queryConfig:o,tableAlias:a,nestedQueryRelation:l,joinOn:u}){let d=[],m,p,C=[],S,P=[];if(o===!0)d=Object.entries(n.columns).map(([K,z])=>({dbKey:z.name,tsKey:K,field:fe(z,a),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let q=Object.fromEntries(Object.entries(n.columns).map(([_,N])=>[_,fe(N,a)]));if(o.where){let _=typeof o.where=="function"?o.where(q,ti()):o.where;S=_&&wt(_,a)}let K=[],z=[];if(o.columns){let _=!1;for(let[N,Y]of Object.entries(o.columns))Y!==void 0&&N in n.columns&&(!_&&Y===!0&&(_=!0),z.push(N));z.length>0&&(z=_?z.filter(N=>o.columns?.[N]===!0):Object.keys(n.columns).filter(N=>!z.includes(N)))}else z=Object.keys(n.columns);for(let _ of z){let N=n.columns[_];K.push({tsKey:_,value:N})}let I=[];o.with&&(I=Object.entries(o.with).filter(_=>!!_[1]).map(([_,N])=>({tsKey:_,queryConfig:N,relation:n.relations[_]})));let ue;if(o.extras){ue=typeof o.extras=="function"?o.extras(q,{sql:c}):o.extras;for(let[_,N]of Object.entries(ue))K.push({tsKey:_,value:rs(N,a)})}for(let{tsKey:_,value:N}of K)d.push({dbKey:f(N,y.Aliased)?N.fieldAlias:n.columns[_].name,tsKey:_,field:f(N,L)?fe(N,a):N,relationTableTsKey:void 0,isJson:!1,selection:[]});let H=typeof o.orderBy=="function"?o.orderBy(q,ri()):o.orderBy??[];Array.isArray(H)||(H=[H]),C=H.map(_=>f(_,L)?fe(_,a):wt(_,a)),m=o.limit,p=o.offset;for(let{tsKey:_,queryConfig:N,relation:Y}of I){let st=ii(t,s,Y),Pt=nt(Y.referencedTable),ke=s[Pt],ae=`${a}_${_}`,X=vt(...st.fields.map((Ri,Di)=>_r(fe(st.references[Di],ae),fe(Ri,a)))),Ce=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:s,table:e[ke],tableConfig:t[ke],queryConfig:f(Y,Ge)?N===!0?{limit:1}:{...N,limit:1}:N,tableAlias:ae,joinOn:X,nestedQueryRelation:Y}),zr=c`${c.identifier(ae)}.${c.identifier("data")}`.as(_);P.push({on:c`true`,table:new j(Ce.sql,{},ae),alias:ae,joinType:"left",lateral:!0}),d.push({dbKey:_,tsKey:_,field:zr,relationTableTsKey:ke,isJson:!0,selection:Ce.selection})}}if(d.length===0)throw new lt({message:`No fields selected for table "${n.tsName}" ("${a}")`});let M;if(S=vt(u,S),l){let q=c`json_build_array(${c.join(d.map(({field:I,tsKey:ue,isJson:H})=>H?c`${c.identifier(`${a}_${ue}`)}.${c.identifier("data")}`:f(I,y.Aliased)?I.sql:I),c`, `)})`;f(l,Ot)&&(q=c`coalesce(json_agg(${q}${C.length>0?c` order by ${c.join(C,c`, `)}`:void 0}), '[]'::json)`);let K=[{dbKey:"data",tsKey:"data",field:q.as("data"),isJson:!0,relationTableTsKey:n.tsName,selection:d}];m!==void 0||p!==void 0||C.length>0?(M=this.buildSelectQuery({table:at(i,a),fields:{},fieldsFlat:[{path:[],field:c.raw("*")}],where:S,limit:m,offset:p,orderBy:C,setOperators:[]}),S=void 0,m=void 0,p=void 0,C=[]):M=at(i,a),M=this.buildSelectQuery({table:f(M,le)?M:new j(M,{},a),fields:{},fieldsFlat:K.map(({field:I})=>({path:[],field:f(I,L)?fe(I,a):I})),joins:P,where:S,limit:m,offset:p,orderBy:C,setOperators:[]})}else M=this.buildSelectQuery({table:at(i,a),fields:{},fieldsFlat:d.map(({field:q})=>({path:[],field:f(q,L)?fe(q,a):q})),joins:P,where:S,limit:m,offset:p,orderBy:C,setOperators:[]});return{tableTsKey:n.tsName,sql:M,selection:d}}};var Cr=class{static[h]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var _e=class{static[h]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let t=!!this.fields,s=e,i;return this.fields?i=this.fields:f(s,j)?i=Object.fromEntries(Object.keys(s._.selectedFields).map(n=>[n,s[n]])):f(s,xr)?i=s[U].selectedFields:f(s,y)?i={}:i=br(s),new oi({table:s,fields:i,isPartialSelect:t,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},$a=class extends Cr{static[h]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;cacheConfig=void 0;usedTables=new Set;constructor({table:e,fields:t,isPartialSelect:s,session:i,dialect:n,withList:o,distinct:a}){super(),this.config={withList:o,table:e,fields:{...t},distinct:a,setOperators:[]},this.isPartialSelect=s,this.session=i,this.dialect=n,this._={selectedFields:t,config:this.config},this.tableName=Ae(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{};for(let l of Ve(e))this.usedTables.add(l)}getUsedTables(){return[...this.usedTables]}createJoin(e,t){return(s,i)=>{let n=this.tableName,o=Ae(s);for(let a of Ve(s))this.usedTables.add(a);if(typeof o=="string"&&this.config.joins?.some(a=>a.alias===o))throw new Error(`Alias "${o}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof n=="string"&&(this.config.fields={[n]:this.config.fields}),typeof o=="string"&&!f(s,y))){let a=f(s,j)?s._.selectedFields:f(s,de)?s[U].selectedFields:s[g.Symbol.Columns];this.config.fields[o]=a}if(typeof i=="function"&&(i=i(new Proxy(this.config.fields,new D({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:i,table:s,joinType:e,alias:o,lateral:t}),typeof o=="string")switch(e){case"left":{this.joinsNotNullableMap[o]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[o]=!0;break}case"cross":case"inner":{this.joinsNotNullableMap[o]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[o]=!1;break}}return this}}leftJoin=this.createJoin("left",!1);leftJoinLateral=this.createJoin("left",!0);rightJoin=this.createJoin("right",!1);innerJoin=this.createJoin("inner",!1);innerJoinLateral=this.createJoin("inner",!0);fullJoin=this.createJoin("full",!1);crossJoin=this.createJoin("cross",!1);crossJoinLateral=this.createJoin("cross",!0);createSetOperator(e,t){return s=>{let i=typeof s=="function"?s(Gm()):s;if(!He(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:t,rightSelect:i}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new D({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new D({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let t=e[0](new Proxy(this.config.fields,new D({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(t)?t:[t]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let t=e[0](new Proxy(this.config.fields,new D({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),s=Array.isArray(t)?t:[t];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=s:this.config.orderBy=s}else{let t=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=t:this.config.orderBy=t}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,t={}){return this.config.lockingClause={strength:e,config:t},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}as(e){let t=[];if(t.push(...Ve(this.config.table)),this.config.joins)for(let s of this.config.joins)t.push(...Ve(s.table));return new Proxy(new j(this.getSQL(),this.config.fields,e,!1,[...new Set(t)]),new D({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new D({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}$withCache(e){return this.cacheConfig=e===void 0?{config:{},enable:!0,autoInvalidate:!0}:e===!1?{enable:!1}:{enable:!0,autoInvalidate:!0,...e},this}},oi=class extends $a{static[h]="PgSelect";_prepare(e){let{session:t,config:s,dialect:i,joinsNotNullableMap:n,authToken:o,cacheConfig:a,usedTables:l}=this;if(!t)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");let{fields:u}=s;return Z.startActiveSpan("drizzle.prepareQuery",()=>{let d=ie(u),m=t.prepareQuery(i.sqlToQuery(this.getSQL()),d,e,!0,void 0,{type:"select",tables:[...l]},a);return m.joinsNotNullableMap=n,m.setToken(o)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>Z.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};Zs(oi,[W]);function Tr(r,e){return(t,s,...i)=>{let n=[s,...i].map(o=>({type:r,isAll:e,rightSelect:o}));for(let o of n)if(!He(t.getSelectedFields(),o.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return t.addSetOperators(n)}}var Gm=()=>({union:Ym,unionAll:Xm,intersect:ep,intersectAll:tp,except:rp,exceptAll:sp}),Ym=Tr("union",!1),Xm=Tr("union",!0),ep=Tr("intersect",!1),tp=Tr("intersect",!0),rp=Tr("except",!1),sp=Tr("except",!0);var Nr=class{static[h]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=f(e,xt)?e:void 0,this.dialectConfig=f(e,xt)?void 0:e}$with=(e,t)=>{let s=this;return{as:n=>(typeof n=="function"&&(n=n(s)),new Proxy(new Je(n.getSQL(),t??("getSelectedFields"in n?n.getSelectedFields()??{}:{}),e,!0),new D({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let t=this;function s(o){return new _e({fields:o??void 0,session:void 0,dialect:t.getDialect(),withList:e})}function i(o){return new _e({fields:o??void 0,session:void 0,dialect:t.getDialect(),distinct:!0})}function n(o,a){return new _e({fields:a??void 0,session:void 0,dialect:t.getDialect(),distinct:{on:o}})}return{select:s,selectDistinct:i,selectDistinctOn:n}}select(e){return new _e({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new _e({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,t){return new _e({fields:t??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new xt(this.dialectConfig)),this.dialect}};function Ve(r){return f(r,le)?[r[It]?`${r[It]}.${r[g.Symbol.BaseName]}`:r[g.Symbol.BaseName]]:f(r,j)?r._.usedTables??[]:f(r,y)?r.usedTables??[]:[]}var ps=class extends W{constructor(e,t,s,i){super(),this.session=t,this.dialect=s,this.config={table:e,withList:i}}static[h]="PgDelete";config;cacheConfig;where(e){return this.config.where=e,this}returning(e=this.config.table[g.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=ie(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return Z.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0,void 0,{type:"delete",tables:Ve(this.config.table)},this.cacheConfig))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>Z.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new D({alias:he(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var gs=class{constructor(e,t,s,i,n){this.table=e,this.session=t,this.dialect=s,this.withList=i,this.overridingSystemValue_=n}static[h]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let t=e.map(s=>{let i={},n=this.table[g.Symbol.Columns];for(let o of Object.keys(s)){let a=s[o];i[o]=f(a,y)?a:new pe(a,n[o])}return i});return new ai(this.table,t,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let t=typeof e=="function"?e(new Nr):e;if(!f(t,y)&&!He(this.table[gr],t._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new ai(this.table,t,this.session,this.dialect,this.withList,!0)}},ai=class extends W{constructor(e,t,s,i,n,o,a){super(),this.session=s,this.dialect=i,this.config={table:e,values:t,withList:n,select:o,overridingSystemValue_:a}}static[h]="PgInsert";config;cacheConfig;returning(e=this.config.table[g.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=ie(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=c`do nothing`;else{let t="";t=Array.isArray(e.target)?e.target.map(i=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(i))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let s=e.where?c` where ${e.where}`:void 0;this.config.onConflict=c`(${c.raw(t)})${s} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let t=e.where?c` where ${e.where}`:void 0,s=e.targetWhere?c` where ${e.targetWhere}`:void 0,i=e.setWhere?c` where ${e.setWhere}`:void 0,n=this.dialect.buildUpdateSet(this.config.table,St(this.config.table,e.set)),o="";return o=Array.isArray(e.target)?e.target.map(a=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(a))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=c`(${c.raw(o)})${s} do update set ${n}${t}${i}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return Z.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0,void 0,{type:"insert",tables:Ve(this.config.table)},this.cacheConfig))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>Z.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new D({alias:he(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var ci=class extends W{constructor(e,t,s){super(),this.session=t,this.dialect=s,this.config={view:e}}static[h]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return Z.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>Z.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var ys=class{constructor(e,t,s,i){this.table=e,this.session=t,this.dialect=s,this.withList=i}static[h]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new Oa(this.table,St(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},Oa=class extends W{constructor(e,t,s,i,n){super(),this.session=s,this.dialect=i,this.config={set:t,table:e,withList:n,joins:[]},this.tableName=Ae(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[h]="PgUpdate";config;tableName;joinsNotNullableMap;cacheConfig;from(e){let t=e,s=Ae(t);return typeof s=="string"&&(this.joinsNotNullableMap[s]=!0),this.config.from=t,this}getTableLikeFields(e){return f(e,le)?e[g.Symbol.Columns]:f(e,j)?e._.selectedFields:e[U].selectedFields}createJoin(e){return(t,s)=>{let i=Ae(t);if(typeof i=="string"&&this.config.joins.some(n=>n.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof s=="function"){let n=this.config.from&&!f(this.config.from,y)?this.getTableLikeFields(this.config.from):void 0;s=s(new Proxy(this.config.table[g.Symbol.Columns],new D({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),n&&new Proxy(n,new D({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:s,table:t,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([n])=>[n,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([n])=>[n,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[g.Symbol.Columns]),this.config.from)){let t=Ae(this.config.from);if(typeof t=="string"&&this.config.from&&!f(this.config.from,y)){let s=this.getTableLikeFields(this.config.from);e[t]=s}for(let s of this.config.joins){let i=Ae(s.table);if(typeof i=="string"&&!f(s.table,y)){let n=this.getTableLikeFields(s.table);e[i]=n}}}return this.config.returningFields=e,this.config.returning=ie(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){let t=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0,void 0,{type:"insert",tables:Ve(this.config.table)},this.cacheConfig);return t.joinsNotNullableMap=this.joinsNotNullableMap,t}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new D({alias:he(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var li=class r extends y{constructor(e){super(r.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=r.buildCount(e.source,e.filters)}sql;token;static[h]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,t){return c`(select count(*) from ${e}${c.raw(" where ").if(t)}${t})`}static buildCount(e,t){return c`select count(*) as count from ${e}${c.raw(" where ").if(t)}${t};`}setToken(e){return this.token=e,this}then(e,t){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,t)}catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}};var ui=class{constructor(e,t,s,i,n,o,a){this.fullSchema=e,this.schema=t,this.tableNamesMap=s,this.table=i,this.tableConfig=n,this.dialect=o,this.session=a}static[h]="PgRelationalQueryBuilder";findMany(e){return new hi(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new hi(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},hi=class extends W{constructor(e,t,s,i,n,o,a,l,u){super(),this.fullSchema=e,this.schema=t,this.tableNamesMap=s,this.table=i,this.tableConfig=n,this.dialect=o,this.session=a,this.config=l,this.mode=u}static[h]="PgRelationalQuery";_prepare(e){return Z.startActiveSpan("drizzle.prepareQuery",()=>{let{query:t,builtQuery:s}=this._toSQL();return this.session.prepareQuery(s,void 0,e,!0,(i,n)=>{let o=i.map(a=>vr(this.schema,this.tableConfig,a,t.selection,n));return this.mode==="first"?o[0]:o})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),t=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:t}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return Z.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var di=class extends W{constructor(e,t,s,i){super(),this.execute=e,this.sql=t,this.query=s,this.mapBatchResult=i}static[h]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,t){return t?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var Ar=class{constructor(e,t,s){if(this.dialect=e,this.session=t,this._=s?{schema:s.schema,fullSchema:s.fullSchema,tableNamesMap:s.tableNamesMap,session:t}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:t},this.query={},this._.schema)for(let[i,n]of Object.entries(this._.schema))this.query[i]=new ui(s.fullSchema,this._.schema,this._.tableNamesMap,s.fullSchema[i],n,e,t);this.$cache={invalidate:async i=>{}}}static[h]="PgDatabase";query;$with=(e,t)=>{let s=this;return{as:n=>(typeof n=="function"&&(n=n(new Nr(s.dialect))),new Proxy(new Je(n.getSQL(),t??("getSelectedFields"in n?n.getSelectedFields()??{}:{}),e,!0),new D({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,t){return new li({source:e,filters:t,session:this.session})}$cache;with(...e){let t=this;function s(u){return new _e({fields:u??void 0,session:t.session,dialect:t.dialect,withList:e})}function i(u){return new _e({fields:u??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:!0})}function n(u,d){return new _e({fields:d??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:{on:u}})}function o(u){return new ys(u,t.session,t.dialect,e)}function a(u){return new gs(u,t.session,t.dialect,e)}function l(u){return new ps(u,t.session,t.dialect,e)}return{select:s,selectDistinct:i,selectDistinctOn:n,update:o,insert:a,delete:l}}select(e){return new _e({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new _e({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,t){return new _e({fields:t??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new ys(e,this.session,this.dialect)}insert(e){return new gs(e,this.session,this.dialect)}delete(e){return new ps(e,this.session,this.dialect)}refreshMaterializedView(e){return new ci(e,this.session,this.dialect)}authToken;execute(e){let t=typeof e=="string"?c.raw(e):e.getSQL(),s=this.dialect.sqlToQuery(t),i=this.session.prepareQuery(s,void 0,void 0,!1);return new di(()=>i.execute(void 0,this.authToken),t,s,n=>i.mapResult(n,!0))}transaction(e,t){return this.session.transaction(e,t)}};var Ma=class{static[h]="Cache"},Ye=class extends Ma{strategy(){return"all"}static[h]="NoopCache";async get(e){}async put(e,t,s,i){}async onMutate(e){}};async function Er(r,e){let t=`${r}-${JSON.stringify(e)}`,i=new TextEncoder().encode(t),n=await crypto.subtle.digest("SHA-256",i);return[...new Uint8Array(n)].map(l=>l.toString(16).padStart(2,"0")).join("")}var fi=class{constructor(e,t,s,i){this.query=e,this.cache=t,this.queryMetadata=s,this.cacheConfig=i,t&&t.strategy()==="all"&&i===void 0&&(this.cacheConfig={enable:!0,autoInvalidate:!0}),this.cacheConfig?.enable||(this.cacheConfig=void 0)}authToken;getQuery(){return this.query}mapResult(e,t){return e}setToken(e){return this.authToken=e,this}static[h]="PgPreparedQuery";joinsNotNullableMap;async queryWithCache(e,t,s){if(this.cache===void 0||f(this.cache,Ye)||this.queryMetadata===void 0)try{return await s()}catch(i){throw new Se(e,t,i)}if(this.cacheConfig&&!this.cacheConfig.enable)try{return await s()}catch(i){throw new Se(e,t,i)}if((this.queryMetadata.type==="insert"||this.queryMetadata.type==="update"||this.queryMetadata.type==="delete")&&this.queryMetadata.tables.length>0)try{let[i]=await Promise.all([s(),this.cache.onMutate({tables:this.queryMetadata.tables})]);return i}catch(i){throw new Se(e,t,i)}if(!this.cacheConfig)try{return await s()}catch(i){throw new Se(e,t,i)}if(this.queryMetadata.type==="select"){let i=await this.cache.get(this.cacheConfig.tag??await Er(e,t),this.queryMetadata.tables,this.cacheConfig.tag!==void 0,this.cacheConfig.autoInvalidate);if(i===void 0){let n;try{n=await s()}catch(o){throw new Se(e,t,o)}return await this.cache.put(this.cacheConfig.tag??await Er(e,t),n,this.cacheConfig.autoInvalidate?this.queryMetadata.tables:[],this.cacheConfig.tag!==void 0,this.cacheConfig.config),n}return i}try{return await s()}catch(i){throw new Se(e,t,i)}}},mi=class{constructor(e){this.dialect=e}static[h]="PgSession";execute(e,t){return Z.startActiveSpan("drizzle.operation",()=>Z.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(t).execute(void 0,t))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,t){let s=await this.execute(e,t);return Number(s[0].count)}},pi=class extends Ar{constructor(e,t,s,i=0){super(e,t,s),this.schema=s,this.nestedIndex=i}static[h]="PgTransaction";rollback(){throw new Sr}getTransactionConfigSQL(e){let t=[];return e.isolationLevel&&t.push(`isolation level ${e.isolationLevel}`),e.accessMode&&t.push(e.accessMode),typeof e.deferrable=="boolean"&&t.push(e.deferrable?"deferrable":"not deferrable"),c.raw(t.join(" "))}setTransaction(e){return this.session.execute(c`set transaction ${this.getTransactionConfigSQL(e)}`)}};var{Pool:ip,types:Xe}=yt,La=class extends fi{constructor(e,t,s,i,n,o,a,l,u,d,m){super({sql:t,params:s},n,o,a),this.client=e,this.queryString=t,this.params=s,this.logger=i,this.fields=l,this._isResponseInArrayMode=d,this.customResultMapper=m,this.rawQueryConfig={name:u,text:t,types:{getTypeParser:(p,C)=>p===Xe.builtins.TIMESTAMPTZ?S=>S:p===Xe.builtins.TIMESTAMP?S=>S:p===Xe.builtins.DATE?S=>S:p===Xe.builtins.INTERVAL?S=>S:p===1231?S=>S:p===1115?S=>S:p===1185?S=>S:p===1187?S=>S:p===1182?S=>S:Xe.getTypeParser(p,C)}},this.queryConfig={name:u,text:t,rowMode:"array",types:{getTypeParser:(p,C)=>p===Xe.builtins.TIMESTAMPTZ?S=>S:p===Xe.builtins.TIMESTAMP?S=>S:p===Xe.builtins.DATE?S=>S:p===Xe.builtins.INTERVAL?S=>S:p===1231?S=>S:p===1115?S=>S:p===1185?S=>S:p===1187?S=>S:p===1182?S=>S:Xe.getTypeParser(p,C)}}}static[h]="NodePgPreparedQuery";rawQueryConfig;queryConfig;async execute(e={}){return Z.startActiveSpan("drizzle.execute",async()=>{let t=bt(this.params,e);this.logger.logQuery(this.rawQueryConfig.text,t);let{fields:s,rawQueryConfig:i,client:n,queryConfig:o,joinsNotNullableMap:a,customResultMapper:l}=this;if(!s&&!l)return Z.startActiveSpan("drizzle.driver.execute",async d=>(d?.setAttributes({"drizzle.query.name":i.name,"drizzle.query.text":i.text,"drizzle.query.params":JSON.stringify(t)}),this.queryWithCache(i.text,t,async()=>await n.query(i,t))));let u=await Z.startActiveSpan("drizzle.driver.execute",d=>(d?.setAttributes({"drizzle.query.name":o.name,"drizzle.query.text":o.text,"drizzle.query.params":JSON.stringify(t)}),this.queryWithCache(o.text,t,async()=>await n.query(o,t))));return Z.startActiveSpan("drizzle.mapResponse",()=>l?l(u.rows):u.rows.map(d=>ss(s,d,a)))})}all(e={}){return Z.startActiveSpan("drizzle.execute",()=>{let t=bt(this.params,e);return this.logger.logQuery(this.rawQueryConfig.text,t),Z.startActiveSpan("drizzle.driver.execute",s=>(s?.setAttributes({"drizzle.query.name":this.rawQueryConfig.name,"drizzle.query.text":this.rawQueryConfig.text,"drizzle.query.params":JSON.stringify(t)}),this.queryWithCache(this.rawQueryConfig.text,t,async()=>this.client.query(this.rawQueryConfig,t)).then(i=>i.rows)))})}isResponseInArrayMode(){return this._isResponseInArrayMode}},gi=class r extends mi{constructor(e,t,s,i={}){super(t),this.client=e,this.schema=s,this.options=i,this.logger=i.logger??new fr,this.cache=i.cache??new Ye}static[h]="NodePgSession";logger;cache;prepareQuery(e,t,s,i,n,o,a){return new La(this.client,e.sql,e.params,this.logger,this.cache,o,a,t,s,i,n)}async transaction(e,t){let s=this.client instanceof ip||Object.getPrototypeOf(this.client).constructor.name.includes("Pool"),i=s?new r(await this.client.connect(),this.dialect,this.schema,this.options):this,n=new Qa(this.dialect,i,this.schema);await n.execute(c`begin${t?c` ${n.getTransactionConfigSQL(t)}`:void 0}`);try{let o=await e(n);return await n.execute(c`commit`),o}catch(o){throw await n.execute(c`rollback`),o}finally{s&&i.client.release()}}async count(e){let t=await this.execute(e);return Number(t.rows[0].count)}},Qa=class r extends pi{static[h]="NodePgTransaction";async transaction(e){let t=`sp${this.nestedIndex+1}`,s=new r(this.dialect,this.session,this.schema,this.nestedIndex+1);await s.execute(c.raw(`savepoint ${t}`));try{let i=await e(s);return await s.execute(c.raw(`release savepoint ${t}`)),i}catch(i){throw await s.execute(c.raw(`rollback to savepoint ${t}`)),i}}};var Ra=class{constructor(e,t,s={}){this.client=e,this.dialect=t,this.options=s}static[h]="NodePgDriver";createSession(e){return new gi(this.client,this.dialect,e,{logger:this.options.logger,cache:this.options.cache})}},Da=class extends Ar{static[h]="NodePgDatabase"};function bs(r,e={}){let t=new xt({casing:e.casing}),s;e.logger===!0?s=new dr:e.logger!==!1&&(s=e.logger);let i;if(e.schema){let l=si(e.schema,ni);i={fullSchema:e.schema,schema:l.tables,tableNamesMap:l.tableNamesMap}}let o=new Ra(r,t,{logger:s,cache:e.cache}).createSession(i),a=new Da(t,o,i);return a.$client=r,a.$cache=e.cache,a.$cache&&(a.$cache.invalidate=e.cache?.onMutate),a}function yi(...r){if(typeof r[0]=="string"){let e=new yt.Pool({connectionString:r[0]});return bs(e,r[1])}if(Gs(r[0])){let{connection:e,client:t,...s}=r[0];if(t)return bs(t,s);let i=typeof e=="string"?new yt.Pool({connectionString:e}):new yt.Pool(e);return bs(i,s)}return bs(r[0],r[1])}(r=>{function e(t){return bs({},t)}r.mock=e})(yi||(yi={}));var xs=tr(require("better-sqlite3"),1);var bi=class{static[h]="SQLiteForeignKeyBuilder";reference;_onUpdate;_onDelete;constructor(e,t){this.reference=()=>{let{name:s,columns:i,foreignColumns:n}=e();return{name:s,columns:i,foreignTable:n[0].table,foreignColumns:n}},t&&(this._onUpdate=t.onUpdate,this._onDelete=t.onDelete)}onUpdate(e){return this._onUpdate=e,this}onDelete(e){return this._onDelete=e,this}build(e){return new Ba(e,this)}},Ba=class{constructor(e,t){this.table=e,this.reference=t.reference,this.onUpdate=t._onUpdate,this.onDelete=t._onDelete}static[h]="SQLiteForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:t,foreignColumns:s}=this.reference(),i=t.map(a=>a.name),n=s.map(a=>a.name),o=[this.table[we],...i,s[0].table[we],...n];return e??`${o.join("_")}_fk`}};function za(r,e){return`${r[we]}_${e.join("_")}_unique`}var ja=class{constructor(e,t){this.name=t,this.columns=e}static[h]="SQLiteUniqueConstraintBuilder";columns;build(e){return new Fa(e,this.columns,this.name)}},ah=class{static[h]="SQLiteUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new ja(e,this.name)}},Fa=class{constructor(e,t,s){this.table=e,this.columns=t,this.name=s??za(this.table,this.columns.map(i=>i.name))}static[h]="SQLiteUniqueConstraint";columns;name;getName(){return this.name}};var ch=class extends mr{static[h]="SQLiteColumnBuilder";foreignKeyConfigs=[];references(e,t={}){return this.foreignKeyConfigs.push({ref:e,actions:t}),this}unique(e){return this.config.isUnique=!0,this.config.uniqueName=e,this}generatedAlwaysAs(e,t){return this.config.generated={as:e,type:"always",mode:t?.mode??"virtual"},this}buildForeignKeys(e,t){return this.foreignKeyConfigs.map(({ref:s,actions:i})=>((n,o)=>{let a=new bi(()=>{let l=n();return{columns:[e],foreignColumns:[l]}});return o.onUpdate&&a.onUpdate(o.onUpdate),o.onDelete&&a.onDelete(o.onDelete),a.build(t)})(s,i))}},Pr=class extends L{constructor(e,t){t.uniqueName||(t.uniqueName=za(e,[t.name])),super(e,t),this.table=e}static[h]="SQLiteColumn"};var lh=Symbol.for("drizzle:SQLiteInlineForeignKeys"),ge=class extends g{static[h]="SQLiteTable";static Symbol=Object.assign({},g.Symbol,{InlineForeignKeys:lh});[g.Symbol.Columns];[lh]=[];[g.Symbol.ExtraConfigBuilder]=void 0};function Ue(r){return f(r,ge)?[`${r[g.Symbol.BaseName]}`]:f(r,j)?r._.usedTables??[]:f(r,y)?r.usedTables??[]:[]}var ws=class extends W{constructor(e,t,s,i){super(),this.table=e,this.session=t,this.dialect=s,this.config={table:e,withList:i}}static[h]="SQLiteDelete";config;where(e){return this.config.where=e,this}orderBy(...e){if(typeof e[0]=="function"){let t=e[0](new Proxy(this.config.table[g.Symbol.Columns],new D({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),s=Array.isArray(t)?t:[t];this.config.orderBy=s}else{let t=e;this.config.orderBy=t}return this}limit(e){return this.config.limit=e,this}returning(e=this.table[ge.Symbol.Columns]){return this.config.returning=ie(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e=!0){return this.session[e?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"delete",tables:Ue(this.config.table)})}prepare(){return this._prepare(!1)}run=e=>this._prepare().run(e);all=e=>this._prepare().all(e);get=e=>this._prepare().get(e);values=e=>this._prepare().values(e);async execute(e){return this._prepare().execute(e)}$dynamic(){return this}};var Ct=class extends de{static[h]="SQLiteViewBase"};var Mt=class{static[h]="SQLiteDialect";casing;constructor(e){this.casing=new wr(e?.casing)}escapeName(e){return`"${e}"`}escapeParam(e){return"?"}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let t=[c`with `];for(let[s,i]of e.entries())t.push(c`${c.identifier(i._.alias)} as (${i._.sql})`),s<e.length-1&&t.push(c`, `);return t.push(c` `),c.join(t)}buildDeleteQuery({table:e,where:t,returning:s,withList:i,limit:n,orderBy:o}){let a=this.buildWithCTE(i),l=s?c` returning ${this.buildSelection(s,{isSingleTable:!0})}`:void 0,u=t?c` where ${t}`:void 0,d=this.buildOrderBy(o),m=this.buildLimit(n);return c`${a}delete from ${e}${u}${l}${d}${m}`}buildUpdateSet(e,t){let s=e[g.Symbol.Columns],i=Object.keys(s).filter(o=>t[o]!==void 0||s[o]?.onUpdateFn!==void 0),n=i.length;return c.join(i.flatMap((o,a)=>{let l=s[o],u=l.onUpdateFn?.(),d=t[o]??(f(u,y)?u:c.param(u,l)),m=c`${c.identifier(this.casing.getColumnCasing(l))} = ${d}`;return a<n-1?[m,c.raw(", ")]:[m]}))}buildUpdateQuery({table:e,set:t,where:s,returning:i,withList:n,joins:o,from:a,limit:l,orderBy:u}){let d=this.buildWithCTE(n),m=this.buildUpdateSet(e,t),p=a&&c.join([c.raw(" from "),this.buildFromTable(a)]),C=this.buildJoins(o),S=i?c` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,P=s?c` where ${s}`:void 0,M=this.buildOrderBy(u),q=this.buildLimit(l);return c`${d}update ${e} set ${m}${p}${C}${P}${S}${M}${q}`}buildSelection(e,{isSingleTable:t=!1}={}){let s=e.length,i=e.flatMap(({field:n},o)=>{let a=[];if(f(n,y.Aliased)&&n.isSelectionField)a.push(c.identifier(n.fieldAlias));else if(f(n,y.Aliased)||f(n,y)){let l=f(n,y.Aliased)?n.sql:n;t?a.push(new y(l.queryChunks.map(u=>f(u,L)?c.identifier(this.casing.getColumnCasing(u)):u))):a.push(l),f(n,y.Aliased)&&a.push(c` as ${c.identifier(n.fieldAlias)}`)}else if(f(n,L)){let l=n.table[g.Symbol.Name];n.columnType==="SQLiteNumericBigInt"?t?a.push(c`cast(${c.identifier(this.casing.getColumnCasing(n))} as text)`):a.push(c`cast(${c.identifier(l)}.${c.identifier(this.casing.getColumnCasing(n))} as text)`):t?a.push(c.identifier(this.casing.getColumnCasing(n))):a.push(c`${c.identifier(l)}.${c.identifier(this.casing.getColumnCasing(n))}`)}else if(f(n,j)){let l=Object.entries(n._.selectedFields);if(l.length===1){let u=l[0][1],d=f(u,y)?u.decoder:f(u,L)?{mapFromDriverValue:m=>u.mapFromDriverValue(m)}:u.sql.decoder;d&&(n._.sql.decoder=d)}a.push(n)}return o<s-1&&a.push(c`, `),a});return c.join(i)}buildJoins(e){if(!e||e.length===0)return;let t=[];if(e)for(let[s,i]of e.entries()){s===0&&t.push(c` `);let n=i.table,o=i.on?c` on ${i.on}`:void 0;if(f(n,ge)){let a=n[ge.Symbol.Name],l=n[ge.Symbol.Schema],u=n[ge.Symbol.OriginalName],d=a===u?void 0:i.alias;t.push(c`${c.raw(i.joinType)} join ${l?c`${c.identifier(l)}.`:void 0}${c.identifier(u)}${d&&c` ${c.identifier(d)}`}${o}`)}else t.push(c`${c.raw(i.joinType)} join ${n}${o}`);s<e.length-1&&t.push(c` `)}return c.join(t)}buildLimit(e){return typeof e=="object"||typeof e=="number"&&e>=0?c` limit ${e}`:void 0}buildOrderBy(e){let t=[];if(e)for(let[s,i]of e.entries())t.push(i),s<e.length-1&&t.push(c`, `);return t.length>0?c` order by ${c.join(t)}`:void 0}buildFromTable(e){return f(e,g)&&e[g.Symbol.IsAlias]?c`${c`${c.identifier(e[g.Symbol.Schema]??"")}.`.if(e[g.Symbol.Schema])}${c.identifier(e[g.Symbol.OriginalName])} ${c.identifier(e[g.Symbol.Name])}`:e}buildSelectQuery({withList:e,fields:t,fieldsFlat:s,where:i,having:n,table:o,joins:a,orderBy:l,groupBy:u,limit:d,offset:m,distinct:p,setOperators:C}){let S=s??ie(t);for(let ae of S)if(f(ae.field,L)&&he(ae.field.table)!==(f(o,j)?o._.alias:f(o,Ct)?o[U].name:f(o,y)?void 0:he(o))&&!(X=>a?.some(({alias:Ce})=>Ce===(X[g.Symbol.IsAlias]?he(X):X[g.Symbol.BaseName])))(ae.field.table)){let X=he(ae.field.table);throw new Error(`Your "${ae.path.join("->")}" field references a column "${X}"."${ae.field.name}", but the table "${X}" is not part of the query! Did you forget to join it?`)}let P=!a||a.length===0,M=this.buildWithCTE(e),q=p?c` distinct`:void 0,K=this.buildSelection(S,{isSingleTable:P}),z=this.buildFromTable(o),I=this.buildJoins(a),ue=i?c` where ${i}`:void 0,H=n?c` having ${n}`:void 0,_=[];if(u)for(let[ae,X]of u.entries())_.push(X),ae<u.length-1&&_.push(c`, `);let N=_.length>0?c` group by ${c.join(_)}`:void 0,Y=this.buildOrderBy(l),st=this.buildLimit(d),Pt=m?c` offset ${m}`:void 0,ke=c`${M}select${q} ${K} from ${z}${I}${ue}${N}${H}${Y}${st}${Pt}`;return C.length>0?this.buildSetOperations(ke,C):ke}buildSetOperations(e,t){let[s,...i]=t;if(!s)throw new Error("Cannot pass undefined values to any set operator");return i.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:s}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:s}),i)}buildSetOperationQuery({leftSelect:e,setOperator:{type:t,isAll:s,rightSelect:i,limit:n,orderBy:o,offset:a}}){let l=c`${e.getSQL()} `,u=c`${i.getSQL()}`,d;if(o&&o.length>0){let S=[];for(let P of o)if(f(P,Pr))S.push(c.identifier(P.name));else if(f(P,y)){for(let M=0;M<P.queryChunks.length;M++){let q=P.queryChunks[M];f(q,Pr)&&(P.queryChunks[M]=c.identifier(this.casing.getColumnCasing(q)))}S.push(c`${P}`)}else S.push(c`${P}`);d=c` order by ${c.join(S,c`, `)}`}let m=typeof n=="object"||typeof n=="number"&&n>=0?c` limit ${n}`:void 0,p=c.raw(`${t} ${s?"all ":""}`),C=a?c` offset ${a}`:void 0;return c`${l}${p}${u}${d}${m}${C}`}buildInsertQuery({table:e,values:t,onConflict:s,returning:i,withList:n,select:o}){let a=[],l=e[g.Symbol.Columns],u=Object.entries(l).filter(([P,M])=>!M.shouldDisableInsert()),d=u.map(([,P])=>c.identifier(this.casing.getColumnCasing(P)));if(o){let P=t;f(P,y)?a.push(P):a.push(P.getSQL())}else{let P=t;a.push(c.raw("values "));for(let[M,q]of P.entries()){let K=[];for(let[z,I]of u){let ue=q[z];if(ue===void 0||f(ue,pe)&&ue.value===void 0){let H;if(I.default!==null&&I.default!==void 0)H=f(I.default,y)?I.default:c.param(I.default,I);else if(I.defaultFn!==void 0){let _=I.defaultFn();H=f(_,y)?_:c.param(_,I)}else if(!I.default&&I.onUpdateFn!==void 0){let _=I.onUpdateFn();H=f(_,y)?_:c.param(_,I)}else H=c`null`;K.push(H)}else K.push(ue)}a.push(K),M<P.length-1&&a.push(c`, `)}}let m=this.buildWithCTE(n),p=c.join(a),C=i?c` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,S=s?.length?c.join(s):void 0;return c`${m}insert into ${e} ${d} ${p}${S}${C}`}sqlToQuery(e,t){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,invokeSource:t})}buildRelationalQuery({fullSchema:e,schema:t,tableNamesMap:s,table:i,tableConfig:n,queryConfig:o,tableAlias:a,nestedQueryRelation:l,joinOn:u}){let d=[],m,p,C=[],S,P=[];if(o===!0)d=Object.entries(n.columns).map(([K,z])=>({dbKey:z.name,tsKey:K,field:fe(z,a),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let q=Object.fromEntries(Object.entries(n.columns).map(([_,N])=>[_,fe(N,a)]));if(o.where){let _=typeof o.where=="function"?o.where(q,ti()):o.where;S=_&&wt(_,a)}let K=[],z=[];if(o.columns){let _=!1;for(let[N,Y]of Object.entries(o.columns))Y!==void 0&&N in n.columns&&(!_&&Y===!0&&(_=!0),z.push(N));z.length>0&&(z=_?z.filter(N=>o.columns?.[N]===!0):Object.keys(n.columns).filter(N=>!z.includes(N)))}else z=Object.keys(n.columns);for(let _ of z){let N=n.columns[_];K.push({tsKey:_,value:N})}let I=[];o.with&&(I=Object.entries(o.with).filter(_=>!!_[1]).map(([_,N])=>({tsKey:_,queryConfig:N,relation:n.relations[_]})));let ue;if(o.extras){ue=typeof o.extras=="function"?o.extras(q,{sql:c}):o.extras;for(let[_,N]of Object.entries(ue))K.push({tsKey:_,value:rs(N,a)})}for(let{tsKey:_,value:N}of K)d.push({dbKey:f(N,y.Aliased)?N.fieldAlias:n.columns[_].name,tsKey:_,field:f(N,L)?fe(N,a):N,relationTableTsKey:void 0,isJson:!1,selection:[]});let H=typeof o.orderBy=="function"?o.orderBy(q,ri()):o.orderBy??[];Array.isArray(H)||(H=[H]),C=H.map(_=>f(_,L)?fe(_,a):wt(_,a)),m=o.limit,p=o.offset;for(let{tsKey:_,queryConfig:N,relation:Y}of I){let st=ii(t,s,Y),Pt=nt(Y.referencedTable),ke=s[Pt],ae=`${a}_${_}`,X=vt(...st.fields.map((Ri,Di)=>_r(fe(st.references[Di],ae),fe(Ri,a)))),Ce=this.buildRelationalQuery({fullSchema:e,schema:t,tableNamesMap:s,table:e[ke],tableConfig:t[ke],queryConfig:f(Y,Ge)?N===!0?{limit:1}:{...N,limit:1}:N,tableAlias:ae,joinOn:X,nestedQueryRelation:Y}),zr=c`(${Ce.sql})`.as(_);d.push({dbKey:_,tsKey:_,field:zr,relationTableTsKey:ke,isJson:!0,selection:Ce.selection})}}if(d.length===0)throw new lt({message:`No fields selected for table "${n.tsName}" ("${a}"). You need to have at least one item in "columns", "with" or "extras". If you need to select all columns, omit the "columns" key or set it to undefined.`});let M;if(S=vt(u,S),l){let q=c`json_array(${c.join(d.map(({field:I})=>f(I,Pr)?c.identifier(this.casing.getColumnCasing(I)):f(I,y.Aliased)?I.sql:I),c`, `)})`;f(l,Ot)&&(q=c`coalesce(json_group_array(${q}), json_array())`);let K=[{dbKey:"data",tsKey:"data",field:q.as("data"),isJson:!0,relationTableTsKey:n.tsName,selection:d}];m!==void 0||p!==void 0||C.length>0?(M=this.buildSelectQuery({table:at(i,a),fields:{},fieldsFlat:[{path:[],field:c.raw("*")}],where:S,limit:m,offset:p,orderBy:C,setOperators:[]}),S=void 0,m=void 0,p=void 0,C=void 0):M=at(i,a),M=this.buildSelectQuery({table:f(M,ge)?M:new j(M,{},a),fields:{},fieldsFlat:K.map(({field:I})=>({path:[],field:f(I,L)?fe(I,a):I})),joins:P,where:S,limit:m,offset:p,orderBy:C,setOperators:[]})}else M=this.buildSelectQuery({table:at(i,a),fields:{},fieldsFlat:d.map(({field:q})=>({path:[],field:f(q,L)?fe(q,a):q})),joins:P,where:S,limit:m,offset:p,orderBy:C,setOperators:[]});return{tableTsKey:n.tsName,sql:M,selection:d}}},qr=class extends Mt{static[h]="SQLiteSyncDialect";migrate(e,t,s){let i=s===void 0||typeof s=="string"?"__drizzle_migrations":s.migrationsTable??"__drizzle_migrations",n=c`
			CREATE TABLE IF NOT EXISTS ${c.identifier(i)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;t.run(n);let a=t.values(c`SELECT id, hash, created_at FROM ${c.identifier(i)} ORDER BY created_at DESC LIMIT 1`)[0]??void 0;t.run(c`BEGIN`);try{for(let l of e)if(!a||Number(a[2])<l.folderMillis){for(let u of l.sql)t.run(c.raw(u));t.run(c`INSERT INTO ${c.identifier(i)} ("hash", "created_at") VALUES(${l.hash}, ${l.folderMillis})`)}t.run(c`COMMIT`)}catch(l){throw t.run(c`ROLLBACK`),l}}},uh=class extends Mt{static[h]="SQLiteAsyncDialect";async migrate(e,t,s){let i=s===void 0||typeof s=="string"?"__drizzle_migrations":s.migrationsTable??"__drizzle_migrations",n=c`
			CREATE TABLE IF NOT EXISTS ${c.identifier(i)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;await t.run(n);let a=(await t.values(c`SELECT id, hash, created_at FROM ${c.identifier(i)} ORDER BY created_at DESC LIMIT 1`))[0]??void 0;await t.transaction(async l=>{for(let u of e)if(!a||Number(a[2])<u.folderMillis){for(let d of u.sql)await l.run(c.raw(d));await l.run(c`INSERT INTO ${c.identifier(i)} ("hash", "created_at") VALUES(${u.hash}, ${u.folderMillis})`)}})}};var Re=class{static[h]="SQLiteSelectBuilder";fields;session;dialect;withList;distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,this.withList=e.withList,this.distinct=e.distinct}from(e){let t=!!this.fields,s;return this.fields?s=this.fields:f(e,j)?s=Object.fromEntries(Object.keys(e._.selectedFields).map(i=>[i,e[i]])):f(e,Ct)?s=e[U].selectedFields:f(e,y)?s={}:s=br(e),new wi({table:e,fields:s,isPartialSelect:t,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct})}},Va=class extends Cr{static[h]="SQLiteSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;cacheConfig=void 0;usedTables=new Set;constructor({table:e,fields:t,isPartialSelect:s,session:i,dialect:n,withList:o,distinct:a}){super(),this.config={withList:o,table:e,fields:{...t},distinct:a,setOperators:[]},this.isPartialSelect=s,this.session=i,this.dialect=n,this._={selectedFields:t,config:this.config},this.tableName=Ae(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{};for(let l of Ue(e))this.usedTables.add(l)}getUsedTables(){return[...this.usedTables]}createJoin(e){return(t,s)=>{let i=this.tableName,n=Ae(t);for(let o of Ue(t))this.usedTables.add(o);if(typeof n=="string"&&this.config.joins?.some(o=>o.alias===n))throw new Error(`Alias "${n}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof i=="string"&&(this.config.fields={[i]:this.config.fields}),typeof n=="string"&&!f(t,y))){let o=f(t,j)?t._.selectedFields:f(t,de)?t[U].selectedFields:t[g.Symbol.Columns];this.config.fields[n]=o}if(typeof s=="function"&&(s=s(new Proxy(this.config.fields,new D({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:s,table:t,joinType:e,alias:n}),typeof n=="string")switch(e){case"left":{this.joinsNotNullableMap[n]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([o])=>[o,!1])),this.joinsNotNullableMap[n]=!0;break}case"cross":case"inner":{this.joinsNotNullableMap[n]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([o])=>[o,!1])),this.joinsNotNullableMap[n]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");crossJoin=this.createJoin("cross");createSetOperator(e,t){return s=>{let i=typeof s=="function"?s(np()):s;if(!He(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:t,rightSelect:i}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);except=this.createSetOperator("except",!1);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new D({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new D({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let t=e[0](new Proxy(this.config.fields,new D({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(t)?t:[t]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let t=e[0](new Proxy(this.config.fields,new D({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),s=Array.isArray(t)?t:[t];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=s:this.config.orderBy=s}else{let t=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=t:this.config.orderBy=t}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}as(e){let t=[];if(t.push(...Ue(this.config.table)),this.config.joins)for(let s of this.config.joins)t.push(...Ue(s.table));return new Proxy(new j(this.getSQL(),this.config.fields,e,!1,[...new Set(t)]),new D({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new D({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},wi=class extends Va{static[h]="SQLiteSelect";_prepare(e=!0){if(!this.session)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");let t=ie(this.config.fields),s=this.session[e?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),t,"all",!0,void 0,{type:"select",tables:[...this.usedTables]},this.cacheConfig);return s.joinsNotNullableMap=this.joinsNotNullableMap,s}$withCache(e){return this.cacheConfig=e===void 0?{config:{},enable:!0,autoInvalidate:!0}:e===!1?{enable:!1}:{enable:!0,autoInvalidate:!0,...e},this}prepare(){return this._prepare(!1)}run=e=>this._prepare().run(e);all=e=>this._prepare().all(e);get=e=>this._prepare().get(e);values=e=>this._prepare().values(e);async execute(){return this.all()}};Zs(wi,[W]);function Si(r,e){return(t,s,...i)=>{let n=[s,...i].map(o=>({type:r,isAll:e,rightSelect:o}));for(let o of n)if(!He(t.getSelectedFields(),o.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return t.addSetOperators(n)}}var np=()=>({union:op,unionAll:ap,intersect:cp,except:lp}),op=Si("union",!1),ap=Si("union",!0),cp=Si("intersect",!1),lp=Si("except",!1);var kr=class{static[h]="SQLiteQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=f(e,Mt)?e:void 0,this.dialectConfig=f(e,Mt)?void 0:e}$with=(e,t)=>{let s=this;return{as:n=>(typeof n=="function"&&(n=n(s)),new Proxy(new Je(n.getSQL(),t??("getSelectedFields"in n?n.getSelectedFields()??{}:{}),e,!0),new D({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let t=this;function s(n){return new Re({fields:n??void 0,session:void 0,dialect:t.getDialect(),withList:e})}function i(n){return new Re({fields:n??void 0,session:void 0,dialect:t.getDialect(),withList:e,distinct:!0})}return{select:s,selectDistinct:i}}select(e){return new Re({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new Re({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}getDialect(){return this.dialect||(this.dialect=new qr(this.dialectConfig)),this.dialect}};var Ss=class{constructor(e,t,s,i){this.table=e,this.session=t,this.dialect=s,this.withList=i}static[h]="SQLiteInsertBuilder";values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let t=e.map(s=>{let i={},n=this.table[g.Symbol.Columns];for(let o of Object.keys(s)){let a=s[o];i[o]=f(a,y)?a:new pe(a,n[o])}return i});return new _i(this.table,t,this.session,this.dialect,this.withList)}select(e){let t=typeof e=="function"?e(new kr):e;if(!f(t,y)&&!He(this.table[gr],t._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new _i(this.table,t,this.session,this.dialect,this.withList,!0)}},_i=class extends W{constructor(e,t,s,i,n,o){super(),this.session=s,this.dialect=i,this.config={table:e,values:t,withList:n,select:o}}static[h]="SQLiteInsert";config;returning(e=this.config.table[ge.Symbol.Columns]){return this.config.returning=ie(e),this}onConflictDoNothing(e={}){if(this.config.onConflict||(this.config.onConflict=[]),e.target===void 0)this.config.onConflict.push(c` on conflict do nothing`);else{let t=Array.isArray(e.target)?c`${e.target}`:c`${[e.target]}`,s=e.where?c` where ${e.where}`:c``;this.config.onConflict.push(c` on conflict ${t} do nothing${s}`)}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');this.config.onConflict||(this.config.onConflict=[]);let t=e.where?c` where ${e.where}`:void 0,s=e.targetWhere?c` where ${e.targetWhere}`:void 0,i=e.setWhere?c` where ${e.setWhere}`:void 0,n=Array.isArray(e.target)?c`${e.target}`:c`${[e.target]}`,o=this.dialect.buildUpdateSet(this.config.table,St(this.config.table,e.set));return this.config.onConflict.push(c` on conflict ${n}${s} do update set ${o}${t}${i}`),this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e=!0){return this.session[e?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"insert",tables:Ue(this.config.table)})}prepare(){return this._prepare(!1)}run=e=>this._prepare().run(e);all=e=>this._prepare().all(e);get=e=>this._prepare().get(e);values=e=>this._prepare().values(e);async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}};var _s=class{constructor(e,t,s,i){this.table=e,this.session=t,this.dialect=s,this.withList=i}static[h]="SQLiteUpdateBuilder";set(e){return new Ua(this.table,St(this.table,e),this.session,this.dialect,this.withList)}},Ua=class extends W{constructor(e,t,s,i,n){super(),this.session=s,this.dialect=i,this.config={set:t,table:e,withList:n,joins:[]}}static[h]="SQLiteUpdate";config;from(e){return this.config.from=e,this}createJoin(e){return(t,s)=>{let i=Ae(t);if(typeof i=="string"&&this.config.joins.some(n=>n.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof s=="function"){let n=this.config.from?f(t,ge)?t[g.Symbol.Columns]:f(t,j)?t._.selectedFields:f(t,Ct)?t[U].selectedFields:void 0:void 0;s=s(new Proxy(this.config.table[g.Symbol.Columns],new D({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),n&&new Proxy(n,new D({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}return this.config.joins.push({on:s,table:t,joinType:e,alias:i}),this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}orderBy(...e){if(typeof e[0]=="function"){let t=e[0](new Proxy(this.config.table[g.Symbol.Columns],new D({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),s=Array.isArray(t)?t:[t];this.config.orderBy=s}else{let t=e;this.config.orderBy=t}return this}limit(e){return this.config.limit=e,this}returning(e=this.config.table[ge.Symbol.Columns]){return this.config.returning=ie(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e=!0){return this.session[e?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"insert",tables:Ue(this.config.table)})}prepare(){return this._prepare(!1)}run=e=>this._prepare().run(e);all=e=>this._prepare().all(e);get=e=>this._prepare().get(e);values=e=>this._prepare().values(e);async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}};var vi=class r extends y{constructor(e){super(r.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.session=e.session,this.sql=r.buildCount(e.source,e.filters)}sql;static[h]="SQLiteCountBuilderAsync";[Symbol.toStringTag]="SQLiteCountBuilderAsync";session;static buildEmbeddedCount(e,t){return c`(select count(*) from ${e}${c.raw(" where ").if(t)}${t})`}static buildCount(e,t){return c`select count(*) from ${e}${c.raw(" where ").if(t)}${t}`}then(e,t){return Promise.resolve(this.session.count(this.sql)).then(e,t)}catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}};var xi=class{constructor(e,t,s,i,n,o,a,l){this.mode=e,this.fullSchema=t,this.schema=s,this.tableNamesMap=i,this.table=n,this.tableConfig=o,this.dialect=a,this.session=l}static[h]="SQLiteAsyncRelationalQueryBuilder";findMany(e){return this.mode==="sync"?new Ci(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many"):new vs(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return this.mode==="sync"?new Ci(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first"):new vs(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},vs=class extends W{constructor(e,t,s,i,n,o,a,l,u){super(),this.fullSchema=e,this.schema=t,this.tableNamesMap=s,this.table=i,this.tableConfig=n,this.dialect=o,this.session=a,this.config=l,this.mode=u}static[h]="SQLiteAsyncRelationalQuery";mode;getSQL(){return this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}).sql}_prepare(e=!1){let{query:t,builtQuery:s}=this._toSQL();return this.session[e?"prepareOneTimeQuery":"prepareQuery"](s,void 0,this.mode==="first"?"get":"all",!0,(i,n)=>{let o=i.map(a=>vr(this.schema,this.tableConfig,a,t.selection,n));return this.mode==="first"?o[0]:o})}prepare(){return this._prepare(!1)}_toSQL(){let e=this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}),t=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:t}}toSQL(){return this._toSQL().builtQuery}executeRaw(){return this.mode==="first"?this._prepare(!1).get():this._prepare(!1).all()}async execute(){return this.executeRaw()}},Ci=class extends vs{static[h]="SQLiteSyncRelationalQuery";sync(){return this.executeRaw()}};var Lt=class extends W{constructor(e,t,s,i,n){super(),this.execute=e,this.getSQL=t,this.dialect=i,this.mapBatchResult=n,this.config={action:s}}static[h]="SQLiteRaw";config;getQuery(){return{...this.dialect.sqlToQuery(this.getSQL()),method:this.config.action}}mapResult(e,t){return t?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var Ir=class{constructor(e,t,s,i){this.resultKind=e,this.dialect=t,this.session=s,this._=i?{schema:i.schema,fullSchema:i.fullSchema,tableNamesMap:i.tableNamesMap}:{schema:void 0,fullSchema:{},tableNamesMap:{}},this.query={};let n=this.query;if(this._.schema)for(let[o,a]of Object.entries(this._.schema))n[o]=new xi(e,i.fullSchema,this._.schema,this._.tableNamesMap,i.fullSchema[o],a,t,s);this.$cache={invalidate:async o=>{}}}static[h]="BaseSQLiteDatabase";query;$with=(e,t)=>{let s=this;return{as:n=>(typeof n=="function"&&(n=n(new kr(s.dialect))),new Proxy(new Je(n.getSQL(),t??("getSelectedFields"in n?n.getSelectedFields()??{}:{}),e,!0),new D({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,t){return new vi({source:e,filters:t,session:this.session})}with(...e){let t=this;function s(l){return new Re({fields:l??void 0,session:t.session,dialect:t.dialect,withList:e})}function i(l){return new Re({fields:l??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:!0})}function n(l){return new _s(l,t.session,t.dialect,e)}function o(l){return new Ss(l,t.session,t.dialect,e)}function a(l){return new ws(l,t.session,t.dialect,e)}return{select:s,selectDistinct:i,update:n,insert:o,delete:a}}select(e){return new Re({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new Re({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}update(e){return new _s(e,this.session,this.dialect)}$cache;insert(e){return new Ss(e,this.session,this.dialect)}delete(e){return new ws(e,this.session,this.dialect)}run(e){let t=typeof e=="string"?c.raw(e):e.getSQL();return this.resultKind==="async"?new Lt(async()=>this.session.run(t),()=>t,"run",this.dialect,this.session.extractRawRunValueFromBatchResult.bind(this.session)):this.session.run(t)}all(e){let t=typeof e=="string"?c.raw(e):e.getSQL();return this.resultKind==="async"?new Lt(async()=>this.session.all(t),()=>t,"all",this.dialect,this.session.extractRawAllValueFromBatchResult.bind(this.session)):this.session.all(t)}get(e){let t=typeof e=="string"?c.raw(e):e.getSQL();return this.resultKind==="async"?new Lt(async()=>this.session.get(t),()=>t,"get",this.dialect,this.session.extractRawGetValueFromBatchResult.bind(this.session)):this.session.get(t)}values(e){let t=typeof e=="string"?c.raw(e):e.getSQL();return this.resultKind==="async"?new Lt(async()=>this.session.values(t),()=>t,"values",this.dialect,this.session.extractRawValuesValueFromBatchResult.bind(this.session)):this.session.values(t)}transaction(e,t){return this.session.transaction(e,t)}};var Ka=class extends W{constructor(e){super(),this.resultCb=e}static[h]="ExecuteResultSync";async execute(){return this.resultCb()}sync(){return this.resultCb()}},Ti=class{constructor(e,t,s,i,n,o){this.mode=e,this.executeMethod=t,this.query=s,this.cache=i,this.queryMetadata=n,this.cacheConfig=o,i&&i.strategy()==="all"&&o===void 0&&(this.cacheConfig={enable:!0,autoInvalidate:!0}),this.cacheConfig?.enable||(this.cacheConfig=void 0)}static[h]="PreparedQuery";joinsNotNullableMap;async queryWithCache(e,t,s){if(this.cache===void 0||f(this.cache,Ye)||this.queryMetadata===void 0)try{return await s()}catch(i){throw new Se(e,t,i)}if(this.cacheConfig&&!this.cacheConfig.enable)try{return await s()}catch(i){throw new Se(e,t,i)}if((this.queryMetadata.type==="insert"||this.queryMetadata.type==="update"||this.queryMetadata.type==="delete")&&this.queryMetadata.tables.length>0)try{let[i]=await Promise.all([s(),this.cache.onMutate({tables:this.queryMetadata.tables})]);return i}catch(i){throw new Se(e,t,i)}if(!this.cacheConfig)try{return await s()}catch(i){throw new Se(e,t,i)}if(this.queryMetadata.type==="select"){let i=await this.cache.get(this.cacheConfig.tag??await Er(e,t),this.queryMetadata.tables,this.cacheConfig.tag!==void 0,this.cacheConfig.autoInvalidate);if(i===void 0){let n;try{n=await s()}catch(o){throw new Se(e,t,o)}return await this.cache.put(this.cacheConfig.tag??await Er(e,t),n,this.cacheConfig.autoInvalidate?this.queryMetadata.tables:[],this.cacheConfig.tag!==void 0,this.cacheConfig.config),n}return i}try{return await s()}catch(i){throw new Se(e,t,i)}}getQuery(){return this.query}mapRunResult(e,t){return e}mapAllResult(e,t){throw new Error("Not implemented")}mapGetResult(e,t){throw new Error("Not implemented")}execute(e){return this.mode==="async"?this[this.executeMethod](e):new Ka(()=>this[this.executeMethod](e))}mapResult(e,t){switch(this.executeMethod){case"run":return this.mapRunResult(e,t);case"all":return this.mapAllResult(e,t);case"get":return this.mapGetResult(e,t)}}},Ni=class{constructor(e){this.dialect=e}static[h]="SQLiteSession";prepareOneTimeQuery(e,t,s,i,n,o,a){return this.prepareQuery(e,t,s,i,n,o,a)}run(e){let t=this.dialect.sqlToQuery(e);try{return this.prepareOneTimeQuery(t,void 0,"run",!1).run()}catch(s){throw new lt({cause:s,message:`Failed to run the query '${t.sql}'`})}}extractRawRunValueFromBatchResult(e){return e}all(e){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(e),void 0,"run",!1).all()}extractRawAllValueFromBatchResult(e){throw new Error("Not implemented")}get(e){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(e),void 0,"run",!1).get()}extractRawGetValueFromBatchResult(e){throw new Error("Not implemented")}values(e){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(e),void 0,"run",!1).values()}async count(e){return(await this.values(e))[0][0]}extractRawValuesValueFromBatchResult(e){throw new Error("Not implemented")}},Ai=class extends Ir{constructor(e,t,s,i,n=0){super(e,t,s,i),this.schema=i,this.nestedIndex=n}static[h]="SQLiteTransaction";rollback(){throw new Sr}};var Ei=class extends Ni{constructor(e,t,s,i={}){super(t),this.client=e,this.schema=s,this.logger=i.logger??new fr,this.cache=i.cache??new Ye}static[h]="BetterSQLiteSession";logger;cache;prepareQuery(e,t,s,i,n,o,a){let l=this.client.prepare(e.sql);return new Ja(l,e,this.logger,this.cache,o,a,t,s,i,n)}transaction(e,t={}){let s=new Wa("sync",this.dialect,this,this.schema);return this.client.transaction(e)[t.behavior??"deferred"](s)}},Wa=class r extends Ai{static[h]="BetterSQLiteTransaction";transaction(e){let t=`sp${this.nestedIndex}`,s=new r("sync",this.dialect,this.session,this.schema,this.nestedIndex+1);this.session.run(c.raw(`savepoint ${t}`));try{let i=e(s);return this.session.run(c.raw(`release savepoint ${t}`)),i}catch(i){throw this.session.run(c.raw(`rollback to savepoint ${t}`)),i}}},Ja=class extends Ti{constructor(e,t,s,i,n,o,a,l,u,d){super("sync",l,t,i,n,o),this.stmt=e,this.logger=s,this.fields=a,this._isResponseInArrayMode=u,this.customResultMapper=d}static[h]="BetterSQLitePreparedQuery";run(e){let t=bt(this.query.params,e??{});return this.logger.logQuery(this.query.sql,t),this.stmt.run(...t)}all(e){let{fields:t,joinsNotNullableMap:s,query:i,logger:n,stmt:o,customResultMapper:a}=this;if(!t&&!a){let u=bt(i.params,e??{});return n.logQuery(i.sql,u),o.all(...u)}let l=this.values(e);return a?a(l):l.map(u=>ss(t,u,s))}get(e){let t=bt(this.query.params,e??{});this.logger.logQuery(this.query.sql,t);let{fields:s,stmt:i,joinsNotNullableMap:n,customResultMapper:o}=this;if(!s&&!o)return i.get(...t);let a=i.raw().get(...t);if(a)return o?o([a]):ss(s,a,n)}values(e){let t=bt(this.query.params,e??{});return this.logger.logQuery(this.query.sql,t),this.stmt.raw().all(...t)}isResponseInArrayMode(){return this._isResponseInArrayMode}};var Ha=class extends Ir{static[h]="BetterSQLite3Database"};function $r(r,e={}){let t=new qr({casing:e.casing}),s;e.logger===!0?s=new dr:e.logger!==!1&&(s=e.logger);let i;if(e.schema){let a=si(e.schema,ni);i={fullSchema:e.schema,schema:a.tables,tableNamesMap:a.tableNamesMap}}let n=new Ei(r,t,i,{logger:s}),o=new Ha("sync",t,n,i);return o.$client=r,o}function Pi(...r){if(r[0]===void 0||typeof r[0]=="string"){let e=r[0]===void 0?new xs.default:new xs.default(r[0]);return $r(e,r[1])}if(Gs(r[0])){let{connection:e,client:t,...s}=r[0];if(t)return $r(t,s);if(typeof e=="object"){let{source:n,...o}=e,a=new xs.default(n,o);return $r(a,s)}let i=new xs.default(e);return $r(i,s)}return $r(r[0],r[1])}(r=>{function e(t){return $r({},t)}r.mock=e})(Pi||(Pi={}));var Nh=tr(require("better-sqlite3"),1);var Li={};Xa(Li,{chapters:()=>We,chaptersRelations:()=>Og,comments:()=>er,commentsRelations:()=>Qg,documents:()=>ks,documentsRelations:()=>Ig,flashcards:()=>Mi,flashcardsRelations:()=>Bg,insertChapterSchema:()=>zg,insertCommentSchema:()=>Kg,insertDocumentSchema:()=>$g,insertFlashcardSchema:()=>Zg,insertMilestoneSchema:()=>Ug,insertReferenceSchema:()=>Wg,insertResearchEntrySchema:()=>Th,insertSharedAccessSchema:()=>Jg,insertTaskSchema:()=>Vg,insertThesisSchema:()=>Fg,insertUserSchema:()=>jg,journalEntrySchema:()=>Hg,milestones:()=>As,milestonesRelations:()=>Lg,references:()=>Es,referencesRelations:()=>Rg,researchEntries:()=>qs,researchEntriesRelations:()=>Dg,sessions:()=>Eg,sharedAccess:()=>Ps,sharedAccessRelations:()=>kg,tasks:()=>Xt,tasksRelations:()=>Mg,theses:()=>G,thesesRelations:()=>qg,users:()=>Oe,usersRelations:()=>Pg});var be={};Xa(be,{BRAND:()=>Mp,DIRTY:()=>Qt,EMPTY_PATH:()=>fp,INVALID:()=>k,NEVER:()=>wg,OK:()=>ve,ParseStatus:()=>ye,Schema:()=>B,ZodAny:()=>At,ZodArray:()=>ft,ZodBigInt:()=>Dt,ZodBoolean:()=>Bt,ZodBranded:()=>Ts,ZodCatch:()=>Gt,ZodDate:()=>jt,ZodDefault:()=>Zt,ZodDiscriminatedUnion:()=>Ii,ZodEffects:()=>je,ZodEnum:()=>Jt,ZodError:()=>Pe,ZodFirstPartyTypeKind:()=>$,ZodFunction:()=>Oi,ZodIntersection:()=>Ut,ZodIssueCode:()=>b,ZodLazy:()=>Kt,ZodLiteral:()=>Wt,ZodMap:()=>Dr,ZodNaN:()=>jr,ZodNativeEnum:()=>Ht,ZodNever:()=>Ke,ZodNull:()=>zt,ZodNullable:()=>rt,ZodNumber:()=>Rt,ZodObject:()=>qe,ZodOptional:()=>De,ZodParsedType:()=>x,ZodPipeline:()=>Ns,ZodPromise:()=>Et,ZodReadonly:()=>Yt,ZodRecord:()=>$i,ZodSchema:()=>B,ZodSet:()=>Br,ZodString:()=>Nt,ZodSymbol:()=>Qr,ZodTransformer:()=>je,ZodTuple:()=>tt,ZodType:()=>B,ZodUndefined:()=>Ft,ZodUnion:()=>Vt,ZodUnknown:()=>dt,ZodVoid:()=>Rr,addIssueToContext:()=>v,any:()=>Vp,array:()=>Jp,bigint:()=>Dp,boolean:()=>_h,coerce:()=>bg,custom:()=>bh,date:()=>Bp,datetimeRegex:()=>gh,defaultErrorMap:()=>ut,discriminatedUnion:()=>Yp,effect:()=>ug,enum:()=>ag,function:()=>ig,getErrorMap:()=>Or,getParsedType:()=>et,instanceof:()=>Qp,intersection:()=>Xp,isAborted:()=>qi,isAsync:()=>Mr,isDirty:()=>ki,isValid:()=>Tt,late:()=>Lp,lazy:()=>ng,literal:()=>og,makeIssue:()=>Cs,map:()=>rg,nan:()=>Rp,nativeEnum:()=>cg,never:()=>Kp,null:()=>zp,nullable:()=>dg,number:()=>Sh,object:()=>Hp,objectUtil:()=>Za,oboolean:()=>yg,onumber:()=>gg,optional:()=>hg,ostring:()=>pg,pipeline:()=>mg,preprocess:()=>fg,promise:()=>lg,quotelessJson:()=>up,record:()=>tg,set:()=>sg,setErrorMap:()=>dp,strictObject:()=>Zp,string:()=>wh,symbol:()=>jp,transformer:()=>ug,tuple:()=>eg,undefined:()=>Fp,union:()=>Gp,unknown:()=>Up,util:()=>F,void:()=>Wp});var F;(function(r){r.assertEqual=i=>{};function e(i){}r.assertIs=e;function t(i){throw new Error}r.assertNever=t,r.arrayToEnum=i=>{let n={};for(let o of i)n[o]=o;return n},r.getValidEnumValues=i=>{let n=r.objectKeys(i).filter(a=>typeof i[i[a]]!="number"),o={};for(let a of n)o[a]=i[a];return r.objectValues(o)},r.objectValues=i=>r.objectKeys(i).map(function(n){return i[n]}),r.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{let n=[];for(let o in i)Object.prototype.hasOwnProperty.call(i,o)&&n.push(o);return n},r.find=(i,n)=>{for(let o of i)if(n(o))return o},r.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&Number.isFinite(i)&&Math.floor(i)===i;function s(i,n=" | "){return i.map(o=>typeof o=="string"?`'${o}'`:o).join(n)}r.joinValues=s,r.jsonStringifyReplacer=(i,n)=>typeof n=="bigint"?n.toString():n})(F||(F={}));var Za;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(Za||(Za={}));var x=F.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),et=r=>{switch(typeof r){case"undefined":return x.undefined;case"string":return x.string;case"number":return Number.isNaN(r)?x.nan:x.number;case"boolean":return x.boolean;case"function":return x.function;case"bigint":return x.bigint;case"symbol":return x.symbol;case"object":return Array.isArray(r)?x.array:r===null?x.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?x.promise:typeof Map<"u"&&r instanceof Map?x.map:typeof Set<"u"&&r instanceof Set?x.set:typeof Date<"u"&&r instanceof Date?x.date:x.object;default:return x.unknown}};var b=F.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),up=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:"),Pe=class r extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(n){return n.message},s={_errors:[]},i=n=>{for(let o of n.issues)if(o.code==="invalid_union")o.unionErrors.map(i);else if(o.code==="invalid_return_type")i(o.returnTypeError);else if(o.code==="invalid_arguments")i(o.argumentsError);else if(o.path.length===0)s._errors.push(t(o));else{let a=s,l=0;for(;l<o.path.length;){let u=o.path[l];l===o.path.length-1?(a[u]=a[u]||{_errors:[]},a[u]._errors.push(t(o))):a[u]=a[u]||{_errors:[]},a=a[u],l++}}};return i(this),s}static assert(e){if(!(e instanceof r))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,F.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){let t={},s=[];for(let i of this.issues)if(i.path.length>0){let n=i.path[0];t[n]=t[n]||[],t[n].push(e(i))}else s.push(e(i));return{formErrors:s,fieldErrors:t}}get formErrors(){return this.flatten()}};Pe.create=r=>new Pe(r);var hp=(r,e)=>{let t;switch(r.code){case b.invalid_type:r.received===x.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case b.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,F.jsonStringifyReplacer)}`;break;case b.unrecognized_keys:t=`Unrecognized key(s) in object: ${F.joinValues(r.keys,", ")}`;break;case b.invalid_union:t="Invalid input";break;case b.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${F.joinValues(r.options)}`;break;case b.invalid_enum_value:t=`Invalid enum value. Expected ${F.joinValues(r.options)}, received '${r.received}'`;break;case b.invalid_arguments:t="Invalid function arguments";break;case b.invalid_return_type:t="Invalid function return type";break;case b.invalid_date:t="Invalid date";break;case b.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:F.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case b.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="bigint"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case b.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case b.custom:t="Invalid input";break;case b.invalid_intersection_types:t="Intersection results could not be merged";break;case b.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case b.not_finite:t="Number must be finite";break;default:t=e.defaultError,F.assertNever(r)}return{message:t}},ut=hp;var hh=ut;function dp(r){hh=r}function Or(){return hh}var Cs=r=>{let{data:e,path:t,errorMaps:s,issueData:i}=r,n=[...t,...i.path||[]],o={...i,path:n};if(i.message!==void 0)return{...i,path:n,message:i.message};let a="",l=s.filter(u=>!!u).slice().reverse();for(let u of l)a=u(o,{data:e,defaultError:a}).message;return{...i,path:n,message:a}},fp=[];function v(r,e){let t=Or(),s=Cs({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===ut?void 0:ut].filter(i=>!!i)});r.common.issues.push(s)}var ye=class r{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let s=[];for(let i of t){if(i.status==="aborted")return k;i.status==="dirty"&&e.dirty(),s.push(i.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,t){let s=[];for(let i of t){let n=await i.key,o=await i.value;s.push({key:n,value:o})}return r.mergeObjectSync(e,s)}static mergeObjectSync(e,t){let s={};for(let i of t){let{key:n,value:o}=i;if(n.status==="aborted"||o.status==="aborted")return k;n.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),n.value!=="__proto__"&&(typeof o.value<"u"||i.alwaysSet)&&(s[n.value]=o.value)}return{status:e.value,value:s}}},k=Object.freeze({status:"aborted"}),Qt=r=>({status:"dirty",value:r}),ve=r=>({status:"valid",value:r}),qi=r=>r.status==="aborted",ki=r=>r.status==="dirty",Tt=r=>r.status==="valid",Mr=r=>typeof Promise<"u"&&r instanceof Promise;var E;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e?.message})(E||(E={}));var Be=class{constructor(e,t,s,i){this._cachedPath=[],this.parent=e,this.data=t,this._path=s,this._key=i}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},dh=(r,e)=>{if(Tt(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new Pe(r.common.issues);return this._error=t,this._error}}};function Q(r){if(!r)return{};let{errorMap:e,invalid_type_error:t,required_error:s,description:i}=r;if(e&&(t||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(o,a)=>{let{message:l}=r;return o.code==="invalid_enum_value"?{message:l??a.defaultError}:typeof a.data>"u"?{message:l??s??a.defaultError}:o.code!=="invalid_type"?{message:a.defaultError}:{message:l??t??a.defaultError}},description:i}}var B=class{get description(){return this._def.description}_getType(e){return et(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:et(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ye,ctx:{common:e.parent.common,data:e.data,parsedType:et(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(Mr(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let s=this.safeParse(e,t);if(s.success)return s.data;throw s.error}safeParse(e,t){let s={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:et(e)},i=this._parseSync({data:e,path:s.path,parent:s});return dh(s,i)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:et(e)};if(!this["~standard"].async)try{let s=this._parseSync({data:e,path:[],parent:t});return Tt(s)?{value:s.value}:{issues:t.common.issues}}catch(s){s?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(s=>Tt(s)?{value:s.value}:{issues:t.common.issues})}async parseAsync(e,t){let s=await this.safeParseAsync(e,t);if(s.success)return s.data;throw s.error}async safeParseAsync(e,t){let s={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:et(e)},i=this._parse({data:e,path:s.path,parent:s}),n=await(Mr(i)?i:Promise.resolve(i));return dh(s,n)}refine(e,t){let s=i=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(i):t;return this._refinement((i,n)=>{let o=e(i),a=()=>n.addIssue({code:b.custom,...s(i)});return typeof Promise<"u"&&o instanceof Promise?o.then(l=>l?!0:(a(),!1)):o?!0:(a(),!1)})}refinement(e,t){return this._refinement((s,i)=>e(s)?!0:(i.addIssue(typeof t=="function"?t(s,i):t),!1))}_refinement(e){return new je({schema:this,typeName:$.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return De.create(this,this._def)}nullable(){return rt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ft.create(this)}promise(){return Et.create(this,this._def)}or(e){return Vt.create([this,e],this._def)}and(e){return Ut.create(this,e,this._def)}transform(e){return new je({...Q(this._def),schema:this,typeName:$.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t=typeof e=="function"?e:()=>e;return new Zt({...Q(this._def),innerType:this,defaultValue:t,typeName:$.ZodDefault})}brand(){return new Ts({typeName:$.ZodBranded,type:this,...Q(this._def)})}catch(e){let t=typeof e=="function"?e:()=>e;return new Gt({...Q(this._def),innerType:this,catchValue:t,typeName:$.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Ns.create(this,e)}readonly(){return Yt.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},mp=/^c[^\s-]{8,}$/i,pp=/^[0-9a-z]+$/,gp=/^[0-9A-HJKMNP-TV-Z]{26}$/i,yp=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,bp=/^[a-z0-9_-]{21}$/i,wp=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Sp=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,_p=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,vp="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Ga,xp=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Cp=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Tp=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Np=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Ap=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Ep=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,mh="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Pp=new RegExp(`^${mh}$`);function ph(r){let e="[0-5]\\d";r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`);let t=r.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function qp(r){return new RegExp(`^${ph(r)}$`)}function gh(r){let e=`${mh}T${ph(r)}`,t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function kp(r,e){return!!((e==="v4"||!e)&&xp.test(r)||(e==="v6"||!e)&&Tp.test(r))}function Ip(r,e){if(!wp.test(r))return!1;try{let[t]=r.split(".");if(!t)return!1;let s=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),i=JSON.parse(atob(s));return!(typeof i!="object"||i===null||"typ"in i&&i?.typ!=="JWT"||!i.alg||e&&i.alg!==e)}catch{return!1}}function $p(r,e){return!!((e==="v4"||!e)&&Cp.test(r)||(e==="v6"||!e)&&Np.test(r))}var Nt=class r extends B{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==x.string){let n=this._getOrReturnCtx(e);return v(n,{code:b.invalid_type,expected:x.string,received:n.parsedType}),k}let s=new ye,i;for(let n of this._def.checks)if(n.kind==="min")e.data.length<n.value&&(i=this._getOrReturnCtx(e,i),v(i,{code:b.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),s.dirty());else if(n.kind==="max")e.data.length>n.value&&(i=this._getOrReturnCtx(e,i),v(i,{code:b.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),s.dirty());else if(n.kind==="length"){let o=e.data.length>n.value,a=e.data.length<n.value;(o||a)&&(i=this._getOrReturnCtx(e,i),o?v(i,{code:b.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}):a&&v(i,{code:b.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}),s.dirty())}else if(n.kind==="email")_p.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"email",code:b.invalid_string,message:n.message}),s.dirty());else if(n.kind==="emoji")Ga||(Ga=new RegExp(vp,"u")),Ga.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"emoji",code:b.invalid_string,message:n.message}),s.dirty());else if(n.kind==="uuid")yp.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"uuid",code:b.invalid_string,message:n.message}),s.dirty());else if(n.kind==="nanoid")bp.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"nanoid",code:b.invalid_string,message:n.message}),s.dirty());else if(n.kind==="cuid")mp.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"cuid",code:b.invalid_string,message:n.message}),s.dirty());else if(n.kind==="cuid2")pp.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"cuid2",code:b.invalid_string,message:n.message}),s.dirty());else if(n.kind==="ulid")gp.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"ulid",code:b.invalid_string,message:n.message}),s.dirty());else if(n.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),v(i,{validation:"url",code:b.invalid_string,message:n.message}),s.dirty()}else n.kind==="regex"?(n.regex.lastIndex=0,n.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"regex",code:b.invalid_string,message:n.message}),s.dirty())):n.kind==="trim"?e.data=e.data.trim():n.kind==="includes"?e.data.includes(n.value,n.position)||(i=this._getOrReturnCtx(e,i),v(i,{code:b.invalid_string,validation:{includes:n.value,position:n.position},message:n.message}),s.dirty()):n.kind==="toLowerCase"?e.data=e.data.toLowerCase():n.kind==="toUpperCase"?e.data=e.data.toUpperCase():n.kind==="startsWith"?e.data.startsWith(n.value)||(i=this._getOrReturnCtx(e,i),v(i,{code:b.invalid_string,validation:{startsWith:n.value},message:n.message}),s.dirty()):n.kind==="endsWith"?e.data.endsWith(n.value)||(i=this._getOrReturnCtx(e,i),v(i,{code:b.invalid_string,validation:{endsWith:n.value},message:n.message}),s.dirty()):n.kind==="datetime"?gh(n).test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{code:b.invalid_string,validation:"datetime",message:n.message}),s.dirty()):n.kind==="date"?Pp.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{code:b.invalid_string,validation:"date",message:n.message}),s.dirty()):n.kind==="time"?qp(n).test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{code:b.invalid_string,validation:"time",message:n.message}),s.dirty()):n.kind==="duration"?Sp.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"duration",code:b.invalid_string,message:n.message}),s.dirty()):n.kind==="ip"?kp(e.data,n.version)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"ip",code:b.invalid_string,message:n.message}),s.dirty()):n.kind==="jwt"?Ip(e.data,n.alg)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"jwt",code:b.invalid_string,message:n.message}),s.dirty()):n.kind==="cidr"?$p(e.data,n.version)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"cidr",code:b.invalid_string,message:n.message}),s.dirty()):n.kind==="base64"?Ap.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"base64",code:b.invalid_string,message:n.message}),s.dirty()):n.kind==="base64url"?Ep.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"base64url",code:b.invalid_string,message:n.message}),s.dirty()):F.assertNever(n);return{status:s.value,value:e.data}}_regex(e,t,s){return this.refinement(i=>e.test(i),{validation:t,code:b.invalid_string,...E.errToObj(s)})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...E.errToObj(e)})}url(e){return this._addCheck({kind:"url",...E.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...E.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...E.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...E.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...E.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...E.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...E.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...E.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...E.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...E.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...E.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...E.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...E.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...E.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...E.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...E.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...E.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...E.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...E.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...E.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...E.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...E.errToObj(t)})}nonempty(e){return this.min(1,E.errToObj(e))}trim(){return new r({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};Nt.create=r=>new Nt({checks:[],typeName:$.ZodString,coerce:r?.coerce??!1,...Q(r)});function Op(r,e){let t=(r.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,i=t>s?t:s,n=Number.parseInt(r.toFixed(i).replace(".","")),o=Number.parseInt(e.toFixed(i).replace(".",""));return n%o/10**i}var Rt=class r extends B{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==x.number){let n=this._getOrReturnCtx(e);return v(n,{code:b.invalid_type,expected:x.number,received:n.parsedType}),k}let s,i=new ye;for(let n of this._def.checks)n.kind==="int"?F.isInteger(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{code:b.invalid_type,expected:"integer",received:"float",message:n.message}),i.dirty()):n.kind==="min"?(n.inclusive?e.data<n.value:e.data<=n.value)&&(s=this._getOrReturnCtx(e,s),v(s,{code:b.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),i.dirty()):n.kind==="max"?(n.inclusive?e.data>n.value:e.data>=n.value)&&(s=this._getOrReturnCtx(e,s),v(s,{code:b.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),i.dirty()):n.kind==="multipleOf"?Op(e.data,n.value)!==0&&(s=this._getOrReturnCtx(e,s),v(s,{code:b.not_multiple_of,multipleOf:n.value,message:n.message}),i.dirty()):n.kind==="finite"?Number.isFinite(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{code:b.not_finite,message:n.message}),i.dirty()):F.assertNever(n);return{status:i.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,E.toString(t))}gt(e,t){return this.setLimit("min",e,!1,E.toString(t))}lte(e,t){return this.setLimit("max",e,!0,E.toString(t))}lt(e,t){return this.setLimit("max",e,!1,E.toString(t))}setLimit(e,t,s,i){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:E.toString(i)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:E.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:E.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:E.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:E.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:E.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:E.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:E.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:E.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:E.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&F.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(t===null||s.value>t)&&(t=s.value):s.kind==="max"&&(e===null||s.value<e)&&(e=s.value)}return Number.isFinite(t)&&Number.isFinite(e)}};Rt.create=r=>new Rt({checks:[],typeName:$.ZodNumber,coerce:r?.coerce||!1,...Q(r)});var Dt=class r extends B{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==x.bigint)return this._getInvalidInput(e);let s,i=new ye;for(let n of this._def.checks)n.kind==="min"?(n.inclusive?e.data<n.value:e.data<=n.value)&&(s=this._getOrReturnCtx(e,s),v(s,{code:b.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),i.dirty()):n.kind==="max"?(n.inclusive?e.data>n.value:e.data>=n.value)&&(s=this._getOrReturnCtx(e,s),v(s,{code:b.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),i.dirty()):n.kind==="multipleOf"?e.data%n.value!==BigInt(0)&&(s=this._getOrReturnCtx(e,s),v(s,{code:b.not_multiple_of,multipleOf:n.value,message:n.message}),i.dirty()):F.assertNever(n);return{status:i.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return v(t,{code:b.invalid_type,expected:x.bigint,received:t.parsedType}),k}gte(e,t){return this.setLimit("min",e,!0,E.toString(t))}gt(e,t){return this.setLimit("min",e,!1,E.toString(t))}lte(e,t){return this.setLimit("max",e,!0,E.toString(t))}lt(e,t){return this.setLimit("max",e,!1,E.toString(t))}setLimit(e,t,s,i){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:E.toString(i)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:E.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:E.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:E.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:E.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:E.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};Dt.create=r=>new Dt({checks:[],typeName:$.ZodBigInt,coerce:r?.coerce??!1,...Q(r)});var Bt=class extends B{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==x.boolean){let s=this._getOrReturnCtx(e);return v(s,{code:b.invalid_type,expected:x.boolean,received:s.parsedType}),k}return ve(e.data)}};Bt.create=r=>new Bt({typeName:$.ZodBoolean,coerce:r?.coerce||!1,...Q(r)});var jt=class r extends B{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==x.date){let n=this._getOrReturnCtx(e);return v(n,{code:b.invalid_type,expected:x.date,received:n.parsedType}),k}if(Number.isNaN(e.data.getTime())){let n=this._getOrReturnCtx(e);return v(n,{code:b.invalid_date}),k}let s=new ye,i;for(let n of this._def.checks)n.kind==="min"?e.data.getTime()<n.value&&(i=this._getOrReturnCtx(e,i),v(i,{code:b.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),s.dirty()):n.kind==="max"?e.data.getTime()>n.value&&(i=this._getOrReturnCtx(e,i),v(i,{code:b.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),s.dirty()):F.assertNever(n);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:E.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:E.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};jt.create=r=>new jt({checks:[],coerce:r?.coerce||!1,typeName:$.ZodDate,...Q(r)});var Qr=class extends B{_parse(e){if(this._getType(e)!==x.symbol){let s=this._getOrReturnCtx(e);return v(s,{code:b.invalid_type,expected:x.symbol,received:s.parsedType}),k}return ve(e.data)}};Qr.create=r=>new Qr({typeName:$.ZodSymbol,...Q(r)});var Ft=class extends B{_parse(e){if(this._getType(e)!==x.undefined){let s=this._getOrReturnCtx(e);return v(s,{code:b.invalid_type,expected:x.undefined,received:s.parsedType}),k}return ve(e.data)}};Ft.create=r=>new Ft({typeName:$.ZodUndefined,...Q(r)});var zt=class extends B{_parse(e){if(this._getType(e)!==x.null){let s=this._getOrReturnCtx(e);return v(s,{code:b.invalid_type,expected:x.null,received:s.parsedType}),k}return ve(e.data)}};zt.create=r=>new zt({typeName:$.ZodNull,...Q(r)});var At=class extends B{constructor(){super(...arguments),this._any=!0}_parse(e){return ve(e.data)}};At.create=r=>new At({typeName:$.ZodAny,...Q(r)});var dt=class extends B{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ve(e.data)}};dt.create=r=>new dt({typeName:$.ZodUnknown,...Q(r)});var Ke=class extends B{_parse(e){let t=this._getOrReturnCtx(e);return v(t,{code:b.invalid_type,expected:x.never,received:t.parsedType}),k}};Ke.create=r=>new Ke({typeName:$.ZodNever,...Q(r)});var Rr=class extends B{_parse(e){if(this._getType(e)!==x.undefined){let s=this._getOrReturnCtx(e);return v(s,{code:b.invalid_type,expected:x.void,received:s.parsedType}),k}return ve(e.data)}};Rr.create=r=>new Rr({typeName:$.ZodVoid,...Q(r)});var ft=class r extends B{_parse(e){let{ctx:t,status:s}=this._processInputParams(e),i=this._def;if(t.parsedType!==x.array)return v(t,{code:b.invalid_type,expected:x.array,received:t.parsedType}),k;if(i.exactLength!==null){let o=t.data.length>i.exactLength.value,a=t.data.length<i.exactLength.value;(o||a)&&(v(t,{code:o?b.too_big:b.too_small,minimum:a?i.exactLength.value:void 0,maximum:o?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),s.dirty())}if(i.minLength!==null&&t.data.length<i.minLength.value&&(v(t,{code:b.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),s.dirty()),i.maxLength!==null&&t.data.length>i.maxLength.value&&(v(t,{code:b.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),s.dirty()),t.common.async)return Promise.all([...t.data].map((o,a)=>i.type._parseAsync(new Be(t,o,t.path,a)))).then(o=>ye.mergeArray(s,o));let n=[...t.data].map((o,a)=>i.type._parseSync(new Be(t,o,t.path,a)));return ye.mergeArray(s,n)}get element(){return this._def.type}min(e,t){return new r({...this._def,minLength:{value:e,message:E.toString(t)}})}max(e,t){return new r({...this._def,maxLength:{value:e,message:E.toString(t)}})}length(e,t){return new r({...this._def,exactLength:{value:e,message:E.toString(t)}})}nonempty(e){return this.min(1,e)}};ft.create=(r,e)=>new ft({type:r,minLength:null,maxLength:null,exactLength:null,typeName:$.ZodArray,...Q(e)});function Lr(r){if(r instanceof qe){let e={};for(let t in r.shape){let s=r.shape[t];e[t]=De.create(Lr(s))}return new qe({...r._def,shape:()=>e})}else return r instanceof ft?new ft({...r._def,type:Lr(r.element)}):r instanceof De?De.create(Lr(r.unwrap())):r instanceof rt?rt.create(Lr(r.unwrap())):r instanceof tt?tt.create(r.items.map(e=>Lr(e))):r}var qe=class r extends B{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),t=F.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==x.object){let u=this._getOrReturnCtx(e);return v(u,{code:b.invalid_type,expected:x.object,received:u.parsedType}),k}let{status:s,ctx:i}=this._processInputParams(e),{shape:n,keys:o}=this._getCached(),a=[];if(!(this._def.catchall instanceof Ke&&this._def.unknownKeys==="strip"))for(let u in i.data)o.includes(u)||a.push(u);let l=[];for(let u of o){let d=n[u],m=i.data[u];l.push({key:{status:"valid",value:u},value:d._parse(new Be(i,m,i.path,u)),alwaysSet:u in i.data})}if(this._def.catchall instanceof Ke){let u=this._def.unknownKeys;if(u==="passthrough")for(let d of a)l.push({key:{status:"valid",value:d},value:{status:"valid",value:i.data[d]}});else if(u==="strict")a.length>0&&(v(i,{code:b.unrecognized_keys,keys:a}),s.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let u=this._def.catchall;for(let d of a){let m=i.data[d];l.push({key:{status:"valid",value:d},value:u._parse(new Be(i,m,i.path,d)),alwaysSet:d in i.data})}}return i.common.async?Promise.resolve().then(async()=>{let u=[];for(let d of l){let m=await d.key,p=await d.value;u.push({key:m,value:p,alwaysSet:d.alwaysSet})}return u}).then(u=>ye.mergeObjectSync(s,u)):ye.mergeObjectSync(s,l)}get shape(){return this._def.shape()}strict(e){return E.errToObj,new r({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,s)=>{let i=this._def.errorMap?.(t,s).message??s.defaultError;return t.code==="unrecognized_keys"?{message:E.errToObj(e).message??i}:{message:i}}}:{}})}strip(){return new r({...this._def,unknownKeys:"strip"})}passthrough(){return new r({...this._def,unknownKeys:"passthrough"})}extend(e){return new r({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new r({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:$.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new r({...this._def,catchall:e})}pick(e){let t={};for(let s of F.objectKeys(e))e[s]&&this.shape[s]&&(t[s]=this.shape[s]);return new r({...this._def,shape:()=>t})}omit(e){let t={};for(let s of F.objectKeys(this.shape))e[s]||(t[s]=this.shape[s]);return new r({...this._def,shape:()=>t})}deepPartial(){return Lr(this)}partial(e){let t={};for(let s of F.objectKeys(this.shape)){let i=this.shape[s];e&&!e[s]?t[s]=i:t[s]=i.optional()}return new r({...this._def,shape:()=>t})}required(e){let t={};for(let s of F.objectKeys(this.shape))if(e&&!e[s])t[s]=this.shape[s];else{let n=this.shape[s];for(;n instanceof De;)n=n._def.innerType;t[s]=n}return new r({...this._def,shape:()=>t})}keyof(){return yh(F.objectKeys(this.shape))}};qe.create=(r,e)=>new qe({shape:()=>r,unknownKeys:"strip",catchall:Ke.create(),typeName:$.ZodObject,...Q(e)});qe.strictCreate=(r,e)=>new qe({shape:()=>r,unknownKeys:"strict",catchall:Ke.create(),typeName:$.ZodObject,...Q(e)});qe.lazycreate=(r,e)=>new qe({shape:r,unknownKeys:"strip",catchall:Ke.create(),typeName:$.ZodObject,...Q(e)});var Vt=class extends B{_parse(e){let{ctx:t}=this._processInputParams(e),s=this._def.options;function i(n){for(let a of n)if(a.result.status==="valid")return a.result;for(let a of n)if(a.result.status==="dirty")return t.common.issues.push(...a.ctx.common.issues),a.result;let o=n.map(a=>new Pe(a.ctx.common.issues));return v(t,{code:b.invalid_union,unionErrors:o}),k}if(t.common.async)return Promise.all(s.map(async n=>{let o={...t,common:{...t.common,issues:[]},parent:null};return{result:await n._parseAsync({data:t.data,path:t.path,parent:o}),ctx:o}})).then(i);{let n,o=[];for(let l of s){let u={...t,common:{...t.common,issues:[]},parent:null},d=l._parseSync({data:t.data,path:t.path,parent:u});if(d.status==="valid")return d;d.status==="dirty"&&!n&&(n={result:d,ctx:u}),u.common.issues.length&&o.push(u.common.issues)}if(n)return t.common.issues.push(...n.ctx.common.issues),n.result;let a=o.map(l=>new Pe(l));return v(t,{code:b.invalid_union,unionErrors:a}),k}}get options(){return this._def.options}};Vt.create=(r,e)=>new Vt({options:r,typeName:$.ZodUnion,...Q(e)});var ht=r=>r instanceof Kt?ht(r.schema):r instanceof je?ht(r.innerType()):r instanceof Wt?[r.value]:r instanceof Jt?r.options:r instanceof Ht?F.objectValues(r.enum):r instanceof Zt?ht(r._def.innerType):r instanceof Ft?[void 0]:r instanceof zt?[null]:r instanceof De?[void 0,...ht(r.unwrap())]:r instanceof rt?[null,...ht(r.unwrap())]:r instanceof Ts||r instanceof Yt?ht(r.unwrap()):r instanceof Gt?ht(r._def.innerType):[],Ii=class r extends B{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==x.object)return v(t,{code:b.invalid_type,expected:x.object,received:t.parsedType}),k;let s=this.discriminator,i=t.data[s],n=this.optionsMap.get(i);return n?t.common.async?n._parseAsync({data:t.data,path:t.path,parent:t}):n._parseSync({data:t.data,path:t.path,parent:t}):(v(t,{code:b.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),k)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,s){let i=new Map;for(let n of t){let o=ht(n.shape[e]);if(!o.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let a of o){if(i.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);i.set(a,n)}}return new r({typeName:$.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:i,...Q(s)})}};function Ya(r,e){let t=et(r),s=et(e);if(r===e)return{valid:!0,data:r};if(t===x.object&&s===x.object){let i=F.objectKeys(e),n=F.objectKeys(r).filter(a=>i.indexOf(a)!==-1),o={...r,...e};for(let a of n){let l=Ya(r[a],e[a]);if(!l.valid)return{valid:!1};o[a]=l.data}return{valid:!0,data:o}}else if(t===x.array&&s===x.array){if(r.length!==e.length)return{valid:!1};let i=[];for(let n=0;n<r.length;n++){let o=r[n],a=e[n],l=Ya(o,a);if(!l.valid)return{valid:!1};i.push(l.data)}return{valid:!0,data:i}}else return t===x.date&&s===x.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}var Ut=class extends B{_parse(e){let{status:t,ctx:s}=this._processInputParams(e),i=(n,o)=>{if(qi(n)||qi(o))return k;let a=Ya(n.value,o.value);return a.valid?((ki(n)||ki(o))&&t.dirty(),{status:t.value,value:a.data}):(v(s,{code:b.invalid_intersection_types}),k)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([n,o])=>i(n,o)):i(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}};Ut.create=(r,e,t)=>new Ut({left:r,right:e,typeName:$.ZodIntersection,...Q(t)});var tt=class r extends B{_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==x.array)return v(s,{code:b.invalid_type,expected:x.array,received:s.parsedType}),k;if(s.data.length<this._def.items.length)return v(s,{code:b.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),k;!this._def.rest&&s.data.length>this._def.items.length&&(v(s,{code:b.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let n=[...s.data].map((o,a)=>{let l=this._def.items[a]||this._def.rest;return l?l._parse(new Be(s,o,s.path,a)):null}).filter(o=>!!o);return s.common.async?Promise.all(n).then(o=>ye.mergeArray(t,o)):ye.mergeArray(t,n)}get items(){return this._def.items}rest(e){return new r({...this._def,rest:e})}};tt.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new tt({items:r,typeName:$.ZodTuple,rest:null,...Q(e)})};var $i=class r extends B{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==x.object)return v(s,{code:b.invalid_type,expected:x.object,received:s.parsedType}),k;let i=[],n=this._def.keyType,o=this._def.valueType;for(let a in s.data)i.push({key:n._parse(new Be(s,a,s.path,a)),value:o._parse(new Be(s,s.data[a],s.path,a)),alwaysSet:a in s.data});return s.common.async?ye.mergeObjectAsync(t,i):ye.mergeObjectSync(t,i)}get element(){return this._def.valueType}static create(e,t,s){return t instanceof B?new r({keyType:e,valueType:t,typeName:$.ZodRecord,...Q(s)}):new r({keyType:Nt.create(),valueType:e,typeName:$.ZodRecord,...Q(t)})}},Dr=class extends B{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==x.map)return v(s,{code:b.invalid_type,expected:x.map,received:s.parsedType}),k;let i=this._def.keyType,n=this._def.valueType,o=[...s.data.entries()].map(([a,l],u)=>({key:i._parse(new Be(s,a,s.path,[u,"key"])),value:n._parse(new Be(s,l,s.path,[u,"value"]))}));if(s.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let l of o){let u=await l.key,d=await l.value;if(u.status==="aborted"||d.status==="aborted")return k;(u.status==="dirty"||d.status==="dirty")&&t.dirty(),a.set(u.value,d.value)}return{status:t.value,value:a}})}else{let a=new Map;for(let l of o){let u=l.key,d=l.value;if(u.status==="aborted"||d.status==="aborted")return k;(u.status==="dirty"||d.status==="dirty")&&t.dirty(),a.set(u.value,d.value)}return{status:t.value,value:a}}}};Dr.create=(r,e,t)=>new Dr({valueType:e,keyType:r,typeName:$.ZodMap,...Q(t)});var Br=class r extends B{_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==x.set)return v(s,{code:b.invalid_type,expected:x.set,received:s.parsedType}),k;let i=this._def;i.minSize!==null&&s.data.size<i.minSize.value&&(v(s,{code:b.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),t.dirty()),i.maxSize!==null&&s.data.size>i.maxSize.value&&(v(s,{code:b.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),t.dirty());let n=this._def.valueType;function o(l){let u=new Set;for(let d of l){if(d.status==="aborted")return k;d.status==="dirty"&&t.dirty(),u.add(d.value)}return{status:t.value,value:u}}let a=[...s.data.values()].map((l,u)=>n._parse(new Be(s,l,s.path,u)));return s.common.async?Promise.all(a).then(l=>o(l)):o(a)}min(e,t){return new r({...this._def,minSize:{value:e,message:E.toString(t)}})}max(e,t){return new r({...this._def,maxSize:{value:e,message:E.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};Br.create=(r,e)=>new Br({valueType:r,minSize:null,maxSize:null,typeName:$.ZodSet,...Q(e)});var Oi=class r extends B{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==x.function)return v(t,{code:b.invalid_type,expected:x.function,received:t.parsedType}),k;function s(a,l){return Cs({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Or(),ut].filter(u=>!!u),issueData:{code:b.invalid_arguments,argumentsError:l}})}function i(a,l){return Cs({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Or(),ut].filter(u=>!!u),issueData:{code:b.invalid_return_type,returnTypeError:l}})}let n={errorMap:t.common.contextualErrorMap},o=t.data;if(this._def.returns instanceof Et){let a=this;return ve(async function(...l){let u=new Pe([]),d=await a._def.args.parseAsync(l,n).catch(C=>{throw u.addIssue(s(l,C)),u}),m=await Reflect.apply(o,this,d);return await a._def.returns._def.type.parseAsync(m,n).catch(C=>{throw u.addIssue(i(m,C)),u})})}else{let a=this;return ve(function(...l){let u=a._def.args.safeParse(l,n);if(!u.success)throw new Pe([s(l,u.error)]);let d=Reflect.apply(o,this,u.data),m=a._def.returns.safeParse(d,n);if(!m.success)throw new Pe([i(d,m.error)]);return m.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new r({...this._def,args:tt.create(e).rest(dt.create())})}returns(e){return new r({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,s){return new r({args:e||tt.create([]).rest(dt.create()),returns:t||dt.create(),typeName:$.ZodFunction,...Q(s)})}},Kt=class extends B{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};Kt.create=(r,e)=>new Kt({getter:r,typeName:$.ZodLazy,...Q(e)});var Wt=class extends B{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return v(t,{received:t.data,code:b.invalid_literal,expected:this._def.value}),k}return{status:"valid",value:e.data}}get value(){return this._def.value}};Wt.create=(r,e)=>new Wt({value:r,typeName:$.ZodLiteral,...Q(e)});function yh(r,e){return new Jt({values:r,typeName:$.ZodEnum,...Q(e)})}var Jt=class r extends B{_parse(e){if(typeof e.data!="string"){let t=this._getOrReturnCtx(e),s=this._def.values;return v(t,{expected:F.joinValues(s),received:t.parsedType,code:b.invalid_type}),k}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),s=this._def.values;return v(t,{received:t.data,code:b.invalid_enum_value,options:s}),k}return ve(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return r.create(e,{...this._def,...t})}exclude(e,t=this._def){return r.create(this.options.filter(s=>!e.includes(s)),{...this._def,...t})}};Jt.create=yh;var Ht=class extends B{_parse(e){let t=F.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==x.string&&s.parsedType!==x.number){let i=F.objectValues(t);return v(s,{expected:F.joinValues(i),received:s.parsedType,code:b.invalid_type}),k}if(this._cache||(this._cache=new Set(F.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let i=F.objectValues(t);return v(s,{received:s.data,code:b.invalid_enum_value,options:i}),k}return ve(e.data)}get enum(){return this._def.values}};Ht.create=(r,e)=>new Ht({values:r,typeName:$.ZodNativeEnum,...Q(e)});var Et=class extends B{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==x.promise&&t.common.async===!1)return v(t,{code:b.invalid_type,expected:x.promise,received:t.parsedType}),k;let s=t.parsedType===x.promise?t.data:Promise.resolve(t.data);return ve(s.then(i=>this._def.type.parseAsync(i,{path:t.path,errorMap:t.common.contextualErrorMap})))}};Et.create=(r,e)=>new Et({type:r,typeName:$.ZodPromise,...Q(e)});var je=class extends B{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===$.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:s}=this._processInputParams(e),i=this._def.effect||null,n={addIssue:o=>{v(s,o),o.fatal?t.abort():t.dirty()},get path(){return s.path}};if(n.addIssue=n.addIssue.bind(n),i.type==="preprocess"){let o=i.transform(s.data,n);if(s.common.async)return Promise.resolve(o).then(async a=>{if(t.value==="aborted")return k;let l=await this._def.schema._parseAsync({data:a,path:s.path,parent:s});return l.status==="aborted"?k:l.status==="dirty"?Qt(l.value):t.value==="dirty"?Qt(l.value):l});{if(t.value==="aborted")return k;let a=this._def.schema._parseSync({data:o,path:s.path,parent:s});return a.status==="aborted"?k:a.status==="dirty"?Qt(a.value):t.value==="dirty"?Qt(a.value):a}}if(i.type==="refinement"){let o=a=>{let l=i.refinement(a,n);if(s.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(s.common.async===!1){let a=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return a.status==="aborted"?k:(a.status==="dirty"&&t.dirty(),o(a.value),{status:t.value,value:a.value})}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(a=>a.status==="aborted"?k:(a.status==="dirty"&&t.dirty(),o(a.value).then(()=>({status:t.value,value:a.value}))))}if(i.type==="transform")if(s.common.async===!1){let o=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!Tt(o))return k;let a=i.transform(o.value,n);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(o=>Tt(o)?Promise.resolve(i.transform(o.value,n)).then(a=>({status:t.value,value:a})):k);F.assertNever(i)}};je.create=(r,e,t)=>new je({schema:r,typeName:$.ZodEffects,effect:e,...Q(t)});je.createWithPreprocess=(r,e,t)=>new je({schema:e,effect:{type:"preprocess",transform:r},typeName:$.ZodEffects,...Q(t)});var De=class extends B{_parse(e){return this._getType(e)===x.undefined?ve(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};De.create=(r,e)=>new De({innerType:r,typeName:$.ZodOptional,...Q(e)});var rt=class extends B{_parse(e){return this._getType(e)===x.null?ve(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};rt.create=(r,e)=>new rt({innerType:r,typeName:$.ZodNullable,...Q(e)});var Zt=class extends B{_parse(e){let{ctx:t}=this._processInputParams(e),s=t.data;return t.parsedType===x.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};Zt.create=(r,e)=>new Zt({innerType:r,typeName:$.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Q(e)});var Gt=class extends B{_parse(e){let{ctx:t}=this._processInputParams(e),s={...t,common:{...t.common,issues:[]}},i=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return Mr(i)?i.then(n=>({status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new Pe(s.common.issues)},input:s.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Pe(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}};Gt.create=(r,e)=>new Gt({innerType:r,typeName:$.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Q(e)});var jr=class extends B{_parse(e){if(this._getType(e)!==x.nan){let s=this._getOrReturnCtx(e);return v(s,{code:b.invalid_type,expected:x.nan,received:s.parsedType}),k}return{status:"valid",value:e.data}}};jr.create=r=>new jr({typeName:$.ZodNaN,...Q(r)});var Mp=Symbol("zod_brand"),Ts=class extends B{_parse(e){let{ctx:t}=this._processInputParams(e),s=t.data;return this._def.type._parse({data:s,path:t.path,parent:t})}unwrap(){return this._def.type}},Ns=class r extends B{_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{let n=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return n.status==="aborted"?k:n.status==="dirty"?(t.dirty(),Qt(n.value)):this._def.out._parseAsync({data:n.value,path:s.path,parent:s})})();{let i=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return i.status==="aborted"?k:i.status==="dirty"?(t.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:s.path,parent:s})}}static create(e,t){return new r({in:e,out:t,typeName:$.ZodPipeline})}},Yt=class extends B{_parse(e){let t=this._def.innerType._parse(e),s=i=>(Tt(i)&&(i.value=Object.freeze(i.value)),i);return Mr(t)?t.then(i=>s(i)):s(t)}unwrap(){return this._def.innerType}};Yt.create=(r,e)=>new Yt({innerType:r,typeName:$.ZodReadonly,...Q(e)});function fh(r,e){let t=typeof r=="function"?r(e):typeof r=="string"?{message:r}:r;return typeof t=="string"?{message:t}:t}function bh(r,e={},t){return r?At.create().superRefine((s,i)=>{let n=r(s);if(n instanceof Promise)return n.then(o=>{if(!o){let a=fh(e,s),l=a.fatal??t??!0;i.addIssue({code:"custom",...a,fatal:l})}});if(!n){let o=fh(e,s),a=o.fatal??t??!0;i.addIssue({code:"custom",...o,fatal:a})}}):At.create()}var Lp={object:qe.lazycreate},$;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})($||($={}));var Qp=(r,e={message:`Input not instance of ${r.name}`})=>bh(t=>t instanceof r,e),wh=Nt.create,Sh=Rt.create,Rp=jr.create,Dp=Dt.create,_h=Bt.create,Bp=jt.create,jp=Qr.create,Fp=Ft.create,zp=zt.create,Vp=At.create,Up=dt.create,Kp=Ke.create,Wp=Rr.create,Jp=ft.create,Hp=qe.create,Zp=qe.strictCreate,Gp=Vt.create,Yp=Ii.create,Xp=Ut.create,eg=tt.create,tg=$i.create,rg=Dr.create,sg=Br.create,ig=Oi.create,ng=Kt.create,og=Wt.create,ag=Jt.create,cg=Ht.create,lg=Et.create,ug=je.create,hg=De.create,dg=rt.create,fg=je.createWithPreprocess,mg=Ns.create,pg=()=>wh().optional(),gg=()=>Sh().optional(),yg=()=>_h().optional(),bg={string:(r=>Nt.create({...r,coerce:!0})),number:(r=>Rt.create({...r,coerce:!0})),boolean:(r=>Bt.create({...r,coerce:!0})),bigint:(r=>Dt.create({...r,coerce:!0})),date:(r=>jt.create({...r,coerce:!0}))};var wg=k;var se={INT8_MIN:-128,INT8_MAX:127,INT8_UNSIGNED_MAX:255,INT16_MIN:-32768,INT16_MAX:32767,INT16_UNSIGNED_MAX:65535,INT24_MIN:-8388608,INT24_MAX:8388607,INT24_UNSIGNED_MAX:16777215,INT32_MIN:-2147483648,INT32_MAX:2147483647,INT32_UNSIGNED_MAX:4294967295,INT48_MIN:-0x800000000000,INT48_MAX:0x7fffffffffff,INT48_UNSIGNED_MAX:0xffffffffffff,INT64_MIN:-9223372036854775808n,INT64_MAX:9223372036854775807n,INT64_UNSIGNED_MAX:18446744073709551615n};function oe(r,e){return e.includes(r.columnType)}function Sg(r){return"enumValues"in r&&Array.isArray(r.enumValues)&&r.enumValues.length>0}var _g=be.union([be.string(),be.number(),be.boolean(),be.null()]),vg=be.union([_g,be.record(be.any()),be.array(be.any())]),xg=be.custom(r=>r instanceof Buffer);function vh(r,e){let t=e?.zodInstance??be,s=e?.coerce??{},i;return Sg(r)&&(i=r.enumValues.length?t.enum(r.enumValues):t.string()),i||(oe(r,["PgGeometry","PgPointTuple"])?i=t.tuple([t.number(),t.number()]):oe(r,["PgGeometryObject","PgPointObject"])?i=t.object({x:t.number(),y:t.number()}):oe(r,["PgHalfVector","PgVector"])?(i=t.array(t.number()),i=r.dimensions?i.length(r.dimensions):i):oe(r,["PgLine"])?i=t.tuple([t.number(),t.number(),t.number()]):oe(r,["PgLineABC"])?i=t.object({a:t.number(),b:t.number(),c:t.number()}):oe(r,["PgArray"])?(i=t.array(vh(r.baseColumn,t)),i=r.size?i.length(r.size):i):r.dataType==="array"?i=t.array(t.any()):r.dataType==="number"?i=Cg(r,t,s):r.dataType==="bigint"?i=Tg(r,t,s):r.dataType==="boolean"?i=s===!0||s.boolean?t.coerce.boolean():t.boolean():r.dataType==="date"?i=s===!0||s.date?t.coerce.date():t.date():r.dataType==="string"?i=Ng(r,t,s):r.dataType==="json"?i=vg:r.dataType==="custom"?i=t.any():r.dataType==="buffer"&&(i=xg)),i||(i=t.any()),i}function Cg(r,e,t){let s=r.getSQLType().includes("unsigned"),i,n,o=!1;oe(r,["MySqlTinyInt","SingleStoreTinyInt"])?(i=s?0:se.INT8_MIN,n=s?se.INT8_UNSIGNED_MAX:se.INT8_MAX,o=!0):oe(r,["PgSmallInt","PgSmallSerial","MySqlSmallInt","SingleStoreSmallInt"])?(i=s?0:se.INT16_MIN,n=s?se.INT16_UNSIGNED_MAX:se.INT16_MAX,o=!0):oe(r,["PgReal","MySqlFloat","MySqlMediumInt","SingleStoreMediumInt","SingleStoreFloat"])?(i=s?0:se.INT24_MIN,n=s?se.INT24_UNSIGNED_MAX:se.INT24_MAX,o=oe(r,["MySqlMediumInt","SingleStoreMediumInt"])):oe(r,["PgInteger","PgSerial","MySqlInt","SingleStoreInt"])?(i=s?0:se.INT32_MIN,n=s?se.INT32_UNSIGNED_MAX:se.INT32_MAX,o=!0):oe(r,["PgDoublePrecision","MySqlReal","MySqlDouble","SingleStoreReal","SingleStoreDouble","SQLiteReal"])?(i=s?0:se.INT48_MIN,n=s?se.INT48_UNSIGNED_MAX:se.INT48_MAX):oe(r,["PgBigInt53","PgBigSerial53","MySqlBigInt53","MySqlSerial","SingleStoreBigInt53","SingleStoreSerial","SQLiteInteger"])?(s=s||oe(r,["MySqlSerial","SingleStoreSerial"]),i=s?0:Number.MIN_SAFE_INTEGER,n=Number.MAX_SAFE_INTEGER,o=!0):oe(r,["MySqlYear","SingleStoreYear"])?(i=1901,n=2155,o=!0):(i=Number.MIN_SAFE_INTEGER,n=Number.MAX_SAFE_INTEGER);let a=t===!0||t?.number?e.coerce.number():e.number();return a=a.min(i).max(n),o?a.int():a}function Tg(r,e,t){let s=r.getSQLType().includes("unsigned"),i=s?0n:se.INT64_MIN,n=s?se.INT64_UNSIGNED_MAX:se.INT64_MAX;return(t===!0||t?.bigint?e.coerce.bigint():e.bigint()).min(i).max(n)}function Ng(r,e,t){if(oe(r,["PgUUID"]))return e.string().uuid();let s,i,n=!1;oe(r,["PgVarchar","SQLiteText"])?s=r.length:oe(r,["MySqlVarChar","SingleStoreVarChar"])?s=r.length??se.INT16_UNSIGNED_MAX:oe(r,["MySqlText","SingleStoreText"])&&(r.textType==="longtext"?s=se.INT32_UNSIGNED_MAX:r.textType==="mediumtext"?s=se.INT24_UNSIGNED_MAX:r.textType==="text"?s=se.INT16_UNSIGNED_MAX:s=se.INT8_UNSIGNED_MAX),oe(r,["PgChar","MySqlChar","SingleStoreChar"])&&(s=r.length,n=!0),oe(r,["PgBinaryVector"])&&(i=/^[01]+$/,s=r.dimensions);let o=t===!0||t?.string?e.coerce.string():e.string();return o=i?o.regex(i):o,s&&n?o.length(s):s?o.max(s):o}function xh(r){return oo(r)?br(r):lu(r)}function Ch(r,e,t,s){let i={};for(let[n,o]of Object.entries(r)){if(!f(o,L)&&!f(o,y)&&!f(o,y.Aliased)&&typeof o=="object"){let m=oo(o)||au(o)?xh(o):o;i[n]=Ch(m,e[n]??{},t,s);continue}let a=e[n];if(a!==void 0&&typeof a!="function"){i[n]=a;continue}let l=f(o,L)?o:void 0,u=l?vh(l,s):be.any(),d=typeof a=="function"?a(u):u;t.never(l)||(i[n]=d,l&&(t.nullable(l)&&(i[n]=i[n].nullable()),t.optional(l)&&(i[n]=i[n].optional())))}return be.object(i)}var Ag={never:r=>r?.generated?.type==="always"||r?.generatedIdentity?.type==="always",optional:r=>!r.notNull||r.notNull&&r.hasDefault,nullable:r=>!r.notNull};var Fe=(r,e)=>{let t=xh(r);return Ch(t,e??{},Ag)};var Eg=$e("sessions",{sid:A("sid").primaryKey(),sess:cs("sess").notNull(),expire:J("expire").notNull()},r=>[Du("IDX_session_expire").on(r.expire)]),Oe=$e("users",{id:A("id").primaryKey().default(c`gen_random_uuid()`),email:A("email").unique(),firstName:A("first_name"),lastName:A("last_name"),profileImageUrl:A("profile_image_url"),studyLevel:A("study_level"),field:A("field"),language:A("language"),interfaceLanguage:A("interface_language").default("english"),password:ne("password"),onboardingCompleted:_t("onboarding_completed").default(!1),createdAt:J("created_at").defaultNow(),updatedAt:J("updated_at").defaultNow()}),G=$e("theses",{id:A("id").primaryKey().default(c`gen_random_uuid()`),userId:A("user_id").notNull().references(()=>Oe.id,{onDelete:"cascade"}),title:A("title").notNull(),topic:ne("topic"),language:A("language").default("english"),researchQuestions:ne("research_questions").array(),objectives:ne("objectives").array(),status:A("status").default("active"),degreeType:A("degree_type").default("phd"),targetCompletionDate:J("target_completion_date"),matrixColumns:ne("matrix_columns").array(),methodologyType:A("methodology_type"),specificMethodology:A("specific_methodology"),createdAt:J("created_at").defaultNow(),updatedAt:J("updated_at").defaultNow()}),We=$e("chapters",{id:A("id").primaryKey().default(c`gen_random_uuid()`),thesisId:A("thesis_id").notNull().references(()=>G.id,{onDelete:"cascade"}),title:A("title").notNull(),content:ne("content").default(""),wordCount:ze("word_count").default(0),targetWordCount:ze("target_word_count"),orderIndex:ze("order_index").notNull(),status:A("status").default("draft"),deadline:J("deadline"),createdAt:J("created_at").defaultNow(),updatedAt:J("updated_at").defaultNow()}),Xt=$e("tasks",{id:A("id").primaryKey().default(c`gen_random_uuid()`),chapterId:A("chapter_id").references(()=>We.id,{onDelete:"cascade"}),thesisId:A("thesis_id").notNull().references(()=>G.id,{onDelete:"cascade"}),title:A("title").notNull(),description:ne("description"),status:A("status").default("todo"),priority:A("priority").default("medium"),dueDate:J("due_date"),completed:_t("completed").default(!1),orderIndex:ze("order_index").default(0),createdAt:J("created_at").defaultNow(),updatedAt:J("updated_at").defaultNow()}),As=$e("milestones",{id:A("id").primaryKey().default(c`gen_random_uuid()`),thesisId:A("thesis_id").notNull().references(()=>G.id,{onDelete:"cascade"}),name:A("name").notNull(),description:ne("description"),targetDate:J("target_date"),completedDate:J("completed_date"),completed:_t("completed").default(!1),orderIndex:ze("order_index").notNull(),createdAt:J("created_at").defaultNow()}),er=$e("comments",{id:A("id").primaryKey().default(c`gen_random_uuid()`),chapterId:A("chapter_id").notNull().references(()=>We.id,{onDelete:"cascade"}),userId:A("user_id").notNull().references(()=>Oe.id,{onDelete:"cascade"}),content:ne("content").notNull(),paragraphIndex:ze("paragraph_index"),resolved:_t("resolved").default(!1),createdAt:J("created_at").defaultNow(),updatedAt:J("updated_at").defaultNow()}),Es=$e("references",{id:A("id").primaryKey().default(c`gen_random_uuid()`),thesisId:A("thesis_id").notNull().references(()=>G.id,{onDelete:"cascade"}),title:A("title").notNull(),authors:ne("authors").array(),year:ze("year"),source:A("source"),url:A("url"),doi:A("doi"),citationStyle:A("citation_style").default("apa"),formattedCitation:ne("formatted_citation"),notes:ne("notes"),tags:ne("tags").array(),matrixData:cs("matrix_data").default({}),createdAt:J("created_at").defaultNow(),updatedAt:J("updated_at").defaultNow()}),Ps=$e("shared_access",{id:A("id").primaryKey().default(c`gen_random_uuid()`),thesisId:A("thesis_id").notNull().references(()=>G.id,{onDelete:"cascade"}),email:A("email").notNull(),token:A("token").notNull().unique(),permissionLevel:A("permission_level").default("read"),accepted:_t("accepted").default(!1),createdAt:J("created_at").defaultNow(),expiresAt:J("expires_at")}),qs=$e("research_entries",{id:A("id").primaryKey().default(c`gen_random_uuid()`),userId:A("user_id").notNull().references(()=>Oe.id,{onDelete:"cascade"}),content:ne("content").notNull(),type:A("type").default("thought"),tags:ne("tags").array().default([]),date:J("date").defaultNow(),createdAt:J("created_at").defaultNow(),updatedAt:J("updated_at").defaultNow()}),Mi=$e("flashcards",{id:A("id").primaryKey().default(c`gen_random_uuid()`),thesisId:A("thesis_id").notNull().references(()=>G.id,{onDelete:"cascade"}),front:ne("front").notNull(),back:ne("back").notNull(),category:A("category").notNull().default("general"),masteryLevel:ze("mastery_level").default(0),createdAt:J("created_at").defaultNow(),updatedAt:J("updated_at").defaultNow()}),ks=$e("documents",{id:A("id").primaryKey().default(c`gen_random_uuid()`),thesisId:A("thesis_id").notNull().references(()=>G.id,{onDelete:"cascade"}),userId:A("user_id").notNull().references(()=>Oe.id,{onDelete:"cascade"}),title:A("title").notNull(),content:ne("content").notNull(),filename:A("filename").notNull(),mimeType:A("mime_type").notNull(),createdAt:J("created_at").defaultNow()}),Pg=Qe(Oe,({many:r})=>({theses:r(G),comments:r(er),researchEntries:r(qs)})),qg=Qe(G,({one:r,many:e})=>({user:r(Oe,{fields:[G.userId],references:[Oe.id]}),chapters:e(We),tasks:e(Xt),milestones:e(As),references:e(Es),sharedAccess:e(Ps),documents:e(ks)})),kg=Qe(Ps,({one:r})=>({thesis:r(G,{fields:[Ps.thesisId],references:[G.id]})})),Ig=Qe(ks,({one:r})=>({thesis:r(G,{fields:[ks.thesisId],references:[G.id]})})),$g=Fe(ks).omit({id:!0,createdAt:!0}),Og=Qe(We,({one:r,many:e})=>({thesis:r(G,{fields:[We.thesisId],references:[G.id]}),tasks:e(Xt),comments:e(er)})),Mg=Qe(Xt,({one:r})=>({thesis:r(G,{fields:[Xt.thesisId],references:[G.id]}),chapter:r(We,{fields:[Xt.chapterId],references:[We.id]})})),Lg=Qe(As,({one:r})=>({thesis:r(G,{fields:[As.thesisId],references:[G.id]})})),Qg=Qe(er,({one:r})=>({chapter:r(We,{fields:[er.chapterId],references:[We.id]}),user:r(Oe,{fields:[er.userId],references:[Oe.id]})})),Rg=Qe(Es,({one:r})=>({thesis:r(G,{fields:[Es.thesisId],references:[G.id]})})),Dg=Qe(qs,({one:r})=>({user:r(Oe,{fields:[qs.userId],references:[Oe.id]})})),Bg=Qe(Mi,({one:r})=>({thesis:r(G,{fields:[Mi.thesisId],references:[G.id]})})),jg=Fe(Oe).omit({id:!0,createdAt:!0,updatedAt:!0}),Fg=Fe(G).omit({id:!0,createdAt:!0,updatedAt:!0}),zg=Fe(We).omit({id:!0,createdAt:!0,updatedAt:!0}),Vg=Fe(Xt).omit({id:!0,createdAt:!0,updatedAt:!0}),Ug=Fe(As).omit({id:!0,createdAt:!0}),Kg=Fe(er).omit({id:!0,createdAt:!0,updatedAt:!0}),Wg=Fe(Es).omit({id:!0,createdAt:!0,updatedAt:!0}),Jg=Fe(Ps).omit({id:!0,createdAt:!0}),Th=Fe(qs).pick({content:!0,type:!0,tags:!0,date:!0}),Hg=Th,Zg=Fe(Mi).pick({front:!0,back:!0,category:!0});var{Pool:Gg}=yt,Yg=!1,Qi,Fr=null;if(Yg){let r=process.env.DATABASE_URL?.replace("sqlite:","")||"./database.db";console.log(`[Desktop Mode] Using SQLite database at: ${r}`);let e=new Nh.default(r);Qi=Pi(e,{schema:Li}),Fr=null}else{if(!process.env.DATABASE_URL)throw new Error("DATABASE_URL must be set. Did you forget to provision a database?");let r={connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1}};Fr=new Gg(r),Fr.on("error",e=>{console.error("Unexpected error on idle client",e),process.exit(-1)}),Qi=yi(Fr,{schema:Li})}Ah.config();async function Xg(){console.log("Running migrations...");try{await rc(Qi,{migrationsFolder:"migrations"}),console.log("Migrations completed successfully")}catch(r){console.error("Migration failed:",r),process.exit(1)}finally{await Fr.end()}}Xg();
